function darn(e){return console&&console.log(e),e}function redirect(e){throw window.location.href=e,"core.ok.redirect"}function clone(e){return JSON.parse(JSON.stringify(e))}function en_unplural(e){if(e.match(/(status|goods)$/))return e;var t=[[/tives$/,"tive"],[/ives$/,"ife"],[/ves$/,"f"],[/ies$/,"y"],[/ice$/,"ouse"],[/men$/,"man"],[/eet(h?)$/,"oot$1"],[/(o|ch|sh|ss|x)es$/,"$1"],[/s$/,""]];for(i=0;i<t.length;i++){var n=t[i][0];if(e.match(n))return e.replace(n,t[i][1])}return e}function fire(e){e()}function values(e){var t={};$("input[required]",e).each(function(){var e=$(this);if(e.val())return!0;throw e.focus(),alert("Вы забыли заполнить обязательное поле"),"core.ok.validation_error"}),$("input[pattern]",e).each(function(){var e=$(this);if(new RegExp(e.attr("pattern")).test(e.val()))return!0;throw e.focus(),alert("Введено недопустимое значение"),"core.ok.validation_error"});var i="FORM"==e.prop("tagName")?e:$("form",e);i.length||(i=e.clone().wrap("<form/>").parent());for(var n=i.serializeArray(),o=0;o<n.length;o++)t[n[o].name]=n[o].value.trim();return $("input[type=password]",e).each(function(){$_REQUEST._secret||($_REQUEST._secret=[]),$_REQUEST._secret.push(this.name)}),$("select",e).each(function(){t[this.name]=$(this).val()}),$("input[type=checkbox]",e).each(function(){t[this.name]=$(this).prop("checked")?1:0}),t}function staticURL(e){return sessionStorage.getItem("staticRoot")+"/"+e}function dynamicURL(e,t){return"type"in e?e.type||(e={}):e.type=$_REQUEST.type,!e.type||"id"in e||!$_REQUEST.id||(e.id=$_REQUEST.id),sessionStorage.getItem("dynamicRoot")+(t||"")+"/?"+$.param(e)}function download(e,t,i){t||(t={}),i||(i={}),i.dataType="binary",i.method="POST",i.processData=!1,i.contentType="application/json",i.data=JSON.stringify(t),$.ajax(dynamicURL(e),i).done(function(e,t,i){var n="1.bin",o=i.getResponseHeader("Content-Disposition"),a="attachment;filename=",r=a.length;o&&o.substr(0,r)==a&&(n=decodeURIComponent(o.substr(r))),e.saveAs(n)}).fail(function(e,t){alert("Загрузить файл не удалось. "+("error"==t?"На сервере произошла ошибка":"Похоже, сервер оказался недоступен."))}).always(function(e,t){i.onload&&i.onload()})}function showIt(e){use.block($_REQUEST.type),blockEvent(e)}function jerk(e,t,i){$.ajax(dynamicURL(e||{},"/_slow"),{dataType:"json",method:"POST",processData:!1,contentType:"application/json",timeout:10,data:JSON.stringify(t||{}),headers:{}}).always(i)}function query(e,t,i,n){e||(e={}),t||(t={}),i||(i=$_F5);var o={};if($_REQUEST._secret){for(var a=0;a<$_REQUEST._secret.length;a++){var r=$_REQUEST._secret[a];o["X-Request-Param-"+r]=encodeURIComponent(t.data[r]),delete t.data[r]}delete $_REQUEST._secret}$.ajax(dynamicURL(e),{dataType:"json",method:"POST",processData:!1,contentType:"application/json",timeout:1e4,data:JSON.stringify(t),headers:o}).done(function(e){if(e.success)return i(e.content);var t={data:e};e.field&&(t.field=$("[name="+e.field+"]")),$_DO.apologize(t,n)}).fail(function(e,t){if(422==e.status){var i={data:e.responseJSON};i.data.field&&(i.field=$("[name="+i.data.field+"]")),$_DO.apologize(i,n)}else $_DO.apologize({jqXHR:e,error:t},n)})}function refill(e,t){fill(t,e,t)}function eachAttr(e,t,i,n){e.find("*").addBack().filter("["+t+"]").each(function(){var e=$(this),o=e.attr(t),a=o.split(".");if(1==a.length)n(e,o,i[o]);else{for(var r=i,s=0;s<a.length;s++)if(!(r=r[a[s]])){r="";break}n(e,o,r)}})}function fill(e,t,i){e=e.clone(),-1==t.fake&&e.attr("data-deleted",1),eachAttr(e,"data-text",t,function(e,t,i){null==i&&(i=e.attr("data-default")||"");var n=e.attr("data-digits");if(null!=n)i=$.isNumeric(i)?new Number(i).toLocaleString([],{minimumFractionDigits:n,maximumFractionDigits:n}):"";else{var o=e.attr("data-date");if(null!=o){var a=i.substr(0,10).split(/\D+/);a[2]>31&&a.reverse(),i=new Date(a[0],a[1]-1,a[2]).toLocaleDateString([],o.length?JSON.parse(o):void 0)}else{var r=e.attr("data-ts");null!=r&&(i=new Date(i).toLocaleString([],r.length?JSON.parse(r):void 0))}}e.text(i)}),eachAttr(e,"data-html",t,function(e,t,i){e.html(i)}),eachAttr(e,"data-id-field",t,function(e,t,i){e.attr("data-id",i)}),eachAttr(e,"data-name",t,function(e,t,i){e.attr("name",i)}),eachAttr(e,"data-for",t,function(e,t,i){e.attr("for",i)}),eachAttr(e,"data-src",t,function(e,t,i){e.attr("src",i)}),eachAttr(e,"data-value",t,function(e,t,i){e.val(i)}),eachAttr(e,"data-class",t,function(e,t,i){e.addClass(i)}),eachAttr(e,"data-key",t,function(e,t,i){e.text(e.text()+" ("+t+")"),e.attr("data-hotkey",t)}),eachAttr(e,"data-off",t,function(e,t,i){i?e.hide():e.show()}),eachAttr(e,"data-on",t,function(e,t,i){i?e.show():e.hide()}),eachAttr(e,"data-roles",t,function(e,t,i){t.split(/\W/).indexOf($_USER.role)<0&&e.remove()}),eachAttr(e,"data-uri",t,function(e,t,i){if(i){e.attr("data-href",i).find(":not(:has(*))").addBack(":not(:has(*))").wrapInner('<span class="anchor"/>')}}),eachAttr(e,"data-img",t,function(e,t,i){e.css({"background-image":"url(data:"+i+")"}),e.attr("data-image",t)}),clickOn($("span.anchor",e),onDataUriDblClick);var n="input:text, input[type=number], input[type=range], input:password, textarea, select";return t._can&&$("button[name]",e).each(function(){t._can[this.name]||$(this).remove()}),$("button[name]",e).each(function(){var e=$(this),t=$_DO[this.name+"_"+e.attr("data-block-name")];t&&clickOn(e,function(e){try{t(e)}catch(e){if(!("string"==typeof e||e instanceof String))throw e;if(e.match(/^core\.ok\./));else{var i=/^#(.*?)#:(.*)/.exec(e);if(!i)throw e;$("*[name="+i[1]+"]").focus(),alert(i[2])}}})}),eachAttr(e,"data-list",t,function(e,i,n){if(!n)return console.log("Empty value as data-list in "+e.get(0).outerHTML,t,i),void e.remove();if(!$.isArray(n))return console.log("Not a list as data-list for "+e.get(0).outerHTML+": ",n),void e.remove();for(var o=$([]),a=0;a<n.length;a++)o=o.add(fill(e.clone().removeAttr("data-list"),n[a]));e.replaceWith(o)}),$(n,e).each(function(){$(this).val(t[this.name])}),$("input:radio",e).each(function(){var e=$(this);e.prop("checked",e.val()==t[this.name])}),t._read_only&&($(n,e).each(function(){if("hidden"!=this.type){var e=$(this);e.replaceWith($("<span />").text(e.val()))}}),$("input:radio",e).not(":checked").parent().remove(),$("input:radio",e).remove()),e.data("data",t),i&&i.empty().append(e),e}function click(e){var t=window.document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}function xmlDoc(e,t){function i(e,t,i){var o=document.createElementNS(null,t);n(i,o),e.appendChild(o)}function n(e,t){for(var n in e){var o=e[n];if(null!=o)if(/^[^A-Z]/i.test(n)&&(n="a-"+n),$.isArray(o))for(var a=0;a<o.length;a++)i(t,en_unplural(n),o[a]);else"object"==typeof o?i(t,n,o):t.setAttribute(n,o)}}t||(t="data");var o=document.implementation.createDocument(null,t,null);return n(e,o.documentElement),o}function xslTransform(e,t,i){i||(i=$_REQUEST.type),$.get(staticURL("app/xslt/"+i+".xsl"),function(i){var n=new XSLTProcessor;n.importStylesheet($.parseXML(i));var o=(new XMLSerializer).serializeToString(n.transformToDocument(e));"<?xml"!=o.substr(0,5)&&(o='<?xml version="1.0"?>'+o),t(o)})}function openTab(e,t){t||(t=e);var i=window.document.createElement("a");i.target=t,i.href=e,click(i)}function onDataUriDblClick(e){var t=$(this).closest("[data-href]"),i=t.attr("data-href");if(i){var n=t.attr("data-target");openTab(i,n||i)}}function clickOn(e,t,i){i||(i=e.attr("data-question")),e.toggleClass("clickable",!0).unbind("click").click(i?function(e){confirm(i)&&t()}:t)}function clickOff(e){e.toggleClass("clickable",!1).unbind("click")}function isEnterPressed(e){return 13==e.which&&(!e.ctrlKey&&(!e.altKey&&!e.shiftKey))}function onEnterGoToNextInput(e){if(isEnterPressed(e)){var t=$("input"),i=t.index($(this));t.eq(i+1).focus()}}function blockEvent(e){if(e)return e.preventDefault?(e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation(),e):e}function refreshOpener(){try{window.opener.showIt()}catch(e){}}function wait(e){e.interval|=100;var t=!1,i=setInterval(function(){if(!t){if(t=!0,!e.until())return t=!1;clearInterval(i),e.then&&e.then()}},e.interval)}function dia2w2uiVoc(e){return $.each(e,function(){this.text=this.label,delete this.label}),e}function dia2w2uiDrop(e){e.data={status:"success",records:e.data.content.map(function(e){return{id:e.id,text:e.label}})}}function dia2w2uiRecords(e){if($.each(e,function(){this.recid=this.id,this._status&&(this.w2ui||(this.w2ui={}),this.w2ui.class="status_"+this._status,delete this._status);for(k in this){var e=this[k];if(e){if("object"==typeof e)for(j in e)this[k+"."+j]=e[j];else if("dt"==k.substr(0,2)){if(!e)continue;10==e.length&&(this[k]=dt_dmy(e)),26==e.length&&(this[k]=dt_dmyhms(e))}var t=k.split(".");2==t.length&&(this[t[0]]||(this[t[0]]={}),this[t[0]][t[1]]=e)}}}),e.length>0){var t=e[e.length-1];"1"==t.is_total&&t.def&&"_root"==t.def.name&&!t.w2ui&&(t.recid="ИТОГО",t.w2ui={summary:!0})}return e}function dia2w2ui(e){if(200!=e.xhr.status)return $_DO.apologize({jqXHR:e.xhr});var t=JSON.parse(e.xhr.responseText).content,i={status:"success",total:t.cnt},n=t.total;delete t.cnt,delete t.portion,delete t.total;for(key in t)i.records=dia2w2uiRecords(t[key]),n&&(i.summary=[n]),e.xhr.responseText=JSON.stringify(i)}function w2injectSearchValues(e){$(".w2ui-grid-searches input[rel=search]").each(function(){if(/id/.test(this.name)){if(this.name==e.target.name)return!1;var t=$(this).data("selected");t&&t.length&&(e.postData[this.name]=t.map(function(e){return e.id}),e.postData[this.name+"__op"]=$("#"+this.id.replace("_field_","_operator_")).val())}})}function add_vocabularies(e,t){for(var i in t){var n=e[i];if(n){var o={items:n.filter(function(e){var t=e.fake;return!t||0==parseInt(t)})};$.each(n,function(){o[this.id]=this.text=this.label}),e[i]=o}}}function normalizeValue(e,t){if(null==e)return null;if("checkbox"==t)return e?1:0;if("list"==t)return e.id;if("enum"==t)return e.map(function(e){return e.id});var i=String(e).trim();return 0==i.length?null:("date"==t&&(i=i.replace(/^(\d\d)\.(\d\d)\.(\d\d\d\d)$/,function(e,t,i,n){return n+"-"+i+"-"+t})),"int"==t&&(i=i.replace(/[\D]/g,"")),"float"==t.split(":")[0]&&(i=i.replace(/ /g,"").replace(",",".")),i)}function escapeHtml(e){var t=""+e,i=matchHtmlRegExp.exec(t);if(!i)return t;var n,o="",a=0,r=0;for(a=i.index;a<t.length;a++){switch(t.charCodeAt(a)){case 34:n="&quot;";break;case 38:n="&amp;";break;case 39:n="&#39;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}r!==a&&(o+=t.substring(r,a)),r=a+1,o+=n}return r!==a?o+t.substring(r,a):o}function get_default_url(){return"/widgets"}function setup_request(){if($_USER){var e=location.pathname.split("/").filter(function(e){return e});$_REQUEST={type:e[1]},e[2]&&($_REQUEST.id=e[2])}}function dt_dmy(e){return e?e.substr(0,10).split("-").reverse().join("."):""}function dt_dmy2(e){if(!e)return"";var t=e.split("-").reverse();return t[2]%=100,t.join(".")}function _dt(e,t,i,n){return dt_dmy(n)}function _ts(e,t,i,n){return dt_dmy(n)+n.substr(10)}function dt_dmyhms(e){return e?dt_dmy(e.substr(0,10))+e.substr(10,9):""}function __d(e){for(i in e)if(i.match(/^dt/)){var t=e[i];if(!t||10!=t.length||!t.match(/^\d\d\d\d-\d\d-\d\d$/))continue;e[i]=dt_dmy(t)}return e}function refreshButtons(e){e.done(function(){$("button",$(this.box)).each(function(){var e=$(this);clickOn(e,$_DO[this.name+"_"+e.attr("data-block-name")])}),clickOn($("span.anchor"),onDataUriDblClick)})}function die(e,t){throw alert(t),$("[name="+e+"]").focus(),"core.ok.validation"}function not_off(e){return!e.off}function reload_page(){location.reload()}function get_nsi(e,t){var i=$("body").data("data");query({type:"voc_nsi_list",part:"vocs",id:void 0},{data:{ids:e}},function(e){e.bool=[{id:"0",label:"Нет"},{id:"1",label:"Да"}],add_vocabularies(e,e);for(k in e)i[k]=e[k];t(i)})}function edit_failed(e,t){return function(i){i.data&&i.data.field?(e.unlock(),alert(i.data.message),t.preventDefault(),e.editField(t.recid,t.column,t.value_original)):$_DO.apologize(i)}}function color_data_mandatory(e){var t=w2ui[e.target];$("tr[recid] td[data-mandatory]").each(function(){var e=$(this);if(!e.text()){var t={title:"Обязательное поле"};e.css({background:"#ffcccc"}).prop(t),$("*",e).prop(t)}}),$("tr[recid]").each(function(){var e=$(this),i=t.get(e.attr("recid"));i&&(i.is_annuled&&$("td",e).css({background:"#ccc"}),30==i.id_status&&$("td",e).css({background:"#fdd"}),i.is_deleted&&$("td div",e).css({"text-decoration":"line-through"}))})}function getPluralType(){var e=$_REQUEST.type.split("_");return 2==e.length&&"premise"==e[0]?e.join("s_"):$_REQUEST.type+"s"}function clickActiveTab(e,t){var i=function(e,t){if(!e||!e.length)return null;for(var i=localStorage.getItem(t),n=1;n<e.length;n++)if(i==e[n].id&&!e[n].hidden)return i;return e[0].id}(e.tabs,t);i&&e.click(i)}function color_passport_grid(e){e.done(function(){var e=null;$.each($("body").data("data").vc_pass_fields,function(){if(!("id_type"in this)){var t="tr[recid="+this.id+"]";$(t+" td.w2ui-grid-data").css({"font-weight":"bold","border-bottom-width":"1px"}).eq(0).css({"border-right-width":0}),e&&(t="tr[recid="+e+"]",$(t+" td.w2ui-grid-data").css({"border-bottom-width":"1px"}))}e=this.id}),$("td[data-status]").each(function(){var e=$(this),t=e.text();if(t)return e.find("*").addBack().attr("title",t)})})}!function(e,t){e.ajaxTransport("+binary",function(e,t,i){if(window.FormData&&(e.dataType&&"binary"==e.dataType||e.data&&(window.ArrayBuffer&&e.data instanceof ArrayBuffer||window.Blob&&e.data instanceof Blob)))return{send:function(t,i){function n(){var t={};t[e.dataType]=o.response,i(o.status,o.statusText,t,o.getAllResponseHeaders())}var o=new XMLHttpRequest;o.responseType=e.responseType||"blob",e.onprogress&&o.addEventListener("progress",function(t){e.onprogress(t.loaded,t.total)},!1),o.addEventListener("load",n,!1),o.addEventListener("error",n,!1),o.open(e.type,e.url,!0);for(var a in t)o.setRequestHeader(a,t[a]);o.send(e.data)},abort:function(){}}})}(window.jQuery);var $_REQUEST={},$_DO={},$_DRAW={},$_SESSION={get:function(e){var t=sessionStorage.getItem(e);if(null==t||""==t||"{[".indexOf(t.charAt(0))<0)return t;try{return JSON.parse(t)}catch(e){return void console.log(e)}},delete:function(e){var t=$_SESSION.get(e);return sessionStorage.removeItem(e),t},set:function(e,t){"object"==typeof t&&(t=JSON.stringify(t)),sessionStorage.setItem(e,t)},keepAlive:function(){query({type:void 0},{},$.noop,$.noop)},beforeExpiry:function(e){var t;$(document).ajaxSuccess(function(i,n,o){var a=sessionStorage.getItem("timeout");a&&(a<1&&(a=1),t&&clearTimeout(t),t=setTimeout(e,1e3*(60*a-1)))})},start:function(e,t){$_SESSION.set("user",$_USER=e),localStorage.setItem("user",1),t&&$_SESSION.set("timeout",t<1?1:t)},end:function(){window.__LOGOUT__=1,sessionStorage.clear(),$_USER=void 0,localStorage.removeItem("user")},closeAllOnLogout:function(e){if("user"==e.key&&!window.__LOGOUT__&&!e.newValue){$("body").text("");try{window.close()}catch(e){darn(e)}window.location="about:blank"}}},$_USER;if(opener)try{var ou=opener.$_USER;ou&&($_USER=clone(ou))}catch(e){}$_USER||($_USER=$_SESSION.get("user"));var use={lib:function(e){require([e],fire)}};use.data=function(e){require(["app/data/"+e],fire)},use.view=function(e,t){require(["app/view/"+e],function(i){var n=$("<span>");n.load(staticURL("app/html/"+e+".html"),function(){var o=n.children();$("*",o).attr("data-block-name",e),i(t,o)})})},use.block=function(e){try{require(["app/data/"+e],function(t){t(function(t){use.view(e,t)})})}catch(e){("string"==typeof e||e instanceof String)&&e.match(/^core\.ok\./)||darn(e)}};var $_F5=function(e){use.view($_REQUEST.type,e)};$_DO.apologize=function(e,t){if(t)return t(e);if(e.data){var i=e.data;return e.field&&e.field.focus(),void(i.message&&alert(i.message))}if(e.jqXHR){var n=e.jqXHR,o=e.error;if(401==n.status)localStorage.removeItem("user"),sessionStorage.removeItem("user"),$_USER=void 0,location.reload();else if(413==n.status)alert("Вы пытаетесь передать слишком большой объём данных: вероятно, файл недопустимой величины");else if(504==n.status)location.href="/_maintenance/";else if(console.log(n,o),n.responseJSON&&n.responseJSON.id)alert("На сервере произошла ошибка. Запишите, пожалуйста, её номер для обращения в службу поддержки: "+n.responseJSON.id);else{if(t)return t(e);alert("Не удалось получить ответ от сервера."+("timeout"==o?" Возможно, он перегружен либо имеют место проблемы с сетью. Пожалуйста, попробуйте обновить страницу или возобновить работу позже.":""))}}},Blob.prototype.saveAs=function(e){if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(this,e);else{var t=window.URL.createObjectURL(this),i=document.createElement("a");i.style="display: none",i.href=t,i.download=e,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(t),i.outerHTML=""}},$.fn.slideAsNeeded=function(e,t){var i="block"==this.css("display");!i&&e&&this.slideDown(t),i&&!e&&this.slideUp(t)},$.fn.saveAsXLS=function(e){e||(e=$("title").text()),e+=".xls",$("th, td",this).each(function(){var e=$(this);"none"==e.css("display")&&e.remove()}),("<html><head><meta charset=utf-8></head><body><table border>"+this.html()+"</table></body></html>").saveAs(e)},String.prototype.saveAs=function(e,t){t||(t="application/octet-stream"),new Blob([this],{type:t}).saveAs(e)},$_DO.route=function(e,t,i){if($.isArray(t))for(var n=0;n<t.length;n++)$_DO.route(e,t[n],i);else{var o=function(){query({action:t})};$_DO[t+"_"+e]=i?function(){i(o)}:o}};var Base64file={resize:function(e,t,i,n){var o=$("<canvas>").prop(t)[0],a=o.getContext("2d");return a.imageSmoothingEnabled=!0,a.scale(1,1),a.drawImage(e,0,0,t.width,t.height),o.toDataURL(i,n)},measure:function(e,t){var i=$("<img>");i.on("load",function(){t.call(this,{width:this.width,height:this.height,adjustWidth:function(e){e.css("width",e.height()*this.width/this.height)}})}),'url("'==e.substr(0,5)&&(e=e.substr(5,e.length-7)),"data:"!=e.substr(0,5)&&(e="data:"+e),i.attr({src:e})},upload:function(e,t){t.portion||(t.portion=131072),t.action||(t.action={}),t.action.create||(t.action.create="create"),t.action.update||(t.action.update="update");var i=t.data?t.data:{};i.label=e.name,i.type=e.type,i.size=e.size,query({type:t.type,action:t.action.create,id:void 0},{file:i},function(i){var n,o="object"==typeof i?i.id:i,a={type:t.type,action:t.action.update,id:o},r=new FileReader,s=!1,d=0;r.addEventListener("load",function(){s=!0,query(a,{chunk:r.result.split(",").pop()},function(i){s=!1,t.onprogress&&t.onprogress(d-1,e.size),d>e.size&&(clearInterval(n),t.onloadend&&t.onloadend(o))})},!1),n=setInterval(function(){if(!s&&1!=r.readyState){var i=d+t.portion;i>e.size&&(i=e.size),r.readAsDataURL(e.slice(d,++i)),d=i}},10)})}};define("elu/elu",function(){}),w2utils.unlockAll=function(){w2utils.unlock($("div.w2ui-lock").parent())},$.fn.w2reform=function(e){function t(){var e=$(this.box),t=this.record;eachAttr(e,"data-off",t,function(e,t,i){i?e.hide():e.show()}),eachAttr(e,"data-on",t,function(e,t,i){i?e.show():e.hide()}),refill(t,$(".w2ui-buttons",e))}function i(e){e.done(t)}function n(e){return e?function(t){e(t),i(t)}:i}return e.onRefresh=n(e.onRefresh),e.tabs&&(Array.isArray(e.tabs)&&(e.tabs={tabs:e.tabs}),e.onClick=n(e.onClick)),w2ui[e.name]&&w2ui[e.name].destroy(),this.w2form(e)},$.fn.w2regrid=function(e){return w2ui[e.name]&&w2ui[e.name].destroy(),e.url&&!e.onLoad&&(e.onLoad=dia2w2ui),$_REQUEST.id||"onDblClick"in e||(e.onDblClick=function(e){var t=this.get(e.recid);openTab("/"+$_REQUEST.type+"/"+(t.uuid||t.id))}),e.show||(e.show={}),"skipRecords"in e.show||(e.show.skipRecords=!1),$.each(e.columns,function(){var e=this,t=e.field,i=e.voc;i&&(this.render||(this.render=function(e){var n=e[t];return null==n&&(n=""),Array.isArray(n)?n.map(function(e){return i[e]}).sort().join(", "):i[n]||""}),this.editable&&(this.editable.items=i.items))}),this.w2grid(e)},$.fn.w2uppop=function(e,t){var i=this;return e.width=i.attr("data-popup-width"),e.height=i.attr("data-popup-height"),e.title=i.attr("data-popup-title"),e.onOpen=function(e){e.done(function(){t(e);var i=$("#w2ui-popup");i.keyup(function(e){if("Enter"==e.key&&e.ctrlKey&&!e.altKey&&!e.shiftKey){var t=$("button:first",i);t.focus(function(){t.click()}).focus()}})})},darn(e),this.w2popup("open",e)};var matchHtmlRegExp=/["'&<>]/;w2obj.grid.prototype.saveAsXLS=function(e){function t(e){var t=l.attr(e);t&&(a+=" "+e+"="+t)}function i(e){for(var t=0;t<e.length;t++){a+="<tr>";for(var i=e[t],n=0;n<r.length;n++){var o=r[n],s="function"==typeof o.render?o.render(i):i[o.field];null==s&&(s=""),a+="<td";var d=o.render;("money"==d||/^float/.test(d))&&(a+=" class=n",s=String(s).replace(".",",")),a+=">",/^\d+$/.test(i.recid)||(a+="<b>"),a+=escapeHtml(s)}}}function n(){var t=o.summary;t&&t.length&&i(t),a+="</table></body></html>",o.unlock(),a.saveAs(e)}var o=this;o.lock("Экспорт данных..."),e||(e=$("title").text()),e+=".xls";var a='<html><head><style>td{mso-number-format:"@"} td.n{mso-number-format:General}</style></head><body><table border>',r=o.columns.filter(function(e){return!e.hidden}),s=[[],[]];$("#grid_"+o.name+"_body div[class^=w2ui-col-]").each(function(){var e=$(this);if(e.text().trim().length){var t=e.hasClass("w2ui-col-group")?0:e.hasClass("w2ui-col-header")?1:-1;t>=0&&s[t].push(e.parent())}});for(var d=0;d<2;d++){var c=s[d];if(c.length){a+="<tr>";for(var u=0;u<c.length;u++){var l=c[u];a+="<th",d||(t("colspan"),t("rowspan")),a+=">"+escapeHtml(l.text())}}}if(i(o.records),!o.url||!o.last.xhr_hasMore)return n();var _={cmd:"get",selected:[],limit:o.limit,offset:o.records.length,search:o.searchData,searchLogic:o.last.logic,sort:o.sortData},p={type:"POST",url:o.url,dataType:"text",contentType:"application/json"},f=!1,m=setInterval(function(){if(!f){if(_.offset>=o.total)return clearInterval(m),n();f=!0,p.data=JSON.stringify(_),$.ajax(p).done(function(e,t,n){var a={xhr:n};o.onLoad(a);var r=JSON.parse(a.xhr.responseText);i(r.records),_.offset+=r.records.length,$("div.w2ui-lock-msg").text(Math.round(100*_.offset/o.total)+"%..."),f=!1})}},100)},w2obj.form.prototype.values=function(){var e={},t=this.record;return $.each(this.fields,function(){var i=this,n=i.name;e[n]=normalizeValue(t[n],i.type)}),e};var _do_apologize=$_DO.apologize;$_DO.apologize=function(e,t){w2utils.unlockAll(),_do_apologize(e,t)},define("elu_w2ui/elu_w2ui",function(){}),window.__LOGOUT__&&delete window.__LOGOUT__,requirejs.config({baseUrl:sessionStorage.getItem("staticRoot")+"/libs",paths:{app:"../app/js"}}),$.fn.w2relayout=function(e){return w2ui[e.name]&&w2ui[e.name].destroy(),this.w2layout(e)},$.fn.w2residebar=function(e){return w2ui[e.name]&&w2ui[e.name].destroy(),this.w2sidebar(e)},w2utils.settings={weekStarts:"M",dataType:"JSON",locale:"ru-RU",dateFormat:"dd.mm.yyyy",timeFormat:"h24",currency:"^[-+]?[0-9]*[\\,]?[0-9]+$",currencyPrefix:"",currencySuffix:" р.",currencyPrecision:2,decimalSymbol:",",groupSymbol:" ",float:"^[-]?[0-9]*[\\.]?[0-9]+$",shortmonths:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],fullmonths:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],shortdays:["П","В","С","Ч","П","С","В"],fulldays:["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],phrases:{"Add new record":"Добавить новую запись","Add New":"Добавить","All Fields":"Все поля","Are you sure you want to delete selected records?":"Вы действительно хотите удалить выделенные записи?","Attach files by dragging and dropping or Click to Select":"Перетащите файлы сюда или нажмите чтобы выбрать","begins with":"начинается с",begins:"начинается",before:"до (включительно)",after:"начиная с",between:"между",buffered:"буфер","Clear Search":"Очистить поиск",Column:"Колонка",Confirmation:"Подтверждение",contains:"содержит","Delete Confirmation":"Подтверждение удаления","Delete selected records":"Удалить выбранные записи",Delete:"Удалить","Edit selected record":"Изменить выделенную запись",Edit:"Изменить","Empty list":"Пустой список","ends with":"заканчивается на",ends:"заканчивается",Hide:"Скрыть",in:"в списке",is:"равняется","Loading...":"Загрузка...","Multi Fields":"Несколько полей","Multiple Fields":"Несколько полей","more than":"более или ровно","less than":"менее или ровно",Name:"Имя",Size:"Размер",Type:"Тип",Modified:"Дата изменения","No items found":"Ничего не найдено",No:"Нет",none:"пусто","not null":"не пусто",null:"пусто","Not a float":"Не натуральное число","Not a hex number":"Не шестнадцатеричное число","Not a valid date":"Неверный формат","Not a valid email":"Неверный e-mail","Not alpha-numeric":"Не буквенно-цифровой текст","Not an integer":"Не целое число","Not in money format":"Не денежный формат","not in":"не в списке",Notification:"Уведомление",of:"из",Ok:"OK","Open Search Fields":"Открыть поля поиска","Record ID":"Запись",Records:"Записей","Refreshing...":"Обновление...","Reload data in the list":"Обновить список",Remove:"Удалить","Required field":"Обязательное поле","Reset Column Size":"Восстановить размер колонок",Reset:"Очистить","Return data is not in JSON format. See console for more information.":"Возвращенные данные не в формате JSON. Смотрите в консоли ошибки.","Save changed records":"Сохранить измененные записи",Save:"Сохранить","Saving...":"Сохранение","Search took":"Поиск занял",Search:"Поиск","Search...":"Поиск...",sec:"сек","Select Search Field":"Выбрать поля поиска",selected:"выделено","Server Response":"Ответ сервера",Show:"Показать","Show/hide columns":"Показать/скрыть колонки",Skip:"Пропустить","Sorting took":"Сортировка заняла","Toggle Line Numbers":"Вкл/Выкл. номера строк",Yes:"Да",Yesterday:"Вчера","Line #":"Номер строки #","Save Grid State":"Сохранить состояние таблицы","Restore Default State":"Восстановить состояние таблицы","Type to search...":"Введите строку поиска...","Your remote data source record count has changed, reloading from the first record.":"Данные изменены на сервере. Пожалуйста, перезагрузите страницу"}};var base_href="/mosgis";requirejs(["elu/elu","elu_w2ui/elu_w2ui"],function(e,t,i){var n=redirect;if(redirect=function(e){n(base_href+e)},clearTimeout(window.alarm),$_SESSION.beforeExpiry($_SESSION.keepAlive),window.addEventListener("storage",$_SESSION.closeAllOnLogout),$_USER&&($_USER.has_nsi_20=function(){for(var e=0;e<arguments.length;e++)if($_USER.role["nsi_20_"+arguments[e]])return!0;return!1}),$_USER&&$_USER.opt&&$_USER.opt.no_tabs)openTab=function(e,t){e=base_href+e,window.name=t||e,location=e};else{var o=openTab;openTab=function(e,t){o(base_href+e,t)}}setup_request(),use.block($_REQUEST.type||"main")}),define("../app/handler",function(){}),define("app/data/add_service_common_log",[],function(){return function(e){var t=w2ui.passport_layout;t&&t.unlock("main"),e($("body").data("data"))}}),define("app/data/add_service_common",[],function(){var e="add_service_common_form";return $_DO.cancel_add_service_common=function(t){if(confirm("Отменить несохранённые правки?")){w2ui[e].record;query({type:"add_services"},{},function(e){e.__read_only=!0,$_F5(e)})}},$_DO.edit_add_service_common=function(t){var i={item:w2ui[e].record};10==i.item.id_status&&die("foo","В настоящий момент данная запись передаётся в ГИС ЖКХ. Операция отменена."),i.__read_only=!1;w2ui[e];$_F5(i)},$_DO.update_add_service_common=function(t){if(confirm("Сохранить изменения?")){var i=w2ui[e],n=i.values();n.additionalservicetypename||die("additionalservicetypename","Укажите, пожалуйста, наименование услуги"),n.okei||die("okei","Укажите, пожалуйста, единицы измерения"),query({type:"add_services",action:"update"},{data:n},reload_page)}},$_DO.delete_add_service_common=function(e){confirm("Удалить эту запись, Вы уверены?")&&query({type:"add_services",action:"delete"},{},reload_page)},$_DO.undelete_add_service_common=function(e){confirm("Восстановить эту запись, Вы уверены?")&&query({type:"add_services",action:"undelete"},{},reload_page)},$_DO.choose_tab_add_service_common=function(e){var t=e.tab.id,i=w2ui.passport_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("add_service_common.active_tab",t),use.block(t)},function(e){w2ui.topmost_layout.unlock("main");var t=clone($("body").data("data"));t.active_tab=localStorage.getItem("add_service_common.active_tab")||"add_service_common_log",t.__read_only=1,$_USER.role.admin&&(t.item.org_label=t.item["vc_orgs.label"]),t.item.status_label=t.vc_async_entity_states[t.item.id_status],t.item.err_text=t.item["out_soap.err_text"],t.item._can=$_USER.role.admin?{}:{edit:1-t.item.is_deleted,update:1,cancel:1,delete:1-t.item.is_deleted},e(t)}}),define("app/data/add_service_popup",[],function(){return $_DO.update_add_service_popup=function(e){var t=w2ui.voc_user_form,i=t.values();i.additionalservicetypename||die("additionalservicetypename","Укажите, пожалуйста, наименование услуги"),i.okei||die("okei","Укажите, пожалуйста, единицы измерения");var n={type:"add_services"};n.id=t.record.id,n.action=n.id?"update":"create";var o=w2ui.add_services_grid;query(n,{data:i},function(){w2popup.close(),o.reload(o.refresh)})},function(e){var t=clone($("body").data("data"));t.record=$_SESSION.delete("record"),e(t)}}),define("app/data/add_service",[],function(){return $_DO.choose_tab_add_service=function(e){var t=e.tab.id,i=w2ui.topmost_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("add_service.active_tab",t),use.block(t)},function(e){query({type:"add_services",part:"vocs",id:void 0},{},function(t){add_vocabularies(t,t),query({type:"add_services"},{},function(i){t.item=i.item,$("body").data("data",t),e(t)})})}}),define("app/data/add_services",[],function(){function e(e){var t=w2ui.add_services_grid,i=t.getSelection()[0];query({type:"add_services",id:i,action:e},{},function(){t.reload(function(){t.refresh(),t.selectNone(),t.select(i)})})}return $_DO.delete_add_services=function(){confirm("Удалить эту запись?")&&e("delete")},$_DO.undelete_add_services=function(t){confirm("Восстановить эту запись?")&&e("undelete")},$_DO.create_add_services=function(e){$_SESSION.set("record",{}),use.block("add_service_popup")},$_DO.edit_add_services=function(e){var t=w2ui[e.target],i=t.get(e.recid);10==i.id_status&&die("foo","В настоящий момент данная запись передаётся в ГИС ЖКХ. Операция отменена."),$_SESSION.set("record",i),use.block("add_service_popup")},function(e){var t=w2ui.vocs_layout;t&&t.unlock("main"),query({type:"add_services",part:"vocs",id:void 0},{},function(t){add_vocabularies(t,t),$("body").data("data",t),e(t)})}}),define("app/data/admin",[],function(){return $_DO.choose_tab_admin=function(e){var t=w2ui.admin_layout;t&&(t.content("main",""),t.lock("main","Загрузка...",!0));var i=e.tab.id;localStorage.setItem("admin.active_tab",i),use.block(i)},function(e){var t={};t.active_tab=localStorage.getItem("admin.active_tab")||"vc_rd_1",e(t)}}),define("app/data/annul_popup",[],function(){return $_DO.cancel_annul_popup=function(e){w2popup.close(),alert("Операция отменена")},$_DO.update_annul_popup=function(e){if(confirm("Внести запись об аннулировании объекта?")){var t=w2ui.annul_popup_form,i=t.values();i.terminationdate||die("terminationdate","Необходимо указать дату аннулирования"),i.code_vc_nsi_330||die("code_vc_nsi_330","Необходимо указать причину аннулирования");query($_SESSION.delete("tia")||{type:getPluralType(),id:$_REQUEST.id,action:"update"},{data:i},reload_page)}},function(e){var t=clone($("body").data("data"));t.record={terminationdate:dt_dmy((new Date).toISOString().substr(0,10))},e(t)}}),define("app/data/block_common_living_rooms",[],function(){return $_DO.create_block_common_living_rooms=function(e){$("body").data("data").item.is_annuled&&die("foo","Создание вложенных объектов запрещено, так как данная запись аннулирована"),$_SESSION.set("record",{}),use.block("living_room_popup")},$_DO.delete_block_common_living_rooms=function(e){e.force&&($(".w2ui-message").remove(),e.preventDefault(),query({type:"living_rooms",id:w2ui[e.target].getSelection()[0].recid,action:"delete"},{},reload_page))},$_DO.patch_block_common_living_rooms=function(e){
var t=this,i=t.columns[e.column],n={k:i.field,v:normalizeValue(e.value_new,i.editable.type)};"premisesnum"==n.k&&$.each(t.records,function(){this.terminationdate||this.id!=e.recid&&this.premisesnum==n.v&&(e.preventDefault(),die("foo","Блок с таким номером уже зарегистрирован"))}),null!=n.v&&(n.v=String(n.v)),t.lock();var o={type:"living_rooms",action:"update",id:e.recid},a={};a[n.k]=n.v,query(o,{data:a},function(){t.unlock(),t.reload()},edit_failed(t,e))},function(e){w2ui.passport_layout.unlock("main");var t=$("body").data("data"),i=t.item;t.vc_blocks=[{id:i.uuid,label:i.blocknum}],add_vocabularies(t,{vc_blocks:1}),$("body").data("data",t),get_nsi([261,273],e)}}),define("app/data/block_common",[],function(){var e="block_common_form";return $_DO.restore_block_common=function(e){confirm("Удалить запись об аннулировании объекта?")&&query({type:"blocks",id:$_REQUEST.id,action:"update"},{data:{terminationdate:null,annulmentinfo:null,code_vc_nsi_330:null}},reload_page)},$_DO.annul_block_common=function(e){use.block("annul_popup")},$_DO.cancel_block_common=function(t){if(confirm("Отменить несохранённые правки?")){w2ui[e].record;query({type:"blocks"},{},function(e){e.__read_only=!0,$_F5(e)})}},$_DO.edit_block_common=function(t){var i={item:w2ui[e].record};if(i.item.is_annuled)return alert("Поскольку данный объект жилого фонда аннулирован, редактирование невозможно."),t.preventDefault();i.__read_only=!1;w2ui[e];$_F5(i)},$_DO.update_block_common=function(t){if(confirm("Сохранить изменения?")){var i=w2ui[e],n=i.values();null!=n.blocknum&&""!=n.blocknum||die("blocknum","Укажите, пожалуйста, номер блока"),/[0-9А-ЯЁа-яёA-Za-z]/.test(n.blocknum)||die("blocknum","Некорректный номер блока"),0!=n.is_nrs||n.code_vc_nsi_30||die("code_vc_nsi_30","Необходимо указать характеристику блока"),parseFloat(n.totalarea||"0")<.01&&die("totalarea","Необходимо указать размер общей плошади"),0==n.is_nrs&&parseFloat(n.grossarea||"0")<.01&&die("grossarea","Необходимо указать размер жилой плошади"),query({type:"blocks",action:"update"},{data:n},reload_page)}},$_DO.choose_tab_block_common=function(e){var t=e.tab.id,i=w2ui.passport_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("block_common.active_tab",t),use.block(t)},function(e){w2ui.topmost_layout.unlock("main");var t=clone($("body").data("data"));t.active_tab=localStorage.getItem("block_common.active_tab")||"block_common_living_rooms",t.__read_only=1,t.item._can={edit:1,update:1,cancel:1,annul:1-t.item.is_annuled,restore:t.item.is_annuled},t.item.cat=t.item.is_nrs?"Нежилое помещение":"Жилое помещение",e(t)}}),define("app/data/block_invalid",[],function(){var e="block_invalid_form";return $_DO.download_block_invalid=function(t){function i(e,t){return String(Math.round(100*e/t))+"%"}var n=w2ui[e].box;w2utils.lock(n,i(0,1)),download({type:"house_docs",id:$("body").data("data").file.uuid,action:"download"},{},{onprogress:function(e,t){$(".w2ui-lock-msg").html("<br><br>"+i(e,t))},onload:function(){w2utils.unlock(n)}})},$_DO.cancel_block_invalid=function(t){if(confirm("Отменить несохранённые правки?")){w2ui[e].record;query({type:"blocks"},{},function(e){e.__read_only=!0,$_F5(e)})}},$_DO.edit_block_invalid=function(t){var i={item:w2ui[e].record};if(i.item.is_annuled)return alert("Поскольку данный объект жилого фонда аннулирован, редактирование невозможно."),t.preventDefault();i.__read_only=!1;w2ui[e];$_F5(i)},$_DO.update_block_invalid=function(t){function i(){$.each(a.file,function(){Base64file.upload(this.file,y)})}if(confirm("Сохранить изменения?")){var n=w2ui[e],o=n.values();if(o.file){var a=n.record;if(a.f_20127||die("f_20127","Укажите, пожалуйста, основание признания данного помещения непригодным для проживания"),!a.f_20128)return $("input[name=f_20128]").focus(),alert("Укажите, пожалуйста, дату документа");if(!/^\d\d\.\d\d\.\d\d\d\d$/.test(a.f_20128))return $("input[name=f_20128]").focus(),alert("Некорректная дата документа");if(!a.f_20129)return $("input[name=f_20129]").focus(),alert("Укажите, пожалуйста, номер документа");if(!a.file||0==a.file.length)return $("input[name=file]").focus(),alert("Вы не указали файл");for(var r=a.file.length,s={pdf:1,doc:1,docx:1,rtf:1,xls:1,xlsx:1,jpg:1,jpeg:1},d=0,c=0;c<r;c++){var u=a.file[c].file,l=u.name;if(l.length>255)return alert("Некорректное имя файла: "+l+". Согласно требованиям ГИС ЖКХ, его длина не может превышать 255 символов");var _=l.split(".");if(_.length<2)return alert("Некорректное имя файла: "+l+" (невозможно определить расширение)");if(!s[_[_.length-1]]){var p=[];for(var t in s)p.push(t);return alert("Некорректное имя файла: "+l+".\n\nСогласно требованиям ГИС ЖКХ, разрешены следующие: "+p.sort().join(", ")+".")}if(u.size>10485760)return alert("Файл "+l+" имеет недопустимо большой объём. Согласно требованиям ГИС ЖКХ, его величина не может превышать 10 Мб.");d+=u.size}$(".w2ui-buttons button").hide();var f=$("progress");f.prop({max:d,value:0}).show();var m=0;n.lock();var v=($("body").data("data"),{uuid:$_REQUEST.id,no:o.f_20129,dt:o.f_20128,id_file_type:"20820",note:"",ref:"uuid_block"}),r=a.file.length,h=setInterval(function(){r||(clearInterval(h),$_DO.apologize=$.noop,query({type:"blocks",action:"update"},{data:{f_20127:o.f_20127}},reload_page))},100),y={data:v,type:"house_docs",onprogress:function(e,t){m+=131072,f.val(m)},onloadend:function(){r--}},u=$("body").data("data").file;u?query({type:"house_docs",id:u.uuid,action:"delete"},{},i):i()}else query({type:"blocks",action:"update"},{data:o},reload_page)}},function(e){w2ui.topmost_layout.unlock("main");var t=$("body").data("data");t.__read_only=1,e(t)}}),define("app/data/block_passport",[],function(){return $_DO.patch_block_passport=function(e){var t=this,i=t.columns[e.column],n=i.editable(t.get(e.recid)),o={k:"f_"+e.recid,v:normalizeValue(e.value_new,n.type)};null!=o.v&&(o.v=String(o.v)),t.lock();var a={type:"blocks",action:"update"},r={};r[o.k]=o.v||null,query(a,{data:r},function(){var e=$("body").data("data");if(e.item[o.k]=o.v,$("body").data("data",e),"f_20126"==o.k){var i=w2ui.topmost_layout.get("main").tabs,n="block_invalid";0==o.v?query({type:"blocks",action:"update"},{data:{f_20127:null,f_20128:null,f_20129:null}},function(){e.file?query({type:"house_docs",id:e.file.uuid,action:"delete"},{},reload_page):reload_page()}):(t.unlock(),i.show(n),$_F5(),confirm("Перейти ко вводу документа о непригодности для проживания?")&&i.click(n))}else t.unlock(),$_F5()})},function(e){var t=$("body").data("data");t.doc_fields={},query({type:"blocks",part:"passport_fields"},{},function(n){var o="is_for_premise_"+(t.item.is_nrs?"nrs":"res"),a=n.vc_pass_fields.filter(function(e){return e[o]}),r={};$.each(a,function(){if(this.recid=this.id,this.name="f_"+this.id,this.value=t.item[this.name],this.is_mandatory&&(this.w2ui={class:"status_warning"}),this.voc){var e="vc_nsi_"+this.voc;n[e]&&(r[e]=1)}3==this.id_type&&(t.doc_fields[this.id]=1,t.doc_fields[this.id_dt]=1,t.doc_fields[this.id_no]=1)}),add_vocabularies(n,r);for(i in r)t[i]=n[i];t.vc_pass_fields=a,$("body").data("data",t),e(t)}),w2ui.topmost_layout.unlock("main")}}),define("app/data/block_popup",[],function(){return $_DO.update_block_popup=function(e){var t=w2ui.block_new_form,n=t.values();null!=n.blocknum&&""!=n.blocknum||die("blocknum","Укажите, пожалуйста, номер блока"),/[0-9А-ЯЁа-яёA-Za-z]/.test(n.blocknum)||die("blocknum","Некорректный номер блока"),parseFloat(n.totalarea||"0")<.01&&die("totalarea","Необходимо указать размер общей плошади"),"0"==n.is_nrs&&(n.code_vc_nsi_30||die("code_vc_nsi_30","Необходимо указать характеристику помещения"),parseFloat(n.grossarea||"0")<.01&&die("grossarea","Необходимо указать размер жилой плошади"),n.f_20002||die("f_20002","Необходимо указать количество комнат"));var o={type:"blocks"};o.id=t.record.id,o.action=o.id?"update":"create","create"==o.action&&(n.uuid_house=$_REQUEST.id);var a={f_20053:1,f_20054:1,f_20056:1};for(i in a)n[i]=n[i]?[n[i]]:[];query(o,{data:n},reload_page)},function(e){var t=clone($("body").data("data"));t.record=$_SESSION.get("record"),sessionStorage.removeItem("record"),e(t)}}),define("app/data/block",[],function(){return $_DO.choose_tab_block=function(e){var t=e.tab.id,i=w2ui.topmost_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("block.active_tab",t),use.block(t)},function(e){query({type:"blocks"},{},function(t){add_vocabularies(t,{tb_entrances:1,vc_nsi_14:1,vc_nsi_30:1,vc_nsi_273:1,vc_nsi_330:1}),t.item.label="№ "+t.item.blocknum,t.item.address=t.item["tb_houses.address"],$("body").data("data",t),e(t)})}}),define("app/data/entrance_new",[],function(){return $_DO.update_entrance_new=function(e){var t={};$.each(w2ui.house_passport_entrances_grid.records,function(){t[this.entrancenum]=1}),w2ui.entrance_new_popup_form.values();var i=w2ui.entrance_new_popup_form.values().no;null==i&&(i="");var n=i.trim().split(/[\s\,\;]+/).filter(function(e){return e.length>0});0==n.length&&die("no","Укажите, пожалуйста, хотя бы один номер подъезда");var o={};$.each(n,function(){o[this]=1+(0|o[this])}),n=[];for(i in o)t[i]&&die("no","Подъезд №"+i+" уже зарегистрирован для данного дома"),o[i]>1&&die("no","Вы указали №"+i+" более одного раза"),n.push(i);query({type:"entrances",id:null,action:"create"},{data:{uuid_house:$_REQUEST.id,nos:n}},reload_page)},function(e){e($("body").data("data"))}}),define("app/data/entrance_popup",[],function(){return $_DO.update_entrance_popup=function(e){var t=w2ui.entrance_popup_form,i=t.values();i.entrancenum||die("entrancenum","Номер подъезда не может быть пустой строкой"),query({type:"entrances",id:t.record.id,action:"update"},{data:i},reload_page)},function(e){var t=$("body").data("data"),i=w2ui.house_passport_entrances_grid;t.entrance=i.get(i.getSelection()[0]),t.entrance.terminationdate&&(t.entrance.terminationdate=dt_dmy(t.entrance.terminationdate.substr(0,10))),e(t)}}),define("app/data/house_address",[],function(){return function(e){w2ui.topmost_layout.unlock("main");var t=$("body").data("data"),n=t.item;for(i in n)i.indexOf(".")>=0&&(n[i.replace(".","_")]=n[i]);e(t)}}),define("app/data/house_common",[],function(){return $_DO.patch_house_common=function(e){var t=this,i=t.columns[e.column],n=i.editable(t.get(e.recid)),o={k:"f_"+e.recid,v:normalizeValue(e.value_new,n.type)};null!=o.v&&(o.v=String(o.v)),t.lock();var a={type:"houses",action:"patch"};query(a,{data:o},function(){var i=$("body").data("data");i.item[o.k]=o.v;var n=i.depends,r=[];for(var s in n)n[s]==e.recid&&r.push(s);r.length&&1!=o.v&&$.each(r,function(){var e="f_"+this;i.item[e]&&(delete i.item[e],query(a,{data:{k:e,v:null}},$.noop))}),$("body").data("data",i),$("body").data("area_codes")[e.recid]&&setTimeout($_DO.check_sum_area_fields_of_a_house,400),t.unlock(),$_F5()})},function(e){var t=$("body").data("data");t.doc_fields={},query({type:"houses",part:"passport_fields_common"},{},function(n){var o=n.vc_pass_fields,a={};$.each(o,function(){if(this.recid=this.id,this.name="f_"+this.id,this.value=t.item[this.name],this.is_mandatory&&(this.w2ui={class:"status_warning"}),this.voc){var e="vc_nsi_"+this.voc;n[e]&&(a[e]=1)}3==this.id_type&&(t.doc_fields[this.id]=1,t.doc_fields[this.id_dt]=1,t.doc_fields[this.id_no]=1)}),add_vocabularies(n,a);for(i in a)t[i]=n[i];t.vc_pass_fields=o,$("body").data("data",t),e(t)}),w2ui.topmost_layout.unlock("main")}}),define("app/data/house_constr",[],function(){return $_DO.patch_house_constr=function(e){var t=this,i=t.columns[e.column],n=i.editable(t.get(e.recid)),o={k:"f_"+e.recid,v:normalizeValue(e.value_new,n.type)};null!=o.v&&(o.v=String(o.v)),t.lock(),query({type:"houses",action:"patch"},{data:o},function(){var i=$("body").data("data");i.item[o.k]=o.v,$("body").data("data",i),$("body").data("area_codes")[e.recid]&&setTimeout($_DO.check_sum_area_fields_of_a_house,400),t.unlock(),$_F5()})},function(e){var t=$("body").data("data");t.doc_fields={},query({type:"houses",part:"passport_fields_constr"},{},function(n){var o=n.vc_pass_fields,a={};$.each(o,function(){if(this.recid=this.id,this.name="f_"+this.id,this.value=t.item[this.name],this.is_mandatory&&(this.w2ui={class:"status_warning"}),this.voc){var e="vc_nsi_"+this.voc;n[e]&&(a[e]=1)}3==this.id_type&&(t.doc_fields[this.id]=1,t.doc_fields[this.id_dt]=1,t.doc_fields[this.id_no]=1)}),add_vocabularies(n,a);for(i in a)t[i]=n[i];t.vc_pass_fields=o,$("body").data("data",t),e(t)}),w2ui.topmost_layout.unlock("main")}}),define("app/data/house_doc_new",[],function(){return $_DO.update_house_doc_new=function(e){var t=w2ui.house_doc_new_form.record;if(!t.file_type)return $("input[name=file_type]").focus(),alert("Укажите, пожалуйста, тип документа");if(!t.dt)return $("input[name=dt]").focus(),alert("Укажите, пожалуйста, дату документа");if(!/^\d\d\.\d\d\.\d\d\d\d$/.test(t.dt))return $("input[name=dt]").focus(),alert("Некорректная дата документа");if(!t.no)return $("input[name=no]").focus(),alert("Укажите, пожалуйста, номер документа");if(!t.files||0==t.files.length)return $("input[name=files]").focus(),alert("Вы не указали файл");null==t.note&&(t.note="");for(var i=t.files.length,n={pdf:1,doc:1,docx:1,rtf:1,xls:1,xlsx:1,jpg:1,jpeg:1},o=0,a=0;a<i;a++){var r=t.files[a].file,s=r.name;if(s.length>255)return alert("Некорректное имя файла: "+s+". Согласно требованиям ГИС ЖКХ, его длина не может превышать 255 символов");var d=s.split(".");if(d.length<2)return alert("Некорректное имя файла: "+s+" (невозможно определить расширение)");if(!n[d[d.length-1]]){var c=[];for(var e in n)c.push(e);return alert("Некорректное имя файла: "+s+".\n\nСогласно требованиям ГИС ЖКХ, разрешены следующие: "+c.sort().join(", ")+".")}if(r.size>10485760)return alert("Файл "+s+" имеет недопустимо большой объём. Согласно требованиям ГИС ЖКХ, его величина не может превышать 10 Мб.");o+=r.size}$("#w2ui-popup button").hide();var u=$("#w2ui-popup progress");u.prop({max:o,value:0}).show();var l=0;w2utils.lock($("#w2ui-popup .w2ui-page"));var _=($("body").data("data"),{uuid:$_REQUEST.id,no:t.no,dt:normalizeValue(t.dt,"date"),note:t.note,id_file_type:t.file_type.id}),i=t.files.length,p=setInterval(function(){i||(clearInterval(p),$_DO.apologize=$.noop,sessionStorage.setItem("__house_doc_added",1),location.reload())},100),f={data:_,type:"house_docs",onprogress:function(e,t){l+=131072,u.val(l)},onloadend:function(){i--}};$.each(t.files,function(){Base64file.upload(this.file,f)})},function(e){e($("body").data("data"))}}),define("app/data/house_doc_popup",[],function(){return $_DO.download_house_doc_popup=function(e){function t(e,t){return String(Math.round(100*e/t))+"%"}var i=$("#w2ui-popup");w2utils.lock(i,t(0,1)),download({type:"house_docs",id:w2ui.house_doc_popup_form.record.id,action:"download"},{},{onprogress:function(e,i){$(".w2ui-lock-msg").html("<br><br>"+t(e,i))},onload:function(){w2utils.unlock(i)}})},$_DO.update_house_doc_popup=function(e){var t=w2ui.house_doc_popup_form,i=t.record;if(!i.dt)return $("input[name=dt]").focus(),alert("Укажите, пожалуйста, дату документа");if(!/^\d\d\.\d\d\.\d\d\d\d$/.test(i.dt))return $("input[name=dt]").focus(),alert("Некорректная дата документа");if(!i.no)return $("input[name=no]").focus(),alert("Укажите, пожалуйста, номер документа");var i=t.values();null==i.note&&(i.note=""),query({type:"house_docs",action:"edit",id:t.record.id},{data:i},reload_page)},function(e){var t=w2ui.house_docs_grid,i=t.getSelection()[0],n=t.get(i),o=$("body").data("data"),a=o.doc_fields.items.filter(function(e){return e.id==n.id_type})[0];n.dt=dt_dmy(o.item["f_"+a.id_dt].substr(0,10)),n.no=o.item["f_"+a.id_no],e(n)}}),define("app/data/house_docs",[],function(){return $_DO.edit_house_docs=function(e){use.block("house_doc_popup")},$_DO.create_house_docs=function(e){if(0==$("body").data("data").doc_fields.items.filter(not_off).length)return alert("Документы всех типов, доступных для этого дома, уже добавлены");use.block("house_doc_new")},$_DO.download_house_docs=function(e){function t(e,t){return String(Math.round(100*e/t))+"%"}var i=$("body");this.get(e.recid);w2utils.lock(i,t(0,1)),download({type:"house_docs",id:e.recid,action:"download"},{},{onprogress:function(e,i){$(".w2ui-lock-msg").html("<br><br>"+t(e,i))},onload:function(){w2utils.unlock(i)}})},$_DO.delete_house_docs=function(e){e.force&&($(".w2ui-message").remove(),e.preventDefault(),query({type:"house_docs",id:w2ui[e.target].getSelection()[0],action:"delete"},{},reload_page))},function(e){w2ui.topmost_layout.unlock("main");var t=$("body").data("data"),i=[];query({type:"houses",part:"passport_fields_common"},{},function(n){$.each(n.vc_pass_fields,function(){if(3==this.id_type){t.item["f_"+this.id_dt]&&(this.off=1);var e=t.depends[this.id];e&&0==t.item["f_"+e]&&(this.off=1),i.push(this)}}),t.doc_fields=i,add_vocabularies(t,{doc_fields:1}),$.each(t.doc_fields.items,function(){this.text=this.doc_label}),$("body").data("data",t),e(t)})}}),define("app/data/house_living_rooms",[],function(){return $_DO.create_house_living_rooms=function(e){var t=$("body").data("data");t.item.hasblocks&&!t.vc_blocks.items.length&&die("foo","Данный жилой дом относится к блокированной застройке, однако сейчас не зарегистрировано ни одного его блока. Операция отменена."),$_SESSION.set("record",{}),use.block("living_room_popup")},$_DO.delete_house_living_rooms=function(e){e.force&&($(".w2ui-message").remove(),e.preventDefault(),query({type:"living_rooms",id:w2ui[e.target].getSelection()[0].recid,action:"delete"},{},reload_page))},$_DO.patch_house_living_rooms=function(e){var t=this,i=t.columns[e.column],n={k:i.field,v:normalizeValue(e.value_new,i.editable.type)};null!=n.v&&(n.v=String(n.v)),t.lock();var o={type:"living_rooms",action:"update",id:e.recid},a={};a[n.k]=n.v,query(o,{data:a},function(){t.unlock(),t.reload()},edit_failed(t,e))},function(e){function t(){get_nsi([261,273],e)}w2ui.topmost_layout.unlock("main");var n=$("body").data("data");n.item.is_condo?query({type:"premises_residental",id:void 0},{data:{uuid_house:$_REQUEST.id}},function(e){var o={vc_premises:e.tb_premises_res.map(function(e){return{id:e.uuid,label:e.premisesnum,fake:"2"!=e.code_vc_nsi_30||e.is_deleted||e.is_annuled}})};add_vocabularies(o,o);for(i in o)n[i]=o[i];t()}):query({type:"blocks",id:void 0},{data:{uuid_house:$_REQUEST.id}},function(e){var o={vc_blocks:e.tb_blocks.map(function(e){return{id:e.uuid,label:e.blocknum,fake:e.is_nrs||e.is_deleted||e.is_annuled}})};add_vocabularies(o,o);for(i in o)n[i]=o[i];t()})}}),define("app/data/house_passport_blocks",[],function(){return $_DO.create_house_passport_blocks=function(e){$_SESSION.set("record",{is_nrs:"0",code_vc_nsi_30:"1"}),use.block("block_popup")},$_DO.delete_house_passport_blocks=function(e){e.force&&($(".w2ui-message").remove(),e.preventDefault(),query({type:"blocks",id:w2ui[e.target].getSelection()[0].recid,action:"delete"},{},reload_page))},$_DO.patch_house_passport_blocks=function(e){var t=this,i=t.columns[e.column],n={k:i.field,v:normalizeValue(e.value_new,i.editable.type)};"premisesnum"==n.k&&$.each(t.records,function(){this.terminationdate||this.id!=e.recid&&this.premisesnum==n.v&&(e.preventDefault(),die("foo","Блок с таким номером уже зарегистрирован"))}),null!=n.v&&(n.v=String(n.v)),t.lock();var o={type:"blocks",action:"update",id:e.recid},a={};a[n.k]=n.v,query(o,{data:a},function(){t.unlock(),t.reload()},edit_failed(t,e))},function(e){var t=w2ui.passport_layout;t&&t.unlock("main");var i=$("body").data("data");i.vc_is_nrs=[{id:"0",label:"Жилое помещение"},{id:"1",label:"Нежилое помещение"}],add_vocabularies(i,{vc_is_nrs:1}),$("body").data("data",i),get_nsi([17,14,30,254,253,261,259,258],e)}}),define("app/data/house_passport_entrances",[],function(){function e(){return w2ui.house_passport_entrances_grid}function t(){return e().getSelection()[0]}function i(){return{type:"entrances",id:t(),action:"update"}}return $_DO.edit_house_passport_entrances=function(i){e().get(t()).terminationdate&&die("foo","Редактирование аннулированных записей запрещено."),use.block("entrance_popup")},$_DO.annul_house_passport_entrances=function(e){$_SESSION.set("tia",i()),use.block("annul_popup")},$_DO.restore_house_passport_entrances=function(e){confirm("Отменить аннулирование записи?")&&query(i(),{data:{terminationdate:null,annulmentinfo:null,code_vc_nsi_330:null}},reload_page)},$_DO.delete_house_passport_entrances=function(e){var t=w2ui[e.target],i=t.getSelection()[0],n=t.get(i);if(e.force)$(".w2ui-message").remove(),e.preventDefault(),query({type:"entrances",id:i,action:"delete"},{},reload_page);else for(code in $("body").data("data").vc_nsi_192)if("items"!=code&&n["cnt_"+code]>0)return e.preventDefault(),alert("Пока к подъезду относится хотя бы один лифт, удаление невозможно")},$_DO.patch_house_passport_entrances=function(e){var t=this,i=t.columns[e.column];if(i._is_lift){var n=e.value_original;n||(n=0);var o=parseInt(e.value_new)-parseInt(n);if(o<0)return alert("Удалять лифты можно только на соответствующей вкладке"),e.preventDefault();if(o>0){var a="ов";if(o<11||o>20){var r=o%10;r&&r<5&&(a=1==r?"":"а")}query({type:"lifts",action:"add",id:void 0},{data:{uuid_entrance:e.recid,code_vc_nsi_192:i.field.substr(4),cnt:o}},function(){alert("Добавлен"+(o>1?"о ":" ")+o+" лифт"+a+'. Для отправки сведений в ГИС ЖКХ необходимо перейти на вкладку "Лифты", с целью заполнения всех обязательных полей.'),t.unlock(),t.reload()})}}else{var s={k:i.field,v:normalizeValue(e.value_new,i.editable.type)};null!=s.v&&(s.v=String(s.v)),t.lock();var d={};d[s.k]=s.v,query({type:"entrances",action:"update",id:e.recid},{data:d},function(){t.unlock(),t.reload()},edit_failed(t,e))}},function(e){var t=w2ui.passport_layout;t&&t.unlock("main"),get_nsi([330],e)}}),define("app/data/house_passport_lifts",[],function(){function e(){return w2ui.house_passport_lifts_grid}function t(){return e().getSelection()[0]}function i(){return{type:"lifts",id:t(),action:"update"}}return $_DO.edit_house_passport_lifts=function(i){e().get(t()).terminationdate&&die("foo","Редактирование аннулированных записей запрещено."),use.block("lift_popup")},$_DO.annul_house_passport_lifts=function(e){$_SESSION.set("tia",i()),use.block("annul_popup")},$_DO.restore_house_passport_lifts=function(e){confirm("Отменить аннулирование записи?")&&query(i(),{data:{terminationdate:null,annulmentinfo:null,code_vc_nsi_330:null}},reload_page)},$_DO.delete_house_passport_lifts=function(e){e.force&&($(".w2ui-message").remove(),e.preventDefault(),query({type:"lifts",id:w2ui[e.target].getSelection()[0],action:"delete"},{},reload_page))},$_DO.patch_house_passport_lifts=function(e){var t=this,i=t.columns[e.column],n={k:i.field,v:normalizeValue(e.value_new,i.editable.type)};"factorynum"==n.k&&$.each(t.records,function(){this.terminationdate||this.id!=e.recid&&this.factorynum==n.v&&(e.preventDefault(),die("foo","Лифт с таким заводским номером уже зарегистрирован"))}),null!=n.v&&(n.v=String(n.v)),t.lock();var o={type:"lifts",action:"update",id:e.recid},a={};a[n.k]=n.v,query(o,{data:a},function(){t.unlock(),t.reload()})},function(e){var t=w2ui.passport_layout;t&&t.unlock("main"),query({type:"entrances",id:void 0},{data:{uuid_house:$_REQUEST.id},cmd:"get",selected:[],limit:100,offset:0},function(t){var i="entrances",n={};n[i]=t.tb_entrances.map(function(e){return{id:e.id,label:e.entrancenum,fake:e.is_annuled}}),add_vocabularies(n,n),$("body").data("data")[i]=n[i],get_nsi([330],e)})}}),define("app/data/house_passport",[],function(){var e="house_passport_form";return $_DO.cancel_house_passport=function(t){if(confirm("Отменить несохранённые правки?")){w2ui[e].record;query({type:"houses"},{},function(e){e.__read_only=!0,$_F5(e)})}},$_DO.edit_house_passport=function(t){var i={item:w2ui[e].record};i.__read_only=!1;w2ui[e];$_F5(i)},$_DO.update_house_passport=function(t){if(confirm("Сохранить изменения?")){var i=w2ui[e].values(),n=parseInt(i.floorcount),o=parseInt(i.undergroundfloorcount),a=parseInt(i.minfloorcount);n>0&&(o>n&&die("undergroundfloorcount","Подземных этажей не может быть больше, чем этажей всего"),a>n&&die("minfloorcount","Минимальное число этажей не может превышать максимальное")),i.kad_n&&(/^77:\d{2}:\d{7}:\d{4}$/.test(i.kad_n)||die("kad_n","Данное значение не подходит для кадастрового номера по формату")),i.hasblocks||(i.hasmultiplehouseswithsameadres=0),w2ui[e].lock(),query({type:"houses",action:"update"},{data:i},function(e){sessionStorage.setItem("check_sum_area_fields_of_a_house",1),location.reload()})}},$_DO.choose_tab_house_passport=function(e){var t=e.tab.id,i=w2ui.passport_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("house_passport.active_tab",t),use.block(t)},function(e){w2ui.topmost_layout.unlock("main");var t=$("body").data("data");if(t.tabs=t.item.is_condo?[{id:"house_passport_entrances",label:"Подъезды"},{id:"house_passport_lifts",label:"Лифты"}]:[{id:"house_passport_blocks",label:"Блоки",off:!t.item.hasblocks}].filter(not_off),delete t.active_tab,$.each(t.tabs,function(){this.id==localStorage.getItem("house_passport.active_tab")&&(t.active_tab=this.id)}),!t.active_tab&&t.tabs.length&&(t.active_tab=t.tabs[0].id),t.__read_only=1,!t.item.is_condo)return e(t);query({type:"voc_nsi_list",id:192,part:"lines"},{cmd:"get",selected:[],limit:100,offset:0},function(i){var n="vc_nsi_192",o={};o[n]=i.records.map(function(e){return{id:e.code,label:e.f_ae990eb9f6}}),add_vocabularies(o,o),t[n]=o[n],e(t)})}}),define("app/data/house_premises_nonresidental",[],function(){return $_DO.create_house_premises_nonresidental=function(e){$_SESSION.set("record",{iscommonproperty:0}),use.block("premise_nonresidental_popup")},$_DO.edit_house_premises_nonresidental=function(e){$_SESSION.set("record",w2ui[e.target].get(e.recid)),use.block("premise_nonresidental_popup")},$_DO.delete_house_premises_nonresidental=function(e){e.force&&($(".w2ui-message").remove(),e.preventDefault(),query({type:"premises_nonresidental",id:w2ui[e.target].getSelection()[0].recid,action:"delete"},{},reload_page))},$_DO.patch_house_premises_nonresidental=function(e){var t=this,i=t.columns[e.column],n={k:i.field,v:normalizeValue(e.value_new,i.editable.type)};"premisesnum"==n.k&&$.each(t.records,function(){this.terminationdate||this.id!=e.recid&&this.premisesnum==n.v&&(e.preventDefault(),die("foo","Помещение с таким номером уже зарегистрировано"))}),null!=n.v&&(n.v=String(n.v)),t.lock();var o={type:"premises_nonresidental",action:"update",id:e.recid},a={};a[n.k]=n.v,query(o,{data:a},function(){t.unlock(),t.reload()},edit_failed(t,e))},function(e){var t=w2ui.house_premises_layout;t&&t.unlock("main"),get_nsi([17,254,253,261],e)}}),define("app/data/house_premises_residental",[],function(){return $_DO.create_house_premises_residental=function(e){$_SESSION.set("record",{uuid_entrance:-1}),use.block("premise_residental_popup")},$_DO.edit_house_premises_residental=function(e){$_SESSION.set("record",w2ui[e.target].get(e.recid)),use.block("premise_residental_popup")},$_DO.delete_house_premises_residental=function(e){e.force&&($(".w2ui-message").remove(),e.preventDefault(),query({type:"premises_residental",id:w2ui[e.target].getSelection()[0].recid,action:"delete"},{},reload_page))},$_DO.patch_house_premises_residental=function(e){var t=this,i=t.columns[e.column],n={k:i.field,v:normalizeValue(e.value_new,i.editable.type)};"premisesnum"==n.k&&$.each(t.records,function(){this.terminationdate||this.id!=e.recid&&this.premisesnum==n.v&&(e.preventDefault(),die("foo","Помещение с таким номером уже зарегистрировано"))}),null!=n.v&&(n.v=String(n.v)),t.lock();var o={type:"premises_residental",action:"update",id:e.recid},a={};a[n.k]=n.v||null,query(o,{data:a},function(){t.unlock(),t.reload()},edit_failed(t,e))},function(e){var t=w2ui.house_premises_layout;t&&t.unlock("main"),query({type:"entrances",id:void 0},{data:{uuid_house:$_REQUEST.id},cmd:"get",selected:[],limit:100,offset:0},function(t){var i="entrances",n={};n[i]=t.tb_entrances.map(function(e){return{id:e.id,label:e.entrancenum,fake:e.is_annuled}}),add_vocabularies(n,n),n.entrances[""]="Отдельный вход",$("body").data("data")[i]=n[i],get_nsi([14,30,273,258,259,254,253,261],e)})}}),define("app/data/house_premises",[],function(){return $_DO.choose_tab_house_premises=function(e){var t=w2ui.house_premises_layout;t&&(t.content("main",""),t.lock("main","Загрузка...",!0));var i=e.tab.id;localStorage.setItem("house_premises.active_tab",i),use.block(e.tab.id)},function(e){var t={};t.active_tab=localStorage.getItem("house_premises.active_tab")||"house_premises_residental",e(t)}}),define("app/data/house_sys_cold_water",[],function(){return $_DO.patch_house_sys_cold_water=function(e){var t=this,i=t.columns[e.column],n=i.editable(t.get(e.recid)),o={k:"f_"+e.recid,v:normalizeValue(e.value_new,n.type)};null!=o.v&&(o.v=String(o.v)),t.lock();var a={type:"houses",action:"patch"};query(a,{data:o},function(){var i=$("body").data("data");i.item[o.k]=o.v;var n=i.depends,r=[];for(var s in n)n[s]==e.recid&&r.push(s);r.length&&1!=o.v&&$.each(r,function(){var e="f_"+this;i.item[e]&&(delete i.item[e],query(a,{data:{k:e,v:null}},$.noop))}),$("body").data("data",i),$("body").data("area_codes")[e.recid]&&setTimeout($_DO.check_sum_area_fields_of_a_house,400),t.unlock(),$_F5()})},function(e){var t=$("body").data("data");t.doc_fields={},query({type:"houses",part:"passport_fields_sys_cold_water"},{},function(n){var o=n.vc_pass_fields,a={};$.each(o,function(){if(this.recid=this.id,this.name="f_"+this.id,this.value=t.item[this.name],this.is_mandatory&&(this.w2ui={class:"status_warning"}),this.voc){var e="vc_nsi_"+this.voc;n[e]&&(a[e]=1)}3==this.id_type&&(t.doc_fields[this.id]=1,t.doc_fields[this.id_dt]=1,t.doc_fields[this.id_no]=1)}),add_vocabularies(n,a);for(i in a)t[i]=n[i];t.vc_pass_fields=o,$("body").data("data",t),e(t)}),w2ui.topmost_layout.unlock("main")}}),define("app/data/house_sys_electro",[],function(){return $_DO.patch_house_sys_electro=function(e){var t=this,i=t.columns[e.column],n=i.editable(t.get(e.recid)),o={k:"f_"+e.recid,v:normalizeValue(e.value_new,n.type)};null!=o.v&&(o.v=String(o.v)),t.lock();var a={type:"houses",action:"patch"};query(a,{data:o},function(){var i=$("body").data("data");i.item[o.k]=o.v;var n=i.depends,r=[];for(var s in n)n[s]==e.recid&&r.push(s);r.length&&1!=o.v&&$.each(r,function(){var e="f_"+this;i.item[e]&&(delete i.item[e],query(a,{data:{k:e,v:null}},$.noop))}),$("body").data("data",i),$("body").data("area_codes")[e.recid]&&setTimeout($_DO.check_sum_area_fields_of_a_house,400),t.unlock(),$_F5()})},function(e){var t=$("body").data("data");t.doc_fields={},query({type:"houses",part:"passport_fields_sys_electro"},{},function(n){var o=n.vc_pass_fields,a={};$.each(o,function(){if(this.recid=this.id,this.name="f_"+this.id,this.value=t.item[this.name],this.is_mandatory&&(this.w2ui={class:"status_warning"}),this.voc){var e="vc_nsi_"+this.voc;n[e]&&(a[e]=1)}3==this.id_type&&(t.doc_fields[this.id]=1,t.doc_fields[this.id_dt]=1,t.doc_fields[this.id_no]=1)}),add_vocabularies(n,a);for(i in a)t[i]=n[i];t.vc_pass_fields=o,$("body").data("data",t),e(t)}),w2ui.topmost_layout.unlock("main")}}),define("app/data/house_sys_gas",[],function(){return $_DO.patch_house_sys_gas=function(e){var t=this,i=t.columns[e.column],n=i.editable(t.get(e.recid)),o={k:"f_"+e.recid,v:normalizeValue(e.value_new,n.type)};null!=o.v&&(o.v=String(o.v)),t.lock();var a={type:"houses",action:"patch"};query(a,{data:o},function(){var i=$("body").data("data");i.item[o.k]=o.v;var n=i.depends,r=[];for(var s in n)n[s]==e.recid&&r.push(s);r.length&&1!=o.v&&$.each(r,function(){var e="f_"+this;i.item[e]&&(delete i.item[e],query(a,{data:{k:e,v:null}},$.noop))}),$("body").data("data",i),$("body").data("area_codes")[e.recid]&&setTimeout($_DO.check_sum_area_fields_of_a_house,400),t.unlock(),$_F5()})},function(e){var t=$("body").data("data");t.doc_fields={},query({type:"houses",part:"passport_fields_sys_gas"},{},function(n){var o=n.vc_pass_fields,a={};$.each(o,function(){if(this.recid=this.id,this.name="f_"+this.id,this.value=t.item[this.name],this.is_mandatory&&(this.w2ui={class:"status_warning"}),this.voc){
var e="vc_nsi_"+this.voc;n[e]&&(a[e]=1)}3==this.id_type&&(t.doc_fields[this.id]=1,t.doc_fields[this.id_dt]=1,t.doc_fields[this.id_no]=1)}),add_vocabularies(n,a);for(i in a)t[i]=n[i];t.vc_pass_fields=o,$("body").data("data",t),e(t)}),w2ui.topmost_layout.unlock("main")}}),define("app/data/house_sys_heating",[],function(){return $_DO.patch_house_sys_heating=function(e){var t=this,i=t.columns[e.column],n=i.editable(t.get(e.recid)),o={k:"f_"+e.recid,v:normalizeValue(e.value_new,n.type)};null!=o.v&&(o.v=String(o.v)),t.lock();var a={type:"houses",action:"patch"};query(a,{data:o},function(){var i=$("body").data("data");i.item[o.k]=o.v;var n=i.depends,r=[];for(var s in n)n[s]==e.recid&&r.push(s);r.length&&1!=o.v&&$.each(r,function(){var e="f_"+this;i.item[e]&&(delete i.item[e],query(a,{data:{k:e,v:null}},$.noop))}),$("body").data("data",i),$("body").data("area_codes")[e.recid]&&setTimeout($_DO.check_sum_area_fields_of_a_house,400),t.unlock(),$_F5()})},function(e){var t=$("body").data("data");t.doc_fields={},query({type:"houses",part:"passport_fields_sys_heating"},{},function(n){var o=n.vc_pass_fields,a={};$.each(o,function(){if(this.recid=this.id,this.name="f_"+this.id,this.value=t.item[this.name],this.is_mandatory&&(this.w2ui={class:"status_warning"}),this.voc){var e="vc_nsi_"+this.voc;n[e]&&(a[e]=1)}3==this.id_type&&(t.doc_fields[this.id]=1,t.doc_fields[this.id_dt]=1,t.doc_fields[this.id_no]=1)}),add_vocabularies(n,a);for(i in a)t[i]=n[i];t.vc_pass_fields=o,$("body").data("data",t),e(t)}),w2ui.topmost_layout.unlock("main")}}),define("app/data/house_sys_hot_water",[],function(){return $_DO.patch_house_sys_hot_water=function(e){var t=this,i=t.columns[e.column],n=i.editable(t.get(e.recid)),o={k:"f_"+e.recid,v:normalizeValue(e.value_new,n.type)};null!=o.v&&(o.v=String(o.v)),t.lock();var a={type:"houses",action:"patch"};query(a,{data:o},function(){var i=$("body").data("data");i.item[o.k]=o.v;var n=i.depends,r=[];for(var s in n)n[s]==e.recid&&r.push(s);r.length&&1!=o.v&&$.each(r,function(){var e="f_"+this;i.item[e]&&(delete i.item[e],query(a,{data:{k:e,v:null}},$.noop))}),$("body").data("data",i),$("body").data("area_codes")[e.recid]&&setTimeout($_DO.check_sum_area_fields_of_a_house,400),t.unlock(),$_F5()})},function(e){var t=$("body").data("data");t.doc_fields={},query({type:"houses",part:"passport_fields_sys_hot_water"},{},function(n){var o=n.vc_pass_fields,a={};$.each(o,function(){if(this.recid=this.id,this.name="f_"+this.id,this.value=t.item[this.name],this.is_mandatory&&(this.w2ui={class:"status_warning"}),this.voc){var e="vc_nsi_"+this.voc;n[e]&&(a[e]=1)}3==this.id_type&&(t.doc_fields[this.id]=1,t.doc_fields[this.id_dt]=1,t.doc_fields[this.id_no]=1)}),add_vocabularies(n,a);for(i in a)t[i]=n[i];t.vc_pass_fields=o,$("body").data("data",t),e(t)}),w2ui.topmost_layout.unlock("main")}}),define("app/data/house_sys_sewer",[],function(){return $_DO.patch_house_sys_sewer=function(e){var t=this,i=t.columns[e.column],n=i.editable(t.get(e.recid)),o={k:"f_"+e.recid,v:normalizeValue(e.value_new,n.type)};null!=o.v&&(o.v=String(o.v)),t.lock();var a={type:"houses",action:"patch"};query(a,{data:o},function(){var i=$("body").data("data");i.item[o.k]=o.v;var n=i.depends,r=[];for(var s in n)n[s]==e.recid&&r.push(s);r.length&&1!=o.v&&$.each(r,function(){var e="f_"+this;i.item[e]&&(delete i.item[e],query(a,{data:{k:e,v:null}},$.noop))}),$("body").data("data",i),$("body").data("area_codes")[e.recid]&&setTimeout($_DO.check_sum_area_fields_of_a_house,400),t.unlock(),$_F5()})},function(e){var t=$("body").data("data");t.doc_fields={},query({type:"houses",part:"passport_fields_sys_sewer"},{},function(n){var o=n.vc_pass_fields,a={};$.each(o,function(){if(this.recid=this.id,this.name="f_"+this.id,this.value=t.item[this.name],this.is_mandatory&&(this.w2ui={class:"status_warning"}),this.voc){var e="vc_nsi_"+this.voc;n[e]&&(a[e]=1)}3==this.id_type&&(t.doc_fields[this.id]=1,t.doc_fields[this.id_dt]=1,t.doc_fields[this.id_no]=1)}),add_vocabularies(n,a);for(i in a)t[i]=n[i];t.vc_pass_fields=o,$("body").data("data",t),e(t)}),w2ui.topmost_layout.unlock("main")}}),define("app/data/house_sys",[],function(){return $_DO.patch_house_sys=function(e){var t=this,i=t.columns[e.column],n=i.editable(t.get(e.recid)),o={k:"f_"+e.recid,v:normalizeValue(e.value_new,n.type)};null!=o.v&&(o.v=String(o.v));var a=$("body").data("data"),r=a.depends,s=[];for(var d in r)r[d]==e.recid&&s.push("f_"+d);var c=[];if(!s.length||1==o.v||(c=s.filter(function(e){return a.item[e]}),!c.length||confirm("Все ранее заполненные показатели по данной внутридомовой системе будут очищены. Продолжить?"))){t.lock();var u={type:"houses",action:"patch"};query(u,{data:o},function(){a.item[o.k]="0"==o.v?0:o.v,$.each(c,function(){delete a.item[this],query(u,{data:{k:this,v:null}},$.noop)}),$("body").data("data",a),t.unlock();var i=w2ui.house_systems_layout.get("main").tabs;1==o.v?i.show(e.recid):i.hide(e.recid),$_F5()})}},function(e){var t=$("body").data("data");t.doc_fields={},query({type:"houses",part:"passport_fields_sys"},{},function(n){var o=n.vc_pass_fields,a={};$.each(o,function(){if(this.recid=this.id,this.name="f_"+this.id,this.value=t.item[this.name],this.is_mandatory&&(this.w2ui={class:"status_warning"}),this.voc){var e="vc_nsi_"+this.voc;n[e]&&(a[e]=1)}3==this.id_type&&(t.doc_fields[this.id]=1,t.doc_fields[this.id_dt]=1,t.doc_fields[this.id_no]=1)}),add_vocabularies(n,a);for(i in a)t[i]=n[i];t.vc_pass_fields=o,$("body").data("data",t),e(t)}),w2ui.topmost_layout.unlock("main")}}),define("app/data/house_systems",[],function(){return $_DO.choose_tab_house_systems=function(e){var t=w2ui.house_systems_layout;t&&(t.content("main",""),t.lock("main","Загрузка...",!0));var i=e.tab.id;localStorage.setItem("house_systems.active_tab",i),use.block(e.tab._type)},function(e){var t=$("body").data("data"),i={systems:[{id:11707,name:"heating",label:"Отопление"},{id:11767,name:"cold_water",label:"Холодное водоснабжение"},{id:11745,name:"hot_water",label:"Горячее водоснабжение"},{id:11789,name:"sewer",label:"Водоотведение"},{id:11801,name:"gas",label:"Газ"},{id:11665,name:"electro",label:"Электроснабжение"}]};i.active_tab=localStorage.getItem("house_systems.active_tab")||"house_sys",$.each(i.systems,function(){t.item["f_"+this.id]||(this.off=1,i.active_tab==this.id&&(i.active_tab="house_sys"))}),e(i)}}),define("app/data/house",[],function(){var e={19924:1,14532:1,20145:1};return $_DO.check_sum_area_fields_of_a_house=function(){function t(e){return"("+e.toFixed(4).replace(/0+$/,"").replace(".",",")+" кв. м)"}function n(e){alert('Суммарная площадь здания на закладке "Общие"'+t(r)+e+' на закладке "Паспорт" '+t(totalsquare))}var o=$("body").data("data").item;if(null!=o.totalsquare){totalsquare=parseFloat(o.totalsquare);var a=!0,r=0;for(i in e){var s=o["f_"+i];null==s?a=!1:r+=parseFloat(s)}var d=r-totalsquare;a?Math.abs(d)>1e-4&&n(" отлична от значения, указанного"):d>1e-4&&n(" превышает значение, указанное")}},$_DO.choose_tab_house=function(e){var t=e.tab.id,i=w2ui.topmost_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("house.active_tab",t),use.block(t)},function(t){query({type:"houses"},{},function(i){add_vocabularies(i,{vc_nsi_24:1}),i.active_tab=localStorage.getItem("house.active_tab")||"house_address",i.item.type=i.item.is_condo?"МКД":"ЖД",i.depends={20147:17023,11053:20169,11052:20169,20817:20169,20818:20169,20024:20169,20025:20062,13026:20062,14526:20062,20170:20062,20137:20136,20138:20136,20139:20136,21819:20136,20094:11707,13207:11707,16207:11707,12035:11707,20058:11707,20048:11707,20047:11707,20046:11707,20154:11707,20050:11707,20051:11707,10221:11707,20096:11707,15055:11707,14721:11707,10291:11707,20097:11707,11791:11707,12060:11707,20098:11707,20099:11707,10536:11707,20100:11707,12036:11707,20101:11707,20102:11707,20103:11707,20105:11767,13267:11767,11955:11767,10278:11767,20107:11767,14778:11767,10476:11767,20108:11767,11975:11767,20109:11767,20110:11767,20112:11745,14745:11745,13477:11745,20153:11745,10524:11745,20114:11745,15024:11745,16524:11745,10478:11745,20115:11745,12023:11745,20116:11745,20117:11745,20143:11789,13289:11789,13412:11789,20045:11789,20118:11801,13301:11801,16301:11801,20057:11801,20148:11801,20122:11665,12545:11665},$("body").data("data",i),$("body").data("area_codes",e),t(i)})}}),define("app/data/houses",[],function(){return function(e){var t=w2ui.rosters_layout;t&&t.unlock("main"),e({})}}),define("app/data/insurance_product_common_log",[],function(){return $_DO.download_insurance_product_common_log=function(e){function t(e,t){return String(Math.round(100*e/t))+"%"}var i=$("body");w2utils.lock(i,t(0,1)),download({type:"insurance_product_log",id:e.recid,action:"download"},{},{onprogress:function(e,i){$(".w2ui-lock-msg").html("<br><br>"+t(e,i))},onload:function(){w2utils.unlock(i)}})},function(e){var t=w2ui.passport_layout;t&&t.unlock("main"),e($("body").data("data"))}}),define("app/data/insurance_product_common",[],function(){var e="insurance_product_common_form";return $_DO.open_orgs_insurance_product_common=function(t){$("body").data("voc_organizations_popup.callback",function(t){var i=w2ui[e],n={id:t.uuid,text:t.label};i.record.insuranceorg=n,i.refresh()}),use.block("voc_organizations_popup")},$_DO.download_insurance_product_common=function(t){function i(e,t){return String(Math.round(100*e/t))+"%"}var n=w2ui[e].box;w2utils.lock(n,i(0,1)),download({type:"insurance_products",id:$_REQUEST.id,action:"download"},{},{onprogress:function(e,t){$(".w2ui-lock-msg").html("<br><br>"+i(e,t))},onload:function(){w2utils.unlock(n)}})},$_DO.cancel_insurance_product_common=function(t){if(confirm("Отменить несохранённые правки?")){w2ui[e].record;query({type:"insurance_products"},{},function(e){e.__read_only=!0,$_F5(e)})}},$_DO.edit_insurance_product_common=function(t){var i={item:w2ui[e].record};10==i.item.id_status&&die("foo","В настоящий момент данная запись передаётся в ГИС ЖКХ. Операция отменена."),i.__read_only=!1;w2ui[e];$_F5(i)},$_DO.update_insurance_product_common=function(t){if(confirm("Сохранить изменения?")){var i=w2ui[e],n=i.values();n.description||die("description","Опишите, пожалуйста, продукт"),n.description.length>500&&die("description","Максимальная длина описания — 500 символов");var o=i.record,a=reload_page;if(!o.files||0==o.files.length){if(o.uuid)return query({type:"insurance_products",id:o.uuid,action:"update"},{data:n},a);die("files","Приложите, пожалуйста, файл договора страхования")}for(var r=o.files.length,s={pdf:1,doc:1,docx:1,rtf:1,xls:1,xlsx:1,jpg:1,jpeg:1},d=0,c=0;c<r;c++){var u=o.files[c].file,l=u.name;if(l.length>255)return alert("Некорректное имя файла: "+l+". Согласно требованиям ГИС ЖКХ, его длина не может превышать 255 символов");var _=l.split(".");if(_.length<2)return alert("Некорректное имя файла: "+l+" (невозможно определить расширение)");if(!s[_[_.length-1]]){var p=[];for(var t in s)p.push(t);return alert("Некорректное имя файла: "+l+".\n\nСогласно требованиям ГИС ЖКХ, разрешены следующие: "+p.sort().join(", ")+".")}if(u.size>10485760)return alert("Файл "+l+" имеет недопустимо большой объём. Согласно требованиям ГИС ЖКХ, его величина не может превышать 10 Мб.");d+=u.size}$("#w2ui-popup button").hide();var f=$("#w2ui-popup progress");f.prop({max:d,value:0}).show();var m=0;w2utils.lock($("#w2ui-popup .w2ui-page"));var v=($("body").data("data"),{uuid:o.uuid,insuranceorg:n.insuranceorg,description:n.description}),r=o.files.length,h=setInterval(function(){r||(clearInterval(h),a())},100),y={data:v,type:"insurance_products",action:{update:"append"},onprogress:function(e,t){m+=131072,f.val(m)},onloadend:function(){r--}};$.each(o.files,function(){Base64file.upload(this.file,y)})}},$_DO.delete_insurance_product_common=function(e){confirm("Удалить эту запись, Вы уверены?")&&query({type:"insurance_products",action:"delete"},{},reload_page)},$_DO.undelete_insurance_product_common=function(e){confirm("Восстановить эту запись, Вы уверены?")&&query({type:"insurance_products",action:"undelete"},{},reload_page)},$_DO.choose_tab_insurance_product_common=function(e){var t=e.tab.id,i=w2ui.passport_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("insurance_product_common.active_tab",t),use.block(t)},function(e){w2ui.topmost_layout.unlock("main");var t=clone($("body").data("data"));t.active_tab=localStorage.getItem("insurance_product_common.active_tab")||"insurance_product_common_log",t.__read_only=1,$_USER.role.admin&&(t.item.org_label=t.item["vc_orgs.label"]),t.item.status_label=t.vc_async_entity_states[t.item.id_status],t.item.insuranceorg_label=t.vc_orgs_ins[t.item.insuranceorg],t.item.err_text=t.item["out_soap.err_text"],t.item._can=$_USER.role.admin?{}:{edit:1-t.item.is_deleted,update:1,cancel:1,delete:1-t.item.is_deleted},e(t)}}),define("app/data/insurance_product_popup",[],function(){var e="insurance_product_popup_form";return $_DO.open_orgs_insurance_product_popup=function(t){var i=w2ui[e],n={data:clone($("body").data("data")),record:clone(i.record)};$("body").data("voc_organizations_popup.callback",function(e){e&&(n.record.insuranceorg={id:e.uuid,text:e.label}),$("body").data("data",n.data),$_SESSION.set("record",n.record),use.block("insurance_product_popup")}),use.block("voc_organizations_popup")},$_DO.update_insurance_product_popup=function(t){function i(){w2popup.close();var e=w2ui.insurance_products_grid;e.reload(e.refresh)}var n=w2ui[e],o=n.values();o.insuranceorg&&"other"!=o.insuranceorg||die("insuranceorg","Укажите, пожалуйста, стаховую компанию"),o.description||die("description","Опишите, пожалуйста, продукт"),o.description.length>500&&die("description","Максимальная длина описания — 500 символов");var a=n.record;if(!a.files||0==a.files.length){if(a.uuid)return query({type:"insurance_products",id:a.uuid,action:"update"},{data:o},i);die("files","Приложите, пожалуйста, файл договора страхования")}for(var r=a.files.length,s={pdf:1,doc:1,docx:1,rtf:1,xls:1,xlsx:1,jpg:1,jpeg:1,txt:1},d=0,c=0;c<r;c++){var u=a.files[c].file,l=u.name;if(l.length>255)return alert("Некорректное имя файла: "+l+". Согласно требованиям ГИС ЖКХ, его длина не может превышать 255 символов");var _=l.split(".");if(_.length<2)return alert("Некорректное имя файла: "+l+" (невозможно определить расширение)");if(!s[_[_.length-1]]){var p=[];for(var t in s)p.push(t);return alert("Некорректное имя файла: "+l+".\n\nСогласно требованиям ГИС ЖКХ, разрешены следующие: "+p.sort().join(", ")+".")}if(u.size>10485760)return alert("Файл "+l+" имеет недопустимо большой объём. Согласно требованиям ГИС ЖКХ, его величина не может превышать 10 Мб.");d+=u.size}$("#w2ui-popup button").hide();var f=$("#w2ui-popup progress");f.prop({max:d,value:0}).show();var m=0;w2utils.lock($("#w2ui-popup .w2ui-page"));var v=($("body").data("data"),{uuid:a.uuid,insuranceorg:o.insuranceorg,description:o.description}),r=a.files.length,h=setInterval(function(){r||(clearInterval(h),i())},100),y={data:v,type:"insurance_products",action:{update:"append"},onprogress:function(e,t){m+=131072,f.val(m)},onloadend:function(){r--}};$.each(a.files,function(){Base64file.upload(this.file,y)})},function(e){var t=clone($("body").data("data"));t.record=$_SESSION.delete("record"),e(t)}}),define("app/data/insurance_product",[],function(){return $_DO.choose_tab_insurance_product=function(e){var t=e.tab.id,i=w2ui.topmost_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("insurance_product.active_tab",t),use.block(t)},function(e){query({type:"insurance_products",part:"vocs",id:void 0},{},function(t){add_vocabularies(t,t),query({type:"insurance_products"},{},function(i){t.item=i.item,$("body").data("data",t),e(t)})})}}),define("app/data/insurance_products",[],function(){function e(e){var t=w2ui.insurance_products_grid,i=t.getSelection()[0];query({type:"insurance_products",id:i,action:e},{},function(){t.reload(function(){t.refresh(),t.selectNone(),t.select(i)})})}return $_DO.delete_insurance_products=function(){confirm("Удалить эту запись?")&&e("delete")},$_DO.undelete_insurance_products=function(t){confirm("Восстановить эту запись?")&&e("undelete")},$_DO.create_insurance_products=function(e){$_SESSION.set("record",{}),use.block("insurance_product_popup")},$_DO.edit_insurance_products=function(e){var t=w2ui.insurance_products_grid,i=t.get(t.getSelection()[0]);10==i.id_status&&die("foo","В настоящий момент данная запись передаётся в ГИС ЖКХ. Операция отменена."),$_SESSION.set("record",i),use.block("insurance_product_popup")},$_DO.download_insurance_products=function(e){function t(e,t){return String(Math.round(100*e/t))+"%"}var i=$("body");w2utils.lock(i,t(0,1)),download({type:"insurance_products",id:e.recid,action:"download"},{},{onprogress:function(e,i){$(".w2ui-lock-msg").html("<br><br>"+t(e,i))},onload:function(){w2utils.unlock(i)}})},function(e){var t=w2ui.vocs_layout;t&&t.unlock("main"),query({type:"insurance_products",part:"vocs",id:void 0},{},function(t){add_vocabularies(t,t),$("body").data("data",t),e(t)})}}),define("app/data/lift_new",[],function(){return $_DO.update_lift_new=function(e){var t=w2ui.lift_new_form,i=t.values();i.uuid_entrance||die("uuid_entrance","Укажите, пожалуйста, номер подъезда"),i.code_vc_nsi_192||die("code_vc_nsi_192","Укажите, пожалуйста, тип лифта"),i.factorynum||die("factorynum","Укажите, пожалуйста, заводской номер лифта");var n=w2ui.house_passport_lifts_grid;$.each(n.records,function(){this.terminationdate||this.factorynum==i.factorynum&&die("factorynum","Лифт с таким заводским номером уже зарегистрирован")}),query({type:"lifts",id:void 0,action:"create"},{data:i},reload_page)},function(e){e($("body").data("data"))}}),define("app/data/lift_popup",[],function(){return $_DO.update_lift_popup=function(e){var t=w2ui.lift_popup_form,i=t.values();i.uuid_entrance||die("uuid_entrance","Укажите, пожалуйста, номер подъезда"),i.code_vc_nsi_192||die("code_vc_nsi_192","Укажите, пожалуйста, тип лифта"),i.factorynum||die("factorynum","Укажите, пожалуйста, заводской номер лифта");var n=w2ui.house_passport_lifts_grid;$.each(n.records,function(){this.terminationdate||this.id!=t.record.id&&this.factorynum==i.factorynum&&die("factorynum","Лифт с таким заводским номером уже зарегистрирован")}),query({type:"lifts",id:t.record.id,action:"update"},{data:i},reload_page)},function(e){var t=$("body").data("data"),i=w2ui.house_passport_lifts_grid;t.lift=i.get(i.getSelection()[0]),t.lift.terminationdate&&(t.lift.terminationdate=dt_dmy(t.lift.terminationdate.substr(0,10))),e(t)}}),define("app/data/living_room_common",[],function(){var e="living_room_common_form";return $_DO.restore_living_room_common=function(e){confirm("Удалить запись об аннулировании объекта?")&&query({type:"living_rooms",id:$_REQUEST.id,action:"update"},{data:{terminationdate:null,annulmentinfo:null,code_vc_nsi_330:null}},reload_page)},$_DO.annul_living_room_common=function(e){use.block("annul_popup")},$_DO.cancel_living_room_common=function(t){if(confirm("Отменить несохранённые правки?")){w2ui[e].record;query({type:"living_rooms"},{},function(e){e.__read_only=!0,$_F5(e)})}},$_DO.edit_living_room_common=function(t){var i={item:w2ui[e].record};if(i.item.is_annuled)return alert("Поскольку данный объект жилого фонда аннулирован, редактирование невозможно."),t.preventDefault();i.__read_only=!1;w2ui[e];$_F5(i)},$_DO.update_living_room_common=function(t){if(confirm("Сохранить изменения?")){var i=w2ui[e],n=i.values();null!=n.roomnumber&&""!=n.roomnumber||die("roomnumber","Укажите, пожалуйста, номер комнаты"),/[0-9А-ЯЁа-яёA-Za-z]/.test(n.roomnumber)||die("roomnumber","Некорректный номер комнаты"),parseFloat(n.square||"0")<.01&&die("square","Необходимо указать размер плошади"),query({type:"living_rooms",action:"update"},{data:n},reload_page)}},function(e){w2ui.topmost_layout.unlock("main");var t=clone($("body").data("data"));t.__read_only=1,t.item._can={edit:1,update:1,cancel:1,annul:1-t.item.is_annuled,restore:t.item.is_annuled},e(t)}}),define("app/data/living_room_invalid",[],function(){var e="living_room_invalid_form";return $_DO.download_living_room_invalid=function(t){function i(e,t){return String(Math.round(100*e/t))+"%"}var n=w2ui[e].box;w2utils.lock(n,i(0,1)),download({type:"house_docs",id:$("body").data("data").file.uuid,action:"download"},{},{onprogress:function(e,t){$(".w2ui-lock-msg").html("<br><br>"+i(e,t))},onload:function(){w2utils.unlock(n)}})},$_DO.cancel_living_room_invalid=function(t){if(confirm("Отменить несохранённые правки?")){w2ui[e].record;query({type:"living_rooms"},{},function(e){e.__read_only=!0,$_F5(e)})}},$_DO.edit_living_room_invalid=function(t){var i={item:w2ui[e].record};if(i.item.is_annuled)return alert("Поскольку данный объект жилого фонда аннулирован, редактирование невозможно."),t.preventDefault();i.__read_only=!1;w2ui[e];$_F5(i)},$_DO.update_living_room_invalid=function(t){function i(){$.each(a.file,function(){Base64file.upload(this.file,y)})}if(confirm("Сохранить изменения?")){var n=w2ui[e],o=n.values();if(o.file){var a=n.record;if(a.f_20132||die("f_20132","Укажите, пожалуйста, основание признания данного помещения непригодным для проживания"),!a.f_20133)return $("input[name=f_20133]").focus(),alert("Укажите, пожалуйста, дату документа");if(!/^\d\d\.\d\d\.\d\d\d\d$/.test(a.f_20133))return $("input[name=f_20133]").focus(),alert("Некорректная дата документа");if(!a.f_20134)return $("input[name=f_20134]").focus(),alert("Укажите, пожалуйста, номер документа");if(!a.file||0==a.file.length)return $("input[name=file]").focus(),alert("Вы не указали файл");for(var r=a.file.length,s={pdf:1,doc:1,docx:1,rtf:1,xls:1,xlsx:1,jpg:1,jpeg:1},d=0,c=0;c<r;c++){var u=a.file[c].file,l=u.name;if(l.length>255)return alert("Некорректное имя файла: "+l+". Согласно требованиям ГИС ЖКХ, его длина не может превышать 255 символов");var _=l.split(".");if(_.length<2)return alert("Некорректное имя файла: "+l+" (невозможно определить расширение)");if(!s[_[_.length-1]]){var p=[];for(var t in s)p.push(t);return alert("Некорректное имя файла: "+l+".\n\nСогласно требованиям ГИС ЖКХ, разрешены следующие: "+p.sort().join(", ")+".")}if(u.size>10485760)return alert("Файл "+l+" имеет недопустимо большой объём. Согласно требованиям ГИС ЖКХ, его величина не может превышать 10 Мб.");d+=u.size}$(".w2ui-buttons button").hide();var f=$("progress");f.prop({max:d,value:0}).show();var m=0;n.lock();var v=($("body").data("data"),{uuid:$_REQUEST.id,no:o.f_20134,dt:o.f_20133,id_file_type:"20821",note:"",ref:"uuid_living_room"}),r=a.file.length,h=setInterval(function(){r||(clearInterval(h),$_DO.apologize=$.noop,query({type:"living_rooms",action:"update"},{data:{f_20132:o.f_20132}},reload_page))},100),y={data:v,type:"house_docs",onprogress:function(e,t){m+=131072,f.val(m)},onloadend:function(){r--}},u=$("body").data("data").file;u?query({type:"house_docs",id:u.uuid,action:"delete"},{},i):i()}else query({type:"living_rooms",action:"update"},{data:o},reload_page)}},function(e){w2ui.topmost_layout.unlock("main");var t=$("body").data("data");t.__read_only=1,e(t)}}),define("app/data/living_room_passport",[],function(){return $_DO.patch_living_room_passport=function(e){var t=this,i=t.columns[e.column],n=i.editable(t.get(e.recid)),o={k:"f_"+e.recid,v:normalizeValue(e.value_new,n.type)};null!=o.v&&(o.v=String(o.v)),t.lock();var a={type:"living_rooms",action:"update"},r={};r[o.k]=o.v||null,query(a,{data:r},function(){var e=$("body").data("data");if(e.item[o.k]=o.v,$("body").data("data",e),"f_20131"==o.k){var i=w2ui.topmost_layout.get("main").tabs,n="living_room_invalid";0==o.v?query({type:"living_rooms",action:"update"},{data:{f_20132:null,f_20133:null,f_20134:null}},function(){e.file?query({type:"house_docs",id:e.file.uuid,action:"delete"},{},reload_page):reload_page()}):(t.unlock(),i.show(n),$_F5(),confirm("Перейти ко вводу документа о непригодности для проживания?")&&i.click(n))}else t.unlock(),$_F5()})},function(e){var t=$("body").data("data");t.doc_fields={},query({type:"living_rooms",part:"passport_fields"},{},function(n){var o=n.vc_pass_fields,a={};$.each(o,function(){if(this.recid=this.id,this.name="f_"+this.id,this.value=t.item[this.name],this.is_mandatory&&(this.w2ui={class:"status_warning"}),this.voc){var e="vc_nsi_"+this.voc;n[e]&&(a[e]=1)}3==this.id_type&&(t.doc_fields[this.id]=1,t.doc_fields[this.id_dt]=1,t.doc_fields[this.id_no]=1)}),add_vocabularies(n,a);for(i in a)t[i]=n[i];t.vc_pass_fields=o,$("body").data("data",t),e(t)}),w2ui.topmost_layout.unlock("main")}}),define("app/data/living_room_popup",[],function(){return $_DO.update_living_room_popup=function(e){var t=w2ui.living_room_new_form,n=t.values();if("house"==$_REQUEST.type){var o=$("body").data("data"),a=o.item;a.is_condo?n.uuid_premise||die("uuid_premise","Укажите, пожалуйста, квартиру"):n.uuid_block||(o.vc_blocks.items.length?die("uuid_block","Укажите, пожалуйста, блок"):n.uuid_house=a.uuid)}null!=n.roomnumber&&""!=n.roomnumber||die("roomnumber","Укажите, пожалуйста, номер комнаты"),/[0-9А-ЯЁа-яёA-Za-z]/.test(n.roomnumber)||die("roomnumber","Некорректный номер комнаты"),parseFloat(n.square||"0")<.01&&die("square","Необходимо указать размер плошади"),"premise_residental"==$_REQUEST.type&&(n.uuid_premise=$_REQUEST.id);var r={f_20056:1};for(i in r)n[i]=n[i]?[n[i]]:[];query({type:"living_rooms",action:"create",id:void 0},{data:n},reload_page)},function(e){var t=clone($("body").data("data"));if(t.record=$_SESSION.get("record"),sessionStorage.removeItem("record"),t.vc_blocks&&1==t.vc_blocks.items.length&&(t.record.uuid_block=t.vc_blocks.items[0]),"premise_residental"==$_REQUEST.type){var n={vc_premises:[{id:t.record.uuid_premise=t.item.uuid,label:t.item.premisesnum}]};add_vocabularies(n,n);for(i in n)t[i]=n[i]}e(t)}}),define("app/data/living_room",[],function(){return $_DO.choose_tab_living_room=function(e){var t=e.tab.id,i=w2ui.topmost_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("living_room.active_tab",t),use.block(t)},function(e){query({type:"living_rooms"},{},function(t){add_vocabularies(t,{tb_entrances:1,vc_nsi_14:1,vc_nsi_273:1,vc_nsi_330:1}),t.item.label=t.item.roomnumber,t.item.premise_label=t.item["tb_premises_res.premisesnum"],t.item.block_label=t.item["tb_blocks.blocknum"],t.item.address=t.item["tb_houses.address"],$("body").data("data",t),e(t)})}}),define("app/data/login",[],function(){return $_DO.execute_login=function(e){var t=values($("main"));w2ui.form.lock(),query({type:"sessions",action:"create"},{data:t},function(e){if(w2ui.form.unlock(),!e||!e.user)return alert("Ошибка аутентификации");$_SESSION.start(e.user,e.timeout),location.reload()})},function(e){e({})}}),define("app/data/main",[],function(){return $_DO.choose_tab_main=function(e){var t=e.tab.id,i=w2ui.topmost_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("main.active_tab",t),use.block(t)},function(e){var t={};t.active_tab=localStorage.getItem("main.active_tab")||"out_soap",e(t)}}),define("app/data/municipal_service_common_log",[],function(){return function(e){var t=w2ui.passport_layout;t&&t.unlock("main"),e($("body").data("data"))}}),define("app/data/municipal_service_common",[],function(){var e="municipal_service_common_form";return $_DO.cancel_municipal_service_common=function(t){if(confirm("Отменить несохранённые правки?")){w2ui[e].record;query({type:"municipal_services"},{},function(e){e.__read_only=!0,$_F5(e)})}},$_DO.edit_municipal_service_common=function(t){var i={item:w2ui[e].record};10==i.item.id_status&&die("foo","В настоящий момент данная запись передаётся в ГИС ЖКХ. Операция отменена."),i.__read_only=!1;w2ui[e];$_F5(i)},$_DO.update_municipal_service_common=function(t){if(confirm("Сохранить изменения?")){var i=w2ui[e],n=i.values();if(n.mainmunicipalservicename||die("mainmunicipalservicename","Укажите, пожалуйста, наименование услуги"),n.code_vc_nsi_3||die("code_vc_nsi_3","Укажите, пожалуйста, вид коммунальной услуги"),n.code_vc_nsi_2||die("code_vc_nsi_2","Укажите, пожалуйста, вид коммунального ресурса"),!n.sortorder&&!confirm("Вы уверены, что не забыли указать порядок сортировки?"))return $("#sortorder").focus();query({type:"municipal_services",action:"update"},{data:n},reload_page)}},$_DO.delete_municipal_service_common=function(e){confirm("Удалить эту запись, Вы уверены?")&&query({type:"municipal_services",action:"delete"},{},reload_page)},$_DO.undelete_municipal_service_common=function(e){confirm("Восстановить эту запись, Вы уверены?")&&query({type:"municipal_services",action:"undelete"},{},reload_page)},$_DO.choose_tab_municipal_service_common=function(e){var t=e.tab.id,i=w2ui.passport_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("municipal_service_common.active_tab",t),use.block(t)},function(e){w2ui.topmost_layout.unlock("main");var t=clone($("body").data("data"));t.active_tab=localStorage.getItem("municipal_service_common.active_tab")||"municipal_service_common_log",t.__read_only=1,$_USER.role.admin&&(t.item.org_label=t.item["vc_orgs.label"]),t.item.status_label=t.vc_async_entity_states[t.item.id_status],t.item.err_text=t.item["out_soap.err_text"],t.item._can=$_USER.role.admin?{}:{edit:1-t.item.is_deleted,update:1,cancel:1,delete:1-t.item.is_deleted},e(t)}}),define("app/data/municipal_service_popup",[],function(){return $_DO.update_municipal_service_popup=function(e){var t=w2ui.voc_user_form,i=t.values();if(i.mainmunicipalservicename||die("mainmunicipalservicename","Укажите, пожалуйста, наименование услуги"),i.code_vc_nsi_3||die("code_vc_nsi_3","Укажите, пожалуйста, вид коммунальной услуги"),i.code_vc_nsi_2||die("code_vc_nsi_2","Укажите, пожалуйста, вид коммунального ресурса"),!i.sortorder&&!confirm("Вы уверены, что не забыли указать порядок сортировки?"))return $("#sortorder").focus();var n={type:"municipal_services"};n.id=t.record.id,n.action=n.id?"update":"create";var o=w2ui.municipal_services_grid;query(n,{data:i},function(){w2popup.close(),o.reload(o.refresh)})},function(e){var t=clone($("body").data("data"));t.record=$_SESSION.delete("record"),e(t)}}),define("app/data/municipal_service",[],function(){return $_DO.choose_tab_municipal_service=function(e){var t=e.tab.id,i=w2ui.topmost_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("municipal_service.active_tab",t),use.block(t)},function(e){query({type:"municipal_services",part:"vocs",id:void 0},{},function(t){add_vocabularies(t,t),query({type:"municipal_services"},{},function(i){t.item=i.item,$("body").data("data",t),e(t)})})}}),define("app/data/municipal_services",[],function(){function e(e){var t=w2ui.municipal_services_grid,i=t.getSelection()[0];query({type:"municipal_services",id:i,action:e},{},function(){t.reload(function(){t.refresh(),t.selectNone(),t.select(i)})})}return $_DO.delete_municipal_services=function(){confirm("Удалить эту запись?")&&e("delete")},$_DO.undelete_municipal_services=function(t){confirm("Восстановить эту запись?")&&e("undelete")},$_DO.create_municipal_services=function(e){$_SESSION.set("record",{}),use.block("municipal_service_popup")},$_DO.edit_municipal_services=function(e){var t=w2ui.municipal_services_grid,i=t.get(t.getSelection()[0]);10==i.id_status&&die("foo","В настоящий момент данная запись передаётся в ГИС ЖКХ. Операция отменена."),$_SESSION.set("record",i),use.block("municipal_service_popup")},function(e){var t=w2ui.vocs_layout;t&&t.unlock("main"),query({type:"municipal_services",part:"vocs",id:void 0},{},function(t){add_vocabularies(t,t),$("body").data("data",t),e(t)})}}),define("app/data/nav",[],function(){return $_DO.open_users_nav=function(){openTab("/users","/users")},$_DO.open_user_password_nav=function(){use.block("user_password")},$_DO.open_settings_nav=function(){use.block("user_own_options")},$_DO.logout_nav=function(){query({type:"sessions",action:"delete"},{},$.noop,$.noop),$_SESSION.end(),redirect("/mosgis/")},function(e){e({_can:{open_widgets:!0,open_users:"admin"==$_USER.role,open_user_password:1==$_USER.id_voc_user_domain&&"admin"!=$_USER.role,
open_settings:!0,open_help:!0,logout:!0}})}}),define("app/data/open_data_log_popup",[],function(){return function(e){e({})}}),define("app/data/open_data",[],function(){return function(e){e({})}}),define("app/data/org_work_common_log",[],function(){return function(e){var t=w2ui.passport_layout;t&&t.unlock("main"),e($("body").data("data"))}}),define("app/data/org_work_common",[],function(){var e="org_work_common_form";return $_DO.cancel_org_work_common=function(t){if(confirm("Отменить несохранённые правки?")){w2ui[e].record;query({type:"org_works"},{},function(e){e.item.stringdimensionunit||(e.item.stringdimensionunit=$("body").data("data").vc_okei[e.item.okei]),e.__read_only=!0,$_F5(e)})}},$_DO.edit_org_work_common=function(t){var i={item:w2ui[e].record};10==i.item.id_status&&die("foo","В настоящий момент данная запись передаётся в ГИС ЖКХ. Операция отменена."),i.__read_only=!1;w2ui[e];$_F5(i)},$_DO.update_org_work_common=function(t){if(confirm("Сохранить изменения?")){var i=w2ui[e],n=i.values();n.workname||die("workname","Укажите, пожалуйста, наименование услуги"),n.code_vc_nsi_56||die("code_vc_nsi_56","Укажите, пожалуйста, вид работ"),n.stringdimensionunit||die("stringdimensionunit","Укажите, пожалуйста, единицу измерения");var o=$("body").data("data").vc_okei;for(var a in o)if(o[a]==n.stringdimensionunit){n.okei=a,delete n.stringdimensionunit;break}if(!n.okei&&!confirm("Вы уверены, что Общероссийский классификатор единиц измерения неприменим для определения объёма данной услуги?"))return $("#stringdimensionunit").val("").focus();n.code_vc_nsi_67=w2ui.code_vc_nsi_67_grid.getSelection(),n.code_vc_nsi_67.length||die("foo","Укажите, пожалуйста, по крайней мере одну обязательную работу"),query({type:"org_works",action:"update"},{data:n},reload_page)}},$_DO.delete_org_work_common=function(e){confirm("Удалить эту запись, Вы уверены?")&&query({type:"org_works",action:"delete"},{},reload_page)},$_DO.undelete_org_work_common=function(e){confirm("Восстановить эту запись, Вы уверены?")&&query({type:"org_works",action:"undelete"},{},reload_page)},$_DO.choose_tab_org_work_common=function(e){var t=e.tab.id,i=w2ui.passport_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("org_work_common.active_tab",t),use.block(t)},function(e){w2ui.topmost_layout.unlock("main");var t=clone($("body").data("data"));t.active_tab=localStorage.getItem("org_work_common.active_tab")||"org_work_common_log",t.__read_only=1,$_USER.role.admin&&(t.item.org_label=t.item["vc_orgs.label"]),t.item.status_label=t.vc_async_entity_states[t.item.id_status],t.item.err_text=t.item["out_soap.err_text"],t.item.stringdimensionunit||(t.item.stringdimensionunit=t.vc_okei[t.item.okei]),t.item._can=$_USER.role.admin?{}:{edit:1-t.item.is_deleted,update:1,cancel:1,delete:1-t.item.is_deleted},e(t)}}),define("app/data/org_work_popup",[],function(){return $_DO.update_org_work_popup=function(e){var t=w2ui.org_work_form,i=t.values();i.workname||die("workname","Укажите, пожалуйста, наименование услуги"),i.code_vc_nsi_56||die("code_vc_nsi_56","Укажите, пожалуйста, вид работ"),i.stringdimensionunit||die("stringdimensionunit","Укажите, пожалуйста, единицу измерения");var n=$("body").data("data").vc_okei;for(var o in n)if(n[o]==i.stringdimensionunit){i.okei=o,delete i.stringdimensionunit;break}if(!i.okei&&!confirm("Вы уверены, что Общероссийский классификатор единиц измерения неприменим для определения объёма данной услуги?"))return $("#stringdimensionunit").val("").focus();i.code_vc_nsi_67=w2ui.code_vc_nsi_67_grid.getSelection(),i.code_vc_nsi_67.length||die("foo","Укажите, пожалуйста, по крайней мере одну обязательную работу");var a={type:"org_works"};a.id=t.record.id,a.action=a.id?"update":"create";var r=w2ui.org_works_grid;query(a,{data:i},function(){w2popup.close(),r.reload(r.refresh)})},function(e){var t=clone($("body").data("data"));t.record=$_SESSION.delete("record"),t.record.uuid&&!t.record.stringdimensionunit&&(t.record.stringdimensionunit=t.vc_okei[t.record.okei]),e(t)}}),define("app/data/org_work",[],function(){return $_DO.choose_tab_org_work=function(e){var t=e.tab.id,i=w2ui.topmost_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("org_work.active_tab",t),use.block(t)},function(e){query({type:"org_works",part:"vocs",id:void 0},{},function(t){add_vocabularies(t,t),query({type:"org_works"},{},function(i){t.item=i.item,$("body").data("data",t),e(t)})})}}),define("app/data/org_works",[],function(){function e(e){var t=w2ui.org_works_grid,i=t.getSelection()[0];query({type:"org_works",id:i,action:e},{},function(){t.reload(function(){t.refresh(),t.selectNone(),t.select(i)})})}return $_DO.delete_org_works=function(){confirm("Удалить эту запись?")&&e("delete")},$_DO.undelete_org_works=function(t){confirm("Восстановить эту запись?")&&e("undelete")},$_DO.create_org_works=function(e){$_SESSION.set("record",{}),use.block("org_work_popup")},$_DO.edit_org_works=function(e){var t=w2ui.org_works_grid,i=t.get(t.getSelection()[0]);10==i.id_status&&die("foo","В настоящий момент данная запись передаётся в ГИС ЖКХ. Операция отменена."),$_SESSION.set("record",i),use.block("org_work_popup")},function(e){var t=w2ui.vocs_layout;t&&t.unlock("main"),query({type:"org_works",part:"vocs",id:void 0},{},function(t){add_vocabularies(t,t),$("body").data("data",t),e(t)})}}),define("app/data/out_soap_export_nsi_item_err_popup",[],function(){return $_DO.open_out_soap_export_nsi_item_err_popup=function(e){var t=this.columns[e.column],i=t.attr;i&&openTab("/"+i.substr(9)+"/"+this.get(e.recid)[t.field])},function(e){var t={dt:sessionStorage.getItem("dt")};sessionStorage.removeItem("dt"),e(t)}}),define("app/data/out_soap_export_nsi_item",[],function(){return $_DO.open_err_popup_out_soap_export_nsi_item=function(e){if("cnt_failed"==this.columns[e.column].field){var t=this.get(e.recid);t.cnt_failed>0&&(sessionStorage.setItem("dt",t.id.substr(0,10)),use.block("out_soap_export_nsi_item_err_popup"))}},function(e){query({type:"out_soap_export_nsi_item",part:"stats"},{data:w2ui.out_soap_filter_form.values()},function(t){t.records=dia2w2uiRecords(t.records||[]),$.each(t.records,function(){this.cnt_ok=this.cnt-this.cnt_failed,this.cnt_failed||delete this.cnt_failed}),e(t)})}}),define("app/data/out_soap_rp",[],function(){return function(e){query({type:"out_soap_export_nsi_item",part:"rp"},{},function(t){e(t)})}}),define("app/data/out_soap_rq",[],function(){function e(e){var t=(new DOMParser).parseFromString(e,"application/xml"),i=(new DOMParser).parseFromString(['<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">','  <xsl:output omit-xml-declaration="yes" indent="yes"/>','    <xsl:template match="node()|@*">','      <xsl:copy><xsl:apply-templates select="node()|@*"/></xsl:copy>',"    </xsl:template>","</xsl:stylesheet>"].join("\n"),"application/xml"),n=new XSLTProcessor;n.importStylesheet(i);var o=n.transformToDocument(t);return(new XMLSerializer).serializeToString(o)}return function(t){query({type:"out_soap_export_nsi_item",part:"rq"},{},function(i){i.xml=e(i.xml),t(i)})}}),define("app/data/out_soap",[],function(){function e(e){return{id:(e<10?"0":"")+new String(e),text:w2utils.settings.fullmonths[e-1]}}return $_DO.show_out_soap=function(e){var t=w2ui.out_soap_layout.get("main").tabs.active;/^out_soap_[0-9]$/.test(t)||(w2ui[t+"_grid"].lock(),use.block(t))},$_DO.choose_tab_out_soap=function(e){var t=e.tab.id;localStorage.setItem("out_soap.active_tab",t),/^out_soap_[0-9]$/.test(t)||use.block(t)},function(t){for(var i={months:[],years:[]},n=0;n<11;n++)i.months.push(e(n+1));var o=new Date;i.record={is_failed:0,year:{id:o.getFullYear()},month:[e(1+o.getMonth())]};for(var n=2018;n<=i.record.year.id;n++)i.years.push({id:n,text:n});i.active_tab=localStorage.getItem("out_soap.active_tab")||"out_soap_0",t(i)}}),define("app/data/passport_multiple_popup",[],function(){return $_DO.close_passport_multiple_popup=function(e){w2popup.close()},$_DO.update_passport_multiple_popup=function(e){w2popup.lock("Сохраняем данные...",!0);var t={ids:[],code:$_SESSION.get("field").def.id};for(var i in $_SESSION.get("ids"))i>0&&t.ids.push(parseInt(i));query({type:getPluralType(),id:$("body").data("data").item.uuid,action:"set_multiple"},{data:t},reload_page)},function(e){var t=$_SESSION.get("field");$.each(t.voc.items,function(){this.recid=this.id}),$_SESSION.set("ids",t.ids),e(t)}}),define("app/data/premise_nonresidental_common",[],function(){var e="premise_nonresidental_common_form";return $_DO.restore_premise_nonresidental_common=function(e){confirm("Удалить запись об аннулировании объекта?")&&query({type:"premises_nonresidental",id:$_REQUEST.id,action:"update"},{data:{terminationdate:null,annulmentinfo:null,code_vc_nsi_330:null}},reload_page)},$_DO.annul_premise_nonresidental_common=function(e){use.block("annul_popup")},$_DO.cancel_premise_nonresidental_common=function(t){if(confirm("Отменить несохранённые правки?")){w2ui[e].record;query({type:"premises_nonresidental"},{},function(e){e.__read_only=!0,$_F5(e)})}},$_DO.edit_premise_nonresidental_common=function(t){var i={item:w2ui[e].record};if(i.item.is_annuled)return alert("Поскольку данный объект жилого фонда аннулирован, редактирование невозможно."),t.preventDefault();i.__read_only=!1;w2ui[e];$_F5(i)},$_DO.update_premise_nonresidental_common=function(t){if(confirm("Сохранить изменения?")){var i=w2ui[e],n=i.values();null!=n.premisesnum&&""!=n.premisesnum||die("premisesnum","Укажите, пожалуйста, номер помещения"),/[0-9А-ЯЁа-яёA-Za-z]/.test(n.premisesnum)||die("premisesnum","Некорректный номер помещения"),parseFloat(n.totalarea||"0")<.01&&die("totalarea","Необходимо указать размер общей плошади"),query({type:"premises_nonresidental",action:"update"},{data:n},reload_page)}},function(e){w2ui.topmost_layout.unlock("main");var t=$("body").data("data");t.__read_only=1,t.item._can={edit:1,update:1,cancel:1,annul:1-t.item.is_annuled,restore:t.item.is_annuled},e(t)}}),define("app/data/premise_nonresidental_passport",[],function(){return $_DO.patch_premise_nonresidental_passport=function(e){var t=this,i=t.columns[e.column],n=i.editable(t.get(e.recid)),o={k:"f_"+e.recid,v:normalizeValue(e.value_new,n.type)};null!=o.v&&(o.v=String(o.v)),t.lock();var a={type:"premises_nonresidental",action:"update"},r={};r[o.k]=o.v,query(a,{data:r},function(){var e=$("body").data("data");e.item[o.k]=o.v,$("body").data("data",e),t.unlock(),$_F5()})},function(e){var t=$("body").data("data");t.doc_fields={},query({type:"premises_nonresidental",part:"passport_fields"},{},function(n){var o=n.vc_pass_fields,a={};$.each(o,function(){if(this.recid=this.id,this.name="f_"+this.id,this.value=t.item[this.name],this.is_mandatory&&(this.w2ui={class:"status_warning"}),this.voc){var e="vc_nsi_"+this.voc;n[e]&&(a[e]=1)}3==this.id_type&&(t.doc_fields[this.id]=1,t.doc_fields[this.id_dt]=1,t.doc_fields[this.id_no]=1)}),add_vocabularies(n,a);for(i in a)t[i]=n[i];t.vc_pass_fields=o,$("body").data("data",t),e(t)}),w2ui.topmost_layout.unlock("main")}}),define("app/data/premise_nonresidental_popup",[],function(){return $_DO.update_premise_nonresidental_popup=function(e){var t=w2ui.premise_nonresidental_new_form,n=t.values();null!=n.premisesnum&&""!=n.premisesnum||die("premisesnum","Укажите, пожалуйста, номер помещения"),/[0-9А-ЯЁа-яёA-Za-z]/.test(n.premisesnum)||die("premisesnum","Некорректный номер помещения"),parseFloat(n.totalarea||"0")<.01&&die("totalarea","Необходимо указать размер общей плошади");var o={type:"premises_nonresidental"};if(o.id=t.record.id,o.action=o.id?"update":"create","create"==o.action){var a=w2ui.house_premises_nonresidental_grid;$.each(a.records,function(){this.terminationdate||this.premisesnum==n.premisesnum&&die("premisesnum","Помещение с таким заводским номером уже зарегистрировано")}),n.uuid_house=$_REQUEST.id}var r={f_20053:1,f_20054:1,f_20056:1};for(i in r)n[i]=n[i]?[n[i]]:[];query(o,{data:n},reload_page)},function(e){var t=clone($("body").data("data"));t.record=$_SESSION.get("record"),sessionStorage.removeItem("record"),e(t)}}),define("app/data/premise_nonresidental",[],function(){return $_DO.choose_tab_premise_nonresidental=function(e){var t=e.tab.id,i=w2ui.topmost_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("premise_nonresidental.active_tab",t),use.block(t)},function(e){query({type:"premises_nonresidental"},{},function(t){add_vocabularies(t,{vc_nsi_17:1,vc_nsi_330:1}),t.item.label=t.item.premisesnum,t.active_tab=localStorage.getItem("premise_nonresidental.active_tab")||"premise_nonresidental_common",t.item.address=t.item["tb_houses.address"],$("body").data("data",t),e(t)})}}),define("app/data/premise_residental_common_living_rooms",[],function(){return $_DO.create_premise_residental_common_living_rooms=function(e){$("body").data("data").item.is_annuled&&die("foo","Создание вложенных объектов запрещено, так как данная запись аннулирована"),$_SESSION.set("record",{}),use.block("living_room_popup")},$_DO.delete_premise_residental_common_living_rooms=function(e){e.force&&($(".w2ui-message").remove(),e.preventDefault(),query({type:"living_rooms",id:w2ui[e.target].getSelection()[0].recid,action:"delete"},{},reload_page))},$_DO.patch_premise_residental_common_living_rooms=function(e){var t=this,i=t.columns[e.column],n={k:i.field,v:normalizeValue(e.value_new,i.editable.type)};"premisesnum"==n.k&&$.each(t.records,function(){this.terminationdate||this.id!=e.recid&&this.premisesnum==n.v&&(e.preventDefault(),die("foo","Блок с таким номером уже зарегистрирован"))}),null!=n.v&&(n.v=String(n.v)),t.lock();var o={type:"living_rooms",action:"update",id:e.recid},a={};a[n.k]=n.v,query(o,{data:a},function(){t.unlock(),t.reload()},edit_failed(t,e))},function(e){var t=w2ui.passport_layout;t&&t.unlock("main");var i=$("body").data("data");i.vc_is_nrs=[{id:"0",label:"Жилое помещение"},{id:"1",label:"Нежилое помещение"}],add_vocabularies(i,{vc_is_nrs:1}),$("body").data("data",i),get_nsi([17,14,30,254,253,261,259,258],e)}}),define("app/data/premise_residental_common",[],function(){var e="premise_residental_common_form";return $_DO.restore_premise_residental_common=function(e){confirm("Удалить запись об аннулировании объекта?")&&query({type:"premises_residental",id:$_REQUEST.id,action:"update"},{data:{terminationdate:null,annulmentinfo:null,code_vc_nsi_330:null}},reload_page)},$_DO.annul_premise_residental_common=function(e){use.block("annul_popup")},$_DO.choose_tab_premise_residental_common=function(e){var t=e.tab.id,i=w2ui.premise_residental_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("premise_residental_common.active_tab",t),use.block(t)},$_DO.cancel_premise_residental_common=function(t){if(confirm("Отменить несохранённые правки?")){w2ui[e].record;query({type:"premises_residental"},{},function(e){e.__read_only=!0,$_F5(e)})}},$_DO.edit_premise_residental_common=function(t){var i={item:w2ui[e].record};if(i.item.is_annuled)return alert("Поскольку данный объект жилого фонда аннулирован, редактирование невозможно."),t.preventDefault();i.__read_only=!1;w2ui[e];$_F5(i)},$_DO.update_premise_residental_common=function(t){if(confirm("Сохранить изменения?")){var i=w2ui[e],n=i.values();null!=n.premisesnum&&""!=n.premisesnum||die("premisesnum","Укажите, пожалуйста, номер помещения"),/[0-9А-ЯЁа-яёA-Za-z]/.test(n.premisesnum)||die("premisesnum","Некорректный номер помещения"),n.code_vc_nsi_30||die("code_vc_nsi_30","Необходимо указать характеристику помещения"),parseFloat(n.totalarea||"0")<.01&&die("totalarea","Необходимо указать размер общей плошади"),parseFloat(n.grossarea||"0")<.01&&die("grossarea","Необходимо указать размер жилой плошади"),query({type:"premises_residental",action:"update"},{data:n},reload_page)}},function(e){w2ui.topmost_layout.unlock("main");var t=$("body").data("data");t.__read_only=1,t.item._can={edit:1,update:1,cancel:1,annul:1-t.item.is_annuled,restore:t.item.is_annuled},t.active_tab=localStorage.getItem("premise_residental_common.active_tab")||"premise_residental_common_living_rooms",e(t)}}),define("app/data/premise_residental_invalid",[],function(){var e="premise_residental_invalid_form";return $_DO.download_premise_residental_invalid=function(t){function i(e,t){return String(Math.round(100*e/t))+"%"}var n=w2ui[e].box;w2utils.lock(n,i(0,1)),download({type:"house_docs",id:$("body").data("data").file.uuid,action:"download"},{},{onprogress:function(e,t){$(".w2ui-lock-msg").html("<br><br>"+i(e,t))},onload:function(){w2utils.unlock(n)}})},$_DO.cancel_premise_residental_invalid=function(t){if(confirm("Отменить несохранённые правки?")){w2ui[e].record;query({type:"premises_residental"},{},function(e){e.__read_only=!0,$_F5(e)})}},$_DO.edit_premise_residental_invalid=function(t){var i={item:w2ui[e].record};i.__read_only=!1;w2ui[e];$_F5(i)},$_DO.update_premise_residental_invalid=function(t){function i(){$.each(a.file,function(){Base64file.upload(this.file,y)})}if(confirm("Сохранить изменения?")){var n=w2ui[e],o=n.values();if(o.file){var a=n.record;if(a.f_20127||die("f_20127","Укажите, пожалуйста, основание признания данного помещения непригодным для проживания"),!a.f_20128)return $("input[name=f_20128]").focus(),alert("Укажите, пожалуйста, дату документа");if(!/^\d\d\.\d\d\.\d\d\d\d$/.test(a.f_20128))return $("input[name=f_20128]").focus(),alert("Некорректная дата документа");if(!a.f_20129)return $("input[name=f_20129]").focus(),alert("Укажите, пожалуйста, номер документа");if(!a.file||0==a.file.length)return $("input[name=file]").focus(),alert("Вы не указали файл");for(var r=a.file.length,s={pdf:1,doc:1,docx:1,rtf:1,xls:1,xlsx:1,jpg:1,jpeg:1},d=0,c=0;c<r;c++){var u=a.file[c].file,l=u.name;if(l.length>255)return alert("Некорректное имя файла: "+l+". Согласно требованиям ГИС ЖКХ, его длина не может превышать 255 символов");var _=l.split(".");if(_.length<2)return alert("Некорректное имя файла: "+l+" (невозможно определить расширение)");if(!s[_[_.length-1]]){var p=[];for(var t in s)p.push(t);return alert("Некорректное имя файла: "+l+".\n\nСогласно требованиям ГИС ЖКХ, разрешены следующие: "+p.sort().join(", ")+".")}if(u.size>10485760)return alert("Файл "+l+" имеет недопустимо большой объём. Согласно требованиям ГИС ЖКХ, его величина не может превышать 10 Мб.");d+=u.size}$(".w2ui-buttons button").hide();var f=$("progress");f.prop({max:d,value:0}).show();var m=0;n.lock();var v=($("body").data("data"),{uuid:$_REQUEST.id,no:o.f_20129,dt:o.f_20128,id_file_type:"20820",note:""}),r=a.file.length,h=setInterval(function(){r||(clearInterval(h),$_DO.apologize=$.noop,query({type:"premises_residental",action:"update"},{data:{f_20127:o.f_20127}},reload_page))},100),y={data:v,type:"house_docs",onprogress:function(e,t){m+=131072,f.val(m)},onloadend:function(){r--}},u=$("body").data("data").file;u?query({type:"house_docs",id:u.uuid,action:"delete"},{},i):i()}else query({type:"premises_residental",action:"update"},{data:o},reload_page)}},function(e){w2ui.topmost_layout.unlock("main");var t=$("body").data("data");t.__read_only=1,e(t)}}),define("app/data/premise_residental_passport",[],function(){return $_DO.patch_premise_residental_passport=function(e){var t=this,i=t.columns[e.column],n=i.editable(t.get(e.recid)),o={k:"f_"+e.recid,v:normalizeValue(e.value_new,n.type)};null!=o.v&&(o.v=String(o.v)),t.lock();var a={type:"premises_residental",action:"update"},r={};r[o.k]=o.v||null,query(a,{data:r},function(){var e=$("body").data("data");if(e.item[o.k]=o.v,$("body").data("data",e),"f_20126"==o.k){var i=w2ui.topmost_layout.get("main").tabs,n="premise_residental_invalid";0==o.v?query({type:"premises_residental",action:"update"},{data:{f_20127:null,f_20128:null,f_20129:null}},function(){e.file?query({type:"house_docs",id:e.file.uuid,action:"delete"},{},reload_page):reload_page()}):(t.unlock(),i.show(n),$_F5(),confirm("Перейти ко вводу документа о непригодности для проживания?")&&i.click(n))}else t.unlock(),$_F5()})},function(e){var t=$("body").data("data");t.doc_fields={},query({type:"premises_residental",part:"passport_fields"},{},function(n){var o=n.vc_pass_fields,a={};$.each(o,function(){if(this.recid=this.id,this.name="f_"+this.id,this.value=t.item[this.name],this.is_mandatory&&(this.w2ui={class:"status_warning"}),this.voc){var e="vc_nsi_"+this.voc;n[e]&&(a[e]=1)}3==this.id_type&&(t.doc_fields[this.id]=1,t.doc_fields[this.id_dt]=1,t.doc_fields[this.id_no]=1)}),add_vocabularies(n,a);for(i in a)t[i]=n[i];t.vc_pass_fields=o,$("body").data("data",t),e(t)}),w2ui.topmost_layout.unlock("main")}}),define("app/data/premise_residental_popup",[],function(){return $_DO.update_premise_residental_popup=function(e){var t=w2ui.premise_residental_new_form,n=t.values();null!=n.premisesnum&&""!=n.premisesnum||die("premisesnum","Укажите, пожалуйста, номер помещения"),/[0-9А-ЯЁа-яёA-Za-z]/.test(n.premisesnum)||die("premisesnum","Некорректный номер помещения"),null==n.uuid_entrance&&die("uuid_entrance","Укажите, пожалуйста, номер подъезда"),n.code_vc_nsi_30||die("code_vc_nsi_30","Необходимо указать характеристику помещения"),parseFloat(n.totalarea||"0")<.01&&die("totalarea","Необходимо указать размер общей плошади"),parseFloat(n.grossarea||"0")<.01&&die("grossarea","Необходимо указать размер жилой плошади"),n.f_20002||die("f_20002","Необходимо указать количество комнат");var o={type:"premises_residental"};if(o.id=t.record.id,o.action=o.id?"update":"create","create"==o.action){var a=w2ui.house_premises_residental_grid;$.each(a.records,function(){this.terminationdate||this.premisesnum==n.premisesnum&&die("premisesnum","Помещение с таким заводским номером уже зарегистрировано")}),n.uuid_house=$_REQUEST.id}var r={f_20053:1,f_20054:1,f_20056:1};for(i in r)n[i]=n[i]?[n[i]]:[];query(o,{data:n},reload_page)},function(e){var t=clone($("body").data("data"));t.record=$_SESSION.get("record"),sessionStorage.removeItem("record"),e(t)}}),define("app/data/premise_residental",[],function(){return $_DO.choose_tab_premise_residental=function(e){var t=e.tab.id,i=w2ui.topmost_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("premise_residental.active_tab",t),use.block(t)},function(e){query({type:"premises_residental"},{},function(t){add_vocabularies(t,{tb_entrances:1,vc_nsi_30:1,vc_nsi_273:1,vc_nsi_330:1});var i=t.vc_nsi_30[t.item.code_vc_nsi_30]||"помещение",n=i.indexOf("вартира")<0?i:"кв.";t.item.label=n+" "+t.item.premisesnum,t.item.address=t.item["tb_houses.address"],$("body").data("data",t),e(t)})}}),define("app/data/rosters",[],function(){return $_DO.choose_tab_rosters=function(e){var t=w2ui.rosters_layout;t&&(t.content("main",""),t.lock("main","Загрузка...",!0));var i=e.tab.id;localStorage.setItem("rosters.active_tab",i),use.block(i)},function(e){var t={};t.active_tab=localStorage.getItem("rosters.active_tab")||"houses",e(t)}}),define("app/data/user_password",[],function(){return $_DO.update_user_password=function(e){var t=w2ui.passwordForm.record;if(!t.p1)return alert("Вы не ввели пароль");if(!t.p2)return alert("Ввод пароля необходимо повторить");if(t.p1!=t.p2)return alert("Вам не удалось ввести одно значение пароля дважды");$_REQUEST._secret=["password"];var i=$_SESSION.get("record");query({type:"voc_users",id:i.uuid,action:"set_password"},{data:{password:t.p1}},function(e){alert("Пароль установлен"),i.f?w2popup.close():reload_page()})},function(e){e($("body").data("data"))}}),define("app/data/vc_rd_1",[],function(){return function(e){query({type:"vc_rd_1",part:"vocs"},{},function(t){t.vc_rd_1240.unshift({id:0,label:"[пусто]"}),t.vc_rd_1540.unshift({id:0,label:"[пусто]"}),add_vocabularies(t,{vc_rd_1240:1,vc_rd_1540:1}),e(t)})}}),define("app/data/voc_nsi_list",[],function(){function e(){if($_USER.role.admin)return!0;for(var e=0;e<arguments.length;e++)if($_USER.role["nsi_20_"+arguments[e]])return!0;return!1}return $_DO.open_nsi_list=function(e){var t=e.target,i=parseInt(t)>0?"voc_nsi":t;i&&!/[A-Z]$/.test(i)&&(w2utils.lock($(w2ui.vocs_layout.el("main")),{spinner:!0}),use.block(i))},function(t){query({type:"voc_nsi_list"},{},function(i){var n=[];e(1,19,20,21,36,2)&&n.push({id:"add_services",text:"Дополнительные услуги"}),e(1,19,20,21,36,2)&&n.push({id:"municipal_services",text:"Коммунальные услуги"}),e(1,19,20,21)&&n.push({id:"org_works",text:"Работы и услуги организаций"}),e(1,19,20,21,36)&&n.push({id:"insurance_products",text:"Страховые продукты"}),n.length&&i.vc_nsi_list_group.unshift({name:"_ORG",label:"Справочники организаций",nodes:n});var o={};$.each(i.vc_nsi_list_group,function(){this.img="icon-folder",this.id=this.name,this.text=this.label,this.nodes||(this.nodes=[]),o[this.name]=this});var a={};$.each(i.vc_nsi_list,function(){a[this.id]=this.text,o[this.listgroup].nodes.push(this)}),$("body").data("vc_nsi_list",a),t(i)})}}),define("app/data/voc_nsi",[],function(){function e(){return w2ui.sidebar?w2ui.sidebar.selected:$_REQUEST.id}function t(){var t="nsi_grid_"+e();return w2ui[t]}function i(e){(t()||e).lock("Импорт...",!0)}function n(e){var t=e.item["out_soap.id_status"];return t>0&&t<3}function o(){var t=setInterval(function(){query({type:"voc_nsi_list",id:e()},{},function(e){if(!n(e)){var i=e.item["out_soap.err_code"];if(i){var o=e.item["out_soap.err_text"];o&&(i+=" "+o),w2alert('При импорте спавочника из ГИС ЖКХ произошла ошибка"'+i+'"',"")}clearInterval(t),use.block("voc_nsi")}})},6e3)}return $_DO.check_status_voc_nsi=function(e){n($("body").data("data"))&&e.done(function(){i(this),o()})},$_DO.import_voc_nsi=function(t){i(),query({type:"voc_nsi_list",id:e(),action:"import"},{},function(){o()})},function(t){query({type:"voc_nsi_list",id:e()},{},function(i){i.id=e(),i.records=dia2w2uiRecords(i.records||[]),i.item.cols=JSON.parse(i.item.cols||"[]");var n={};i.vc_okei&&(n.vc_okei=1),$.each(i.item.cols,function(){this.ref&&(n["vc_nsi_"+this.ref]=1)}),add_vocabularies(i,n),$("body").data("data",i),t(i)})}}),define("app/data/voc_organization_individual",[],function(){return function(e){query({type:"voc_organizations"},{},function(t){$("body").data("data",t),get_nsi([20],e)})}}),define("app/data/voc_organization_legal_users",[],function(){return $_DO.delete_voc_organization_legal_users=function(e){e.force&&($(".w2ui-message").remove(),e.preventDefault(),query({type:"voc_users",id:w2ui[e.target].getSelection()[0],action:"delete"},{},reload_page))},$_DO.create_voc_organization_legal_users=function(e){$_SESSION.set("record",{}),use.block("voc_user_popup")},$_DO.edit_voc_organization_legal_users=function(e){var t=w2ui[e.target];$_SESSION.set("record",t.get(e.recid)),use.block("voc_user_popup")},function(e){var t=w2ui.topmost_layout;t&&t.unlock("main"),query({type:"voc_users",part:"vocs",id:void 0},{},function(t){add_vocabularies(t,t),$("body").data("data",t),e(t)})}}),define("app/data/voc_organization_legal",[],function(){return $_DO.choose_tab_voc_organization_legal=function(e){var t=e.tab.id,i=w2ui.topmost_layout;i&&(i.content("main",""),i.lock("main","Загрузка...",!0)),localStorage.setItem("voc_organization_legal.active_tab",t),use.block(t)},function(e){query({type:"voc_organizations"},{},function(t){$("body").data("data",t),get_nsi([20],e)})}}),define("app/data/voc_organizations_popup",[],function(){return function(e){e({})}}),define("app/data/voc_organizations",[],function(){return $_DO.check_voc_organizations=function(e){function t(){w2alert("Поиск по заданному условию не дал результатов.<br><br>Попробуйте ввести в поле поиска полный точное значение ОГРН[ИП].")}function i(e,t){w2confirm(t+" "+e+" не найден. Запросить информацию в ГИС ЖКХ?").yes(function(){$_SESSION.set("importing",1),n.lock("Запрос в ГИС ЖКХ...",!0),query({type:"voc_organizations",action:"import",id:void 0},{data:{ogrn:e}},function(){setTimeout(function(){n.request("get")},5e3)})})}var n=w2ui[e.target],o=n.last;if("OR"!=o.logic)return t();var a=(o.search||"").trim();if(!(parseInt(a)>0))return t();switch(a.length){case 13:return i(a,"ОГРН");case 15:return i(a,"ОГРНИП");default:return t()}},function(e){var t=w2ui.rosters_layout;t&&t.unlock("main"),query({type:"voc_organizations",part:"vocs",id:void 0},{},function(t){add_vocabularies(t,t),$("body").data("data",t),e(t)})}}),define("app/data/voc_rd_nsi_popup",[],function(){return $_DO.close_voc_rd_nsi_popup=function(e){w2popup.close()},$_DO.update_voc_rd_nsi_popup=function(e){w2popup.lock("Сохраняем данные...",!0);var t={ids:[],code:w2ui.voc_rd_nsi_popup_form.values().code};for(var i in $_SESSION.get("ids"))i>0&&t.ids.push(parseInt(i));var i=$("body").data("data").id;query({type:"voc_rd_voc",id:i,action:"set_nsi"},{data:t},function(){w2ui["rd_cols_grid_"+i].reload(),w2popup.unlock(),sessionStorage.removeItem("is_dirty")})},function(e){var t={};t.vc_nsi_list=$("body").data("vc_nsi_list");var i={id:$("body").data("data").nsi.ref};i.text=t.vc_nsi_list[i.id],t.vc_nsi_list.items=[i],t.nsi_voc=$("body").data("data").nsi.items,add_vocabularies(t,{nsi_voc:1}),t.record={registrynumber:i},$_SESSION.set("ids",{}),sessionStorage.removeItem("is_dirty"),e(t)}}),define("app/data/voc_rd_voc",[],function(){function e(){return w2ui.sidebar.selected.substr("rd_voc_".length)}function t(){var t="rd_cols_grid_"+e();return w2ui[t]}function i(e){(t()||e).lock("Импорт...",!0)}return $_DO.open_popup_voc_rd_voc=function(e){var t=$("body").data("data");return t.item.code_vc_nsi_197?t.nsi.items?void use.block("voc_rd_nsi_popup"):alert('Сопоставленный справочник ГИС ЖКХ "'+t.nsi.label+'" не загружен'):alert("Для синхронизации справочников необходимо сопоставить данный атрибут ИС с показателем ГИС ЖКХ")},$_DO.import_voc_rd_voc=function(n){i(),query({type:"voc_rd_voc",id:e(),action:"import"},{},function(){t().reload()})},function(t){var i=e();query({type:"voc_rd_voc",id:e()},{},function(e){e.id=i,e.nsi&&e.nsi.ref&&(e.nsi.href="/voc_nsi/"+e.nsi.ref),$("body").data("data",e),e.nsi&&$.each(e.nsi.items,function(){e.nsi[this.id]=this.label}),t(e)})}}),define("app/data/voc_rd",[],function(){function e(){return w2ui.sidebar.selected.substr("rd_cols_".length)}function t(){var t="rd_cols_grid_"+e();return w2ui[t]}function i(e){(t()||e).lock("Импорт...",!0)}return $_DO.import_voc_rd=function(n){i(),query({type:"voc_rd_list",id:e(),action:"import"},{},function(){t().reload()})},$_DO.check_voc_rd=function(e){var i=e.value_new;if(i.id){var n=i.tp;if(!n)return e.preventDefault(),void alert("Выбранная строка — не отдельное поле, а заголовок раздела. Операция отменена");var o=t().get(e.recid),a=o["vc_rd_col_types.gislabel"];a!=n&&(confirm('Указано "'+n+'" как источник данных для поля с типом "'+a+'". Вы уверены, что здесь нет ошибки?')||e.preventDefault())}},$_DO.update_voc_rd=function(e){if(e.preventDefault(),confirm("Сохранить изменения?")){t().lock("Сохранение...",!0);query({type:"voc_rd_list",action:"update"},{data:{vc_rd_cols:e.changes.map(function(e){return{id:e.recid,code_vc_nsi_197:e.code_vc_nsi_197.id}})}},function(){t().reload()})}},function(t){var i=e();query({type:"voc_rd_list",id:e()},{},function(e){e.id=i,$.each(e.vc_nsi_197,function(){this.ord_src=this.ord,this.ord=this.ord.split(".").map(function(e){return"0000".substr(0,3-e.length)+e}).join(""),this.label=this.ord_src+". "+this.label}),e.vc_nsi_197.sort(function(e,t){return e.ord<t.ord?-1:e.ord>t.ord?1:0}),e.vc_nsi_197.unshift({id:"",label:"(пусто)"}),add_vocabularies(e,{vc_nsi_197:1}),delete e.vc_nsi_197[""],$("body").data("data",e),t(e)})}}),define("app/data/voc_user_popup",[],function(){return $_DO.set_password_voc_user_popup=function(e){$_SESSION.set("record",w2ui.voc_user_form.record),use.block("user_password")},$_DO.update_voc_user_popup=function(e){var t=w2ui.voc_user_form,i=t.values(),n=/^[А-ЯЁ][а-яё\-]*$/;i.f||die("f","Укажите, пожалуйста, фамилию оператора"),n.test(i.f)||die("f","Фамилия содержит некорректные символы"),i.i||die("i","Укажите, пожалуйста, имя оператора"),n.test(i.i)||die("i","Имя содержит некорректные символы"),!i.o||n.test(i.o)&&/[ач]$/.test(i.o)||die("o","Отчество указано некорректно");var o={type:"voc_users"};o.id=t.record.id,o.action=o.id?"update":"create";var a=reload_page
;"create"==o.action&&(i.uuid_org=$_REQUEST.id,a=function(e){$_SESSION.set("record",e),use.block("user_password")}),query(o,{data:i},a)},function(e){var t=clone($("body").data("data"));t.record=$_SESSION.delete("record"),e(t)}}),define("app/data/voc_users",[],function(){return $_DO.delete_voc_users=function(e){e.force&&($(".w2ui-message").remove(),e.preventDefault(),query({type:"voc_users",id:w2ui[e.target].getSelection()[0],action:"delete"},{},reload_page))},$_DO.create_voc_users=function(e){confirm("На этой странице можно создавать только УЗ администраторов.\n\nУЗ оператора, связанного с поставщиком данных, можно создать на странице соответствующей организации (соседняя вкладка).\n\nСоздать УЗ администратора системы?\n")&&($_SESSION.set("record",{}),use.block("voc_user_popup"))},$_DO.edit_voc_users=function(e){var t=w2ui[e.target];$_SESSION.set("record",t.get(e.recid)),use.block("voc_user_popup")},function(e){var t=w2ui.rosters_layout;t&&t.unlock("main"),query({type:"voc_users",part:"vocs",id:void 0},{},function(t){add_vocabularies(t,t),$("body").data("data",t),e(t)})}}),define("app/view/add_service_common_log",[],function(){return function(e,t){e=$("body").data("data"),$(w2ui.passport_layout.el("main")).w2regrid({name:"add_service_common_log",show:{toolbar:!0,toolbarInput:!1,footer:!0},columnGroups:[{span:3,caption:"Событие"},{span:3,caption:"Значения полей"},{span:4,caption:"Запрос в ГИС ЖКХ"}],columns:[{field:"ts",caption:"Дата/время",size:30,render:_ts},{field:"action",caption:"Действие",size:30,voc:{create:"Создание",update:"Редактирование",delete:"Удаление",undelete:"Восстановление"}},{field:"vc_users.label",caption:"Оператор",size:30},{field:"additionalservicetypename",caption:"Наименование",size:50},{field:"okei",caption:"Ед. изм.",size:10,voc:e.vc_okei},{field:"is_deleted",caption:"Статус",size:20,voc:{0:"Актуально",1:"Удалено"}},{field:"soap.ts",caption:"Отправлено",size:30,render:_ts,attr:"data-ref=1"},{field:"soap.ts_rp",caption:"Обработано",size:30,render:_ts,attr:"data-ref=1"},{field:"soap.id_status",caption:"Статус",size:30,render:function(e,t,i,n){switch(n){case 3:return"Обработано";case 2:return"Ожидает ответа";default:return"Ожидает отправки"}}},{field:"soap.err_text",caption:"Ошибка",size:30}],url:"/mosgis/_rest/?type=add_services&part=log&id="+$_REQUEST.id,onClick:function(e){var t=this.columns[e.column],i=this.get(e.recid);switch(t.field){case"soap.ts":if(i.uuid_out_soap)return openTab("/out_soap_rq/"+i.uuid_out_soap);case"soap.ts_rp":if(i.uuid_message)return openTab("/out_soap_rp/"+i.uuid_message)}}}).refresh()}}),define("app/view/add_service_common",[],function(){var e="add_service_common_form";return function(t,i){$_F5=function(t){t.item.__read_only=t.__read_only;var i=clone(t.item);w2ui[e].record=i,$("div[data-block-name=add_service_common] input").prop({disabled:t.__read_only}),w2ui[e].refresh()};var n=w2ui.topmost_layout,o=$(n.el("main"));o.w2relayout({name:"passport_layout",panels:[{type:"top",size:150},{type:"main",size:400,tabs:{tabs:[{id:"add_service_common_log",caption:"История изменений"}],onClick:$_DO.choose_tab_add_service_common}}],onRender:function(e){this.get("main").tabs.click(t.active_tab)}});var o=$(w2ui.passport_layout.el("top"));fill(i,t.item,o),o.w2reform({name:e,record:t.item,fields:[{name:"additionalservicetypename",type:"text"},{name:"okei",type:"list",options:{items:t.vc_okei.items}}],focus:-1}),$_F5(t)}}),define("app/view/add_service_popup",[],function(){return function(e,t){$(fill(t,e.record)).w2uppop({},function(){$("#w2ui-popup .w2ui-form").w2reform({name:"voc_user_form",record:e.record,fields:[{name:"additionalservicetypename",type:"text"},{name:"okei",type:"list",options:{items:e.vc_okei.items}}]})})}}),define("app/view/add_service",[],function(){return function(e,t){$("title").text(e.item.label),fill(t,e.item,$("body")),$("#container").w2layout({name:"topmost_layout",panels:[{type:"main",size:400,tabs:{tabs:[{id:"add_service_common",caption:"Общие"}].filter(not_off),onClick:$_DO.choose_tab_add_service}}],onRender:function(e){clickActiveTab(this.get("main").tabs,"add_service.active_tab")}})}}),define("app/view/add_services",[],function(){function e(e){e.done(function(){var e=w2ui.add_services_grid,i=e.toolbar;i.disable(t[0]),1==e.getSelection().length&&i.enable(t[e.get(e.getSelection()[0]).is_deleted])})}var t=["delete","undelete"];return function(i,n){i=$("body").data("data"),$(w2ui.vocs_layout.el("main")).w2regrid({name:"add_services_grid",show:{toolbar:!0,toolbarAdd:!$_USER.role.admin,toolbarEdit:!$_USER.role.admin,footer:!0},toolbar:{items:[{type:"button",id:t[0],caption:"Удалить",onClick:$_DO.delete_add_services,disabled:!0,off:$_USER.role.admin}].filter(not_off)},searches:[{field:"label_uc",caption:"Наименование",type:"text"},{field:"is_deleted",caption:"Статус записи",type:"enum",options:{items:[{id:"0",text:"Актуальные"},{id:"1",text:"Удалённые"}]}},{field:"id_status",caption:"Статус синхронизации",type:"enum",options:{items:i.vc_async_entity_states.items}},{field:"uuid_org",caption:"Организации",type:"enum",options:{items:i.vc_orgs.items},off:!$_USER.role.admin}].filter(not_off),columns:[{field:"org.label",caption:"Организация",size:100,off:!$_USER.role.admin},{field:"label",caption:"Наименование",size:50},{field:"okei",caption:"Ед. изм.",size:10,voc:i.vc_okei},{field:"id_status",caption:"Статус",size:50,render:function(e,t,n,o){var a=i.vc_async_entity_states[o];return 30==o&&(a="<font color=red>"+a+"</font>: ",a+=e.out_soap.err_text),a}}].filter(not_off),url:"/mosgis/_rest/?type=add_services",onAdd:$_DO.create_add_services,onEdit:$_DO.edit_add_services,onDblClick:function(e){openTab("/add_service/"+e.recid)},onRefresh:function(e){e.done(color_data_mandatory)},onSelect:e,onUnselect:e}).refresh()}}),define("app/view/admin",[],function(){return function(e,t){var i=w2ui.topmost_layout;i.unlock("main"),$(i.el("main")).w2relayout({name:"admin_layout",panels:[{type:"main",size:400,tabs:{tabs:[{id:"vc_rd_1",caption:"Реестр объектов ГИС РД"},{id:"open_data",caption:"Реестр адресов OpenData"}],onClick:$_DO.choose_tab_admin}}],onRender:function(t){this.get("main").tabs.click(e.active_tab)}})}}),define("app/view/annul_popup",[],function(){return function(e,t){$(t).w2uppop({},function(){$("#w2ui-popup .w2ui-form").w2reform({name:"annul_popup_form",record:e.record,fields:[{name:"terminationdate",type:"date",options:{end:e.record.terminationdate}},{name:"annulmentinfo",type:"text"},{name:"code_vc_nsi_330",type:"list",options:{items:e.vc_nsi_330.items}}],focus:1})})}}),define("app/view/block_common_living_rooms",[],function(){return function(e,t){var i=clone($("body").data("data")),n=i.item;n.usedyear||(n.usedyear=1600),$(w2ui.passport_layout.el("main")).w2regrid({name:"block_common_living_rooms_grid",selectType:"cell",multiSelect:!1,show:{toolbar:!0,footer:!0,toolbarAdd:!0,toolbarDelete:!0,toolbarInput:!1,toolbarSearch:!0,toolbarReload:!1},columnGroups:[{master:!0},{master:!0},{master:!0},{master:!0},{master:!0},{span:3,caption:"Непригодность"},{master:!0}],searches:[{field:"is_annuled",caption:"Актуальность",type:"enum",options:{items:[{id:0,text:"Актуальные"},{id:1,text:"Аннулированные"}]}}],last:{logic:"AND"},searchData:[{field:"is_annuled",operator:"in",type:"enum",value:[{id:0,text:"Актуальные"}]}],columns:[{field:"roomnumber",caption:"№",tooltip:"№ комнаты",size:7},{field:"cadastralnumber",caption:"Кадастровый №",tooltip:"Кадастровый #",size:10,editable:{type:"text"}},{field:"square",attr:"data-mandatory",caption:"Площадь, м²",tooltip:"Общая площадь",size:5,editable:{type:"float",min:0}},{field:"f_20130",attr:"data-living",caption:"К-во проживающих",tooltip:"Количество проживающих",size:5,editable:{type:"int"}},{field:"f_20056",caption:"Э/оборудование",tooltip:"Наличие электрооборудования",size:7,voc:i.vc_nsi_261,hidden:!0},{field:"f_20132",caption:"Основание",size:10,voc:i.vc_nsi_273,hidden:!0},{field:"f_20133",caption:"Дата",size:10,render:_dt,hidden:!0},{field:"f_20134",caption:"№ док.",size:10,hidden:!0},{field:"terminationdate",caption:"Дата аннулирования",render:_dt,size:20,hidden:!0}],postData:{data:{uuid_block:$_REQUEST.id}},url:"/mosgis/_rest/?type=living_rooms",onDblClick:function(e){this.columns[e.column].editable||openTab("/living_room/"+e.recid)},onAdd:$_DO.create_block_common_living_rooms,onDelete:$_DO.delete_block_common_living_rooms,onChange:$_DO.patch_block_common_living_rooms,onEditField:function(e){var t=this,i=t.get(e.recid);if(i.is_annuled)return e.preventDefault();var n=t.columns[e.column];if(/data-living/.test(n.attr)&&1==i.is_nrs)return e.preventDefault();var o=n.editable,a=i[n.field];"date"==o.type?e.value=a?new Date(a.substr(0,10)):new Date:e.value=a},onRefresh:function(e){var t=this;e.done(function(){$("tr[recid] td[data-mandatory]").each(function(){var e=$(this);if(!(e.text()||"Н"==e.closest("tr").text().charAt(0)&&e.is("[data-living]"))){var t={title:"Обязательное поле"};e.css({background:"#ffcccc"}).prop(t),$("*",e).prop(t)}}),$("tr[recid]").each(function(){var e=$(this);t.get(e.attr("recid")).is_annuled&&$("td",e).css({background:"#ccc"})})})}}).refresh()}}),define("app/view/block_common",[],function(){return function(e,t){$_F5=function(e){e.item.__read_only=e.__read_only;var t=clone(e.item);/-/.test(t.terminationdate)&&(t.terminationdate=dt_dmy(t.terminationdate.substr(0,10))),w2ui.block_common_form.record=t,$("div[data-block-name=block_common] input").prop({disabled:e.__read_only}),w2ui.block_common_form.refresh()};var i=w2ui.topmost_layout,n=$(i.el("main"));n.w2relayout({name:"passport_layout",panels:[{type:"top",size:e.item.is_nrs?210:310},{type:"main",size:400,tabs:{tabs:[{id:"block_common_living_rooms",caption:"Комнаты",off:e.item.is_nrs}],onClick:$_DO.choose_tab_block_common}}],onRender:function(t){this.get("main").tabs.click(e.active_tab)}});var n=$(w2ui.passport_layout.el("top"));e.item.annulmentreason_label=e.vc_nsi_330[e.item.annulmentreason],fill(t,e.item,n),n.w2reform({name:"block_common_form",record:e.item,fields:[{name:"blocknum",type:"text"},{name:"cadastralnumber",type:"text"},{name:"code_vc_nsi_30",type:"list",options:{items:e.vc_nsi_30.items},_no_nrs:1},{name:"totalarea",type:"float",options:{min:0}},{name:"grossarea",type:"float",options:{min:0},_no_nrs:1},{name:"f_20002",type:"list",options:{items:e.vc_nsi_14.items},_no_nrs:1}],onChange:function(t){var i=this;"is_nrs"==t.target&&t.done(function(){var n=1==t.value_new.id;$.each(i.fields,function(){this._no_nrs&&(this.$el.prop("disabled",n),n&&delete i.record[this.name])}),n||i.record.code_vc_nsi_30||(i.record.code_vc_nsi_30=e.vc_nsi_30.items[2]),i.refresh()})},focus:-1}),$_F5(e)}}),define("app/view/block_invalid",[],function(){var e="block_invalid_form";return function(t,i){$_F5=function(t){var i=clone(t.item);/-/.test(i.f_20128)&&(i.f_20128=dt_dmy(i.f_20128.substr(0,10))),i.__read_only=t.__read_only,w2ui[e].record=i,$("div[data-block-name=block_invalid] input").prop({disabled:i.__read_only}),w2ui[e].refresh()};var n=w2ui.topmost_layout,o=$(n.el("main"));o.w2relayout({name:"passport_layout",panels:[{type:"top",size:200},{type:"main",size:400,tabs:{tabs:[],onClick:$_DO.choose_tab_block_invalid}}],onRender:function(e){this.get("main").tabs.click(t.active_tab)}});var o=$(w2ui.passport_layout.el("top"));fill(i,t.item,o),o.w2reform({name:e,record:t.item,fields:[{name:"f_20127",type:"list",options:{items:t.vc_nsi_273.items}},{name:"f_20128",type:"date",options:{max:new Date}},{name:"f_20129",type:"text"},{name:"file",type:"file",options:{max:1}}].filter(not_off),focus:-1,onRefresh:function(e){e.done(function(){var e=$("body").data("data").file;this.record.__read_only?($("#file_input_div").hide(),e?($("#file_label").text(e.label),clickOn($("#file_label"),$_DO.download_block_invalid)):$("#file_link_div").hide()):$("#file_input_div").show()})}}),$_F5(t)}}),define("app/view/block_passport",[],function(){function e(){return $("body").data("data")}var t={};return function(i,n){$.each(i.vc_pass_fields,function(){t[this.id]=this}),$_F5=function(){var t=w2ui.block_passport_grid,i=e(),n=i.doc_fields;t.records=i.vc_pass_fields.filter(function(e){return 3!=e.id_type}),$.each(t.records,function(){this.w2ui&&delete this.w2ui.changes,this.is_doc=n[this.id],delete this.value}),t.refresh()};var o=w2ui.topmost_layout;$(o.el("main")).w2regrid({name:"block_passport_grid",show:{toolbar:!0,footer:1,toolbarReload:!1,toolbarColumns:!1},textSearch:"contains",columns:[{field:"label",caption:"Реквизит",size:100},{field:"value",caption:"Значение",size:20,attr:"data-status",editable:function(t){switch(t.id_type){case 0:return{type:"int"};case 1:return{type:"float",precision:4,autoFormat:!0,keyboard:!1,min:0};case 2:return{type:"text"};case 4:return{type:"list",items:[{id:0,text:"Нет"},{id:1,text:"Да"}]};case 6:var t=e()["vc_nsi_"+t.voc];return t?{type:"list",items:t.items}:null;case 7:return{type:"int",min:1600,max:2215,autoFormat:!1};case 8:return{type:"date"};default:return null}},render:function(t){var i=e().item[t.name];if(t.is_multiple)switch(t.id_type){case 6:var n=e(),o=n["tb_blocks_f_"+t.id],a="";return $.each(n["vc_nsi_"+t.voc].items,function(){o[this.id]&&(a&&(a+=", "),a+=this.label)}),a;default:return""}else switch(t.id_type){case 4:return 1==i?"Да":"Нет";case 1:return null==i?"":w2utils.formatNumber(i);case 6:var t=e()["vc_nsi_"+t.voc];return t?t[i]:"";case 8:return i?dt_dmy(i.substr(0,10)):"";default:return i}}},{field:"unit",caption:"Ед. изм.",size:5}],records:[],onDblClick:null,onEditField:function(n){if(e().item.is_annuled)return alert("Поскольку данный объект жилого фонда аннулирован, редактирование невозможно."),n.preventDefault();var o=this,a=o.get(n.recid);if(a.is_doc)return alert('Добавление подтверждающих документов осуществляется на вкладке "Документы"'),n.preventDefault();if(a.is_multiple){var r=e(),s={def:a,voc:r["vc_nsi_"+a.voc],ids:r["tb_blocks_f_"+a.id]};return $_SESSION.set("field",s),use.block("passport_multiple_popup"),n.preventDefault()}var d=o.columns[n.column],c=d.editable(a),u=e().item["f_"+n.recid];if(4==a.id_type&&1==u){var r=i.depends;for(var l in r)if(r[l]==a.id){var _=t[l];if(_.id_dt&&e().item["f_"+_.id_dt])return alert("Первоначально необходимо удалить "+_.label.toLowerCase()+' на вкладке "Документы"'),n.preventDefault()}}"date"==c.type?n.value=u?new Date(u):new Date:n.value=u},onChange:$_DO.patch_block_passport,onRefresh:color_passport_grid}),$_F5()}}),define("app/view/block_popup",[],function(){return function(e,t){var i=e.item;i.usedyear;$(t).w2uppop({},function(){$("#w2ui-popup .w2ui-form").w2reform({name:"block_new_form",record:e.record,fields:[{name:"blocknum",type:"text"},{name:"cadastralnumber",type:"text"},{name:"code_vc_nsi_30",type:"list",options:{items:e.vc_nsi_30.items},_no_nrs:1},{name:"totalarea",type:"float",options:{min:0}},{name:"grossarea",type:"float",options:{min:0},_no_nrs:1},{name:"f_20002",type:"list",options:{items:e.vc_nsi_14.items},_no_nrs:1},{name:"f_20125",type:"int",options:{min:0},_no_nrs:1},{name:"f_20061",type:"list",options:{items:e.vc_nsi_259.items},_no_nrs:1},{name:"f_20059",type:"list",options:{items:e.vc_nsi_258.items},_no_nrs:1},{name:"f_20054",type:"list",options:{items:e.vc_nsi_254.items}},{name:"f_20053",type:"list",options:{items:e.vc_nsi_253.items}},{name:"f_20056",type:"list",options:{items:e.vc_nsi_261.items}},{name:"is_nrs",type:"list",options:{items:e.vc_is_nrs.items}}],onChange:function(t){var i=this;"is_nrs"==t.target&&t.done(function(){var n=1==t.value_new.id;$.each(i.fields,function(){this._no_nrs&&(this.$el.prop("disabled",n),n&&delete i.record[this.name])}),n||i.record.code_vc_nsi_30||(i.record.code_vc_nsi_30=e.vc_nsi_30.items[2]),i.refresh()})},onRefresh:function(e){var t=w2ui[e.target],i=t.record,n=t.fields.filter(function(e){return"enum"==e.type});n.length&&$.each(n,function(){var e=this.name,t=i[e];Array.isArray(t)&&t.length&&"object"!=typeof t[0]&&(i[e]=this.options.items.filter(function(e){return t.includes(e.id)}))})},focus:1})})}}),define("app/view/block",[],function(){return function(e,t){$("title").text(e.item.label+", "+e.item.address),fill(t,e,$("body")),$("#container").w2layout({name:"topmost_layout",panels:[{type:"main",size:400,tabs:{tabs:[{id:"block_common",caption:"Общие"},{id:"block_passport",caption:"Паспорт"},{id:"block_invalid",caption:"Непригодность для проживания",hidden:1!=e.item.f_20126}].filter(not_off),onClick:$_DO.choose_tab_block}}],onRender:function(e){clickActiveTab(this.get("main").tabs,"block.active_tab")}})}}),define("app/view/entrance_new",[],function(){return function(e,t){$(t).w2uppop({},function(){$("#w2ui-popup .w2ui-form").w2reform({name:"entrance_new_popup_form",record:{},fields:[{name:"no",type:"text"}]}),clickOn($("#w2ui-popup button"),$_DO.update_entrance_new)})}}),define("app/view/entrance_popup",[],function(){return function(e,t){var i=JSON.parse(JSON.stringify($("body").data("data").item));i.usedyear||(i.usedyear=1600),i.minfloorcount||(i.minfloorcount=i.floorcount),$(t).w2uppop({},function(){$("#w2ui-popup .w2ui-form").w2reform({name:"entrance_popup_form",record:e.entrance,fields:[{name:"entrancenum",type:"text"},{name:"storeyscount",type:"int",options:{min:i.minfloorcount,max:i.floorcount}},{name:"creationyear",type:"int",options:{min:i.usedyear,max:(new Date).getFullYear(),autoFormat:!1}}]}),clickOn($("#w2ui-popup button"),$_DO.update_entrance_popup)})}}),define("app/view/house_address",[],function(){return function(e,t){darn(e);var i=w2ui.topmost_layout,n=$(i.el("main"));fill(t,e.item,n)}}),define("app/view/house_common",[],function(){function e(){return $("body").data("data")}var t={};return function(i,n){$.each(i.vc_pass_fields,function(){t[this.id]=this}),$_F5=function(){var t=w2ui.house_common_grid,i=e(),n=i.depends,o=i.doc_fields;t.records=i.vc_pass_fields.filter(function(e){if(3==e.id_type)return!1;var t=n[e.id];return!t||1==i.item["f_"+t]}),$.each(t.records,function(){this.w2ui&&delete this.w2ui.changes,this.is_doc=o[this.id],delete this.value}),t.refresh()};var o=w2ui.topmost_layout;$(o.el("main")).w2regrid({name:"house_common_grid",show:{toolbar:!0,footer:1,toolbarReload:!1,toolbarColumns:!1},textSearch:"contains",columns:[{field:"label",caption:"Реквизит",size:100},{field:"value",caption:"Значение",size:20,attr:"data-status",editable:function(t){switch(t.id_type){case 0:return{type:"int"};case 1:return{type:"float",precision:4,autoFormat:!0,keyboard:!1,min:0};case 2:return{type:"text"};case 4:return{type:"list",items:[{id:0,text:"Нет"},{id:1,text:"Да"}]};case 6:var t=e()["vc_nsi_"+t.voc];return t?{type:"list",items:t.items}:null;case 7:return{type:"int",min:1600,max:2215,autoFormat:!1};case 8:return{type:"date"};default:return null}},render:function(t){var i=e().item[t.name];if(t.is_multiple)switch(t.id_type){case 6:var n=e(),o=n["tb_houses_f_"+t.id],a="";return $.each(n["vc_nsi_"+t.voc].items,function(){o[this.id]&&(a&&(a+=", "),a+=this.label)}),a;default:return""}else switch(t.id_type){case 4:return 1==i?"Да":"Нет";case 1:return null==i?"":w2utils.formatNumber(i);case 6:var t=e()["vc_nsi_"+t.voc];return t?t[i]:"";case 8:return i?dt_dmy(i.substr(0,10)):"";default:return i}}},{field:"unit",caption:"Ед. изм.",size:5}],records:[],onDblClick:null,onEditField:function(n){var o=this,a=o.get(n.recid);if(a.is_doc)return alert('Добавление подтверждающих документов осуществляется на вкладке "Документы"'),n.preventDefault();if(a.is_multiple){var r=e(),s={def:a,voc:r["vc_nsi_"+a.voc],ids:r["tb_houses_f_"+a.id]};return $_SESSION.set("field",s),use.block("passport_multiple_popup"),n.preventDefault()}var d=o.columns[n.column],c=d.editable(a),u=e().item["f_"+n.recid];if(4==a.id_type&&1==u){var r=i.depends;for(var l in r)if(r[l]==a.id){var _=t[l];if(_.id_dt&&e().item["f_"+_.id_dt])return alert("Первоначально необходимо удалить "+_.label.toLowerCase()+' на вкладке "Документы"'),n.preventDefault()}}"date"==c.type?n.value=u?new Date(u):new Date:n.value=u},onChange:$_DO.patch_house_common,onRefresh:color_passport_grid}),$_F5()}}),define("app/view/house_constr",[],function(){function e(){return $("body").data("data")}return function(t,i){$_F5=function(){var t=w2ui.house_constr_grid,i=e(),n=i.doc_fields;t.records=i.vc_pass_fields,$.each(t.records,function(){this.w2ui&&delete this.w2ui.changes,this.is_doc=n[this.id],delete this.value}),t.refresh()};var n=w2ui.topmost_layout;$(n.el("main")).w2regrid({name:"house_constr_grid",show:{toolbar:!0,footer:1,toolbarReload:!1,toolbarColumns:!1},textSearch:"contains",columns:[{field:"label",caption:"Реквизит",size:100},{field:"value",caption:"Значение",size:20,attr:"data-status",editable:function(t){switch(t.id_type){case 0:return{type:"int"};case 1:return{type:"float",precision:4,autoFormat:!0,keyboard:!1,min:0};case 2:return{type:"text"};case 4:return{type:"list",items:[{id:0,text:"Нет"},{id:1,text:"Да"}]};case 6:var t=e()["vc_nsi_"+t.voc];return t?{type:"list",items:t.items}:null;case 7:return{type:"int",min:1600,max:2215,autoFormat:!1};case 8:return{type:"date"};default:return null}},render:function(t){var i=e().item[t.name];if(t.is_multiple)switch(t.id_type){case 6:var n=e(),o=n["tb_houses_f_"+t.id],a="";return $.each(n["vc_nsi_"+t.voc].items,function(){o[this.id]&&(a&&(a+=", "),a+=this.label)}),a;default:return""}else switch(t.id_type){case 4:return 1==i?"Да":"Нет";case 1:return null==i?"":w2utils.formatNumber(i);case 6:var t=e()["vc_nsi_"+t.voc];return t?t[i]:"";case 8:return i?dt_dmy(i.substr(0,10)):"";default:return i}}},{field:"unit",caption:"Ед. изм.",size:5}],records:[],onDblClick:null,onEditField:function(t){var i=this,n=i.get(t.recid);if(n.is_doc)return alert('Добавление подтверждающих документов осуществляется на вкладке "Документы"'),t.preventDefault();if(n.is_multiple){var o=e(),a={def:n,voc:o["vc_nsi_"+n.voc],ids:o["tb_houses_f_"+n.id]};return $_SESSION.set("field",a),use.block("house_multiple_popup"),t.preventDefault()}var r=i.columns[t.column],s=r.editable(n),d=e().item["f_"+t.recid];"date"==s.type?t.value=d?new Date(d):new Date:t.value=d},onChange:$_DO.patch_house_constr,onRefresh:function(e){e.done(function(){var e=null;$.each(t.vc_pass_fields,function(){if(!("id_type"in this)){var t="tr[recid="+this.id+"]";$(t+" td.w2ui-grid-data").css({"font-weight":"bold","border-bottom-width":"1px"}).eq(0).css({"border-right-width":0}),e&&(t="tr[recid="+e+"]",$(t+" td.w2ui-grid-data").css({"border-bottom-width":"1px"}))}e=this.id})})}}),$_F5()}}),define("app/view/house_doc_new",[],function(){return function(e,t){e.contract;$(t).w2popup("open",{width:605,height:280,title:"Добавление документа",onOpen:function(t){t.onComplete=function(){var t="house_doc_new_form";w2ui[t]&&w2ui[t].destroy(),$("#w2ui-popup .w2ui-form").w2form({name:t,fields:[{name:"no",type:"text"},{name:"dt",type:"date"},{name:"note",type:"textarea"},{name:"files",type:"file",options:{max:1}},{name:"file_type",type:"list",options:{items:e.doc_fields.items.filter(not_off)}}]}),clickOn($("#w2ui-popup button"),$_DO.update_house_doc_new)}}})}}),define("app/view/house_doc_popup",[],function(){return function(e,t){$(t).w2popup("open",{width:605,height:280,title:"Редактирование документа",onOpen:function(t){t.onComplete=function(){$("#file_label").text(e.label);var t="house_doc_popup_form";w2ui[t]&&w2ui[t].destroy(),$("#w2ui-popup .w2ui-form").w2form({name:t,record:e,fields:[{name:"no",type:"text"},{name:"dt",type:"date"},{name:"note",type:"textarea"}],focus:-1}),clickOn($("#w2ui-popup button"),$_DO.update_house_doc_popup),clickOn($("#file_label"),$_DO.download_house_doc_popup)}}})}}),define("app/view/house_docs",[],function(){return function(e,t){var i={};$.each(e.doc_fields.items,function(){i[this.id]=this});var n=w2ui.topmost_layout;$(n.el("main")).w2regrid({multiSelect:!1,name:"house_docs_grid",show:{toolbar:!0,footer:1,toolbarReload:!1,toolbarColumns:!1,toolbarInput:!1,toolbarAdd:!0,toolbarDelete:!0,toolbarEdit:!0},textSearch:"contains",columns:[{field:"type",caption:"Тип",size:100,render:function(e){var t=i[e.id_type];return t?t.label:""}},{field:"dt",caption:"Дата",size:18,render:function(t){var n=i[t.id_type];if(!n)return"";var o=e.item["f_"+n.id_dt];return o?dt_dmy(o.substr(0,10)):""}},{field:"no",caption:"№",size:25,render:function(t){var n=i[t.id_type];return n?e.item["f_"+n.id_no]:""}},{field:"label",caption:"Имя файла",size:100},{field:"len",caption:"Объём, Мб",size:10,render:function(e){return(e.len/1024/1024).toFixed(3)}},{field:"note",caption:"Прим.",size:50}],postData:{search:{uuid_house:$_REQUEST.id}},url:"/mosgis/_rest/?type=house_docs",onDblClick:$_DO.download_house_docs,onDelete:$_DO.delete_house_docs,onAdd:$_DO.create_house_docs,onEdit:$_DO.edit_house_docs})}}),define("app/view/house_living_rooms",[],function(){return function(e,t){var i=clone($("body").data("data")),n=i.item;n.usedyear||(n.usedyear=1600),$(w2ui.topmost_layout.el("main")).w2regrid({name:"house_living_rooms_grid",selectType:"cell",multiSelect:!1,show:{toolbar:!0,footer:!0,toolbarAdd:!0,toolbarDelete:!0,toolbarInput:!1,toolbarSearch:!0,toolbarReload:!1},columnGroups:[{master:!0},{master:!0},{master:!0},{master:!0},{master:!0},{master:!0},{span:3,caption:"Непригодность"},{master:!0}],searches:[{field:"is_annuled",caption:"Актуальность",type:"enum",options:{items:[{id:0,text:"Актуальные"},{id:1,text:"Аннулированные"}]}}],last:{logic:"AND"},searchData:[{field:"is_annuled",operator:"in",type:"enum",value:[{id:0,text:"Актуальные"}]}],columns:[{field:"roomnumber",caption:"№",tooltip:"№ комнаты",size:7},{field:"uuid_block",caption:"№ блока",size:7,voc:i.vc_blocks,off:!n.hasblocks},{field:"uuid_premise",caption:"№ квартиры",size:7,voc:i.vc_premises,off:!n.is_condo},{field:"cadastralnumber",caption:"Кадастровый №",tooltip:"Кадастровый #",size:10,editable:{type:"text"}},{field:"square",attr:"data-mandatory",caption:"Площадь, м²",tooltip:"Общая площадь",size:5,editable:{type:"float",min:0}},{field:"f_20130",attr:"data-living",caption:"К-во проживающих",tooltip:"Количество проживающих",size:5,editable:{type:"int"}},{field:"f_20056",caption:"Э/оборудование",tooltip:"Наличие электрооборудования",size:7,voc:i.vc_nsi_261,hidden:!0},{field:"f_20132",caption:"Основание",size:10,voc:i.vc_nsi_273,hidden:!0},{field:"f_20133",caption:"Дата",size:10,render:_dt,hidden:!0},{field:"f_20134",caption:"№ док.",size:10,hidden:!0},{field:"terminationdate",caption:"Дата аннулирования",size:20,render:_dt,hidden:!0}].filter(not_off),postData:{data:{uuid_house:$_REQUEST.id}},url:"/mosgis/_rest/?type=living_rooms",onDblClick:function(e){this.columns[e.column].editable||openTab("/living_room/"+e.recid)},onAdd:$_DO.create_house_living_rooms,onDelete:$_DO.delete_house_living_rooms,onChange:$_DO.patch_house_living_rooms,onEditField:function(e){var t=this,i=t.get(e.recid);if(i.is_annuled)return e.preventDefault();var n=t.columns[e.column];if(/data-living/.test(n.attr)&&1==i.is_nrs)return e.preventDefault();var o=n.editable,a=i[n.field];"date"==o.type?e.value=a?new Date(a.substr(0,10)):new Date:e.value=a},onRefresh:function(e){var t=this;e.done(function(){$("tr[recid] td[data-mandatory]").each(function(){var e=$(this);if(!(e.text()||"Н"==e.closest("tr").text().charAt(0)&&e.is("[data-living]"))){var t={title:"Обязательное поле"};e.css({background:"#ffcccc"}).prop(t),$("*",e).prop(t)}}),$("tr[recid]").each(function(){var e=$(this);t.get(e.attr("recid")).is_annuled&&$("td",e).css({background:"#ccc"})})})}}).refresh()}}),define("app/view/house_passport_blocks",[],function(){return function(e,t){var i=clone($("body").data("data")),n=i.item;n.usedyear||(n.usedyear=1600),$(w2ui.passport_layout.el("main")).w2regrid({name:"house_passport_blocks_grid",selectType:"cell",multiSelect:!1,show:{toolbar:!0,footer:!0,toolbarAdd:!0,toolbarDelete:!0,toolbarInput:!1,toolbarSearch:!0,toolbarReload:!1},columnGroups:[{master:!0},{master:!0},{master:!0},{master:!0},{span:2,caption:"Площадь"},{master:!0},{master:!0},{master:!0},{master:!0},{span:3,caption:"Сети"},{span:3,caption:"Непригодность"},{master:!0}],searches:[{field:"is_nrs",caption:"Категория",type:"list",options:{items:i.vc_is_nrs.items}},{field:"is_annuled",caption:"Актуальность",type:"enum",options:{items:[{id:0,text:"Актуальные"},{id:1,text:"Аннулированные"}]}}],last:{logic:"AND"},searchData:[{field:"is_annuled",operator:"in",type:"enum",value:[{id:0,text:"Актуальные"}]}],columns:[{field:"is_nrs",caption:"Категория",size:7,voc:i.vc_is_nrs},{field:"blocknum",caption:"№",tooltip:"№ блока",size:7},{field:"cadastralnumber",caption:"Кадастровый №",tooltip:"Кадастровый #",size:10,editable:{type:"text"}},{field:"code_vc_nsi_30",attr:"data-mandatory data-living",caption:"Характеристика",tooltip:"Характеристика помещения",size:10,voc:i.vc_nsi_30,editable:{type:"list"}},{field:"totalarea",attr:"data-mandatory",caption:"Общая, м²",tooltip:"Общая площадь",size:5,editable:{type:"float",min:0}},{field:"grossarea",attr:"data-mandatory data-living",caption:"Жилая, м²",tooltip:"Жилая площадь",size:5,editable:{type:"float",min:0}},{field:"f_20002",attr:"data-mandatory data-living",caption:"К-во комнат",tooltip:"Количество комнат",size:10,voc:i.vc_nsi_14,editable:{type:"list"}},{field:"f_20125",attr:"data-living",caption:"К-во проживающих",tooltip:"Количество проживающих",size:5,editable:{type:"int"}},{field:"f_20061",attr:"data-living",caption:"Состав семьи",tooltip:"Группы домохозяйств, относительно состава семьи",size:10,voc:i.vc_nsi_259,editable:{type:"list"}},{field:"f_20059",attr:"data-living",caption:"Зарегистрировано лиц",tooltip:"Группы домохозяйств, относительно количества зарегистрированных граждан",size:10,voc:i.vc_nsi_258,editable:{type:"list"}},{field:"f_20054",caption:"Тепло",tooltip:"Направление использования тепловой энергии на нужды отопления",size:7,voc:i.vc_nsi_254,hidden:!0},{field:"f_20053",caption:"Газ",tooltip:"Направления использования газа",size:7,voc:i.vc_nsi_253,hidden:!0},{field:"f_20056",caption:"Э/оборудование",tooltip:"Наличие электрооборудования",size:7,voc:i.vc_nsi_261,hidden:!0},{field:"f_20127",caption:"Основание",size:10,voc:i.vc_nsi_273,hidden:!0},{field:"f_20128",caption:"Дата",size:10,render:_dt,hidden:!0},{field:"f_20129",caption:"№ док.",size:10,hidden:!0},{field:"terminationdate",caption:"Дата аннулирования",render:_dt,size:20,hidden:!0}],postData:{data:{uuid_house:$_REQUEST.id}},url:"/mosgis/_rest/?type=blocks",onDblClick:function(e){this.columns[e.column].editable||openTab("/block/"+e.recid)},onAdd:$_DO.create_house_passport_blocks,onDelete:$_DO.delete_house_passport_blocks,onChange:$_DO.patch_house_passport_blocks,onEditField:function(e){var t=this,i=t.get(e.recid);if(i.is_annuled)return e.preventDefault();var n=t.columns[e.column];if(/data-living/.test(n.attr)&&1==i.is_nrs)return e.preventDefault();var o=n.editable,a=i[n.field];"date"==o.type?e.value=a?new Date(a.substr(0,10)):new Date:e.value=a},onRefresh:function(e){var t=this;e.done(function(){$("tr[recid] td[data-mandatory]").each(function(){var e=$(this);if(!(e.text()||"Н"==e.closest("tr").text().charAt(0)&&e.is("[data-living]"))){var t={title:"Обязательное поле"};e.css({background:"#ffcccc"}).prop(t),$("*",e).prop(t)}}),$("tr[recid]").each(function(){var e=$(this);t.get(e.attr("recid")).is_annuled&&$("td",e).css({background:"#ccc"})})})}}).refresh()}}),define("app/view/house_passport_entrances",[],function(){function e(e){e.done(function(){var e=w2ui.house_passport_entrances_grid,i=e.toolbar;i.disable(t[0]),i.disable(t[1]),1==e.getSelection().length&&i.enable(t[e.get(e.getSelection()[0]).is_annuled])})}var t=["annulButton","restoreButton"];return function(i,n){var o=$("body").data("data"),a=JSON.parse(JSON.stringify(o.item));a.usedyear||(a.usedyear=1600),a.minfloorcount||(a.minfloorcount=a.floorcount),a.floorcount||(a.floorcount=99),a.minfloorcount||(a.minfloorcount=1);var r=[{field:"entrancenum",caption:"Номер",size:100},{field:"storeyscount",caption:"Этажность",size:20,editable:{type:"int",min:a.minfloorcount,max:a.floorcount}},{field:"creationyear",caption:"Год постройки",size:20,editable:{type:"int",min:a.usedyear,max:(new Date).getFullYear(),
autoFormat:!1}},{field:"terminationdate",caption:"Дата аннулирования",render:_dt,size:20}];$.each(o.vc_nsi_192.items,function(){r.push({field:"cnt_"+this.id,caption:this.label,size:20,editable:{type:"int",min:0,max:12},_is_lift:!0})}),$(w2ui.passport_layout.el("main")).w2regrid({name:"house_passport_entrances_grid",multiSelect:!1,show:{toolbar:!0,footer:!0,toolbarAdd:!0,toolbarEdit:!0,toolbarDelete:!0,toolbarInput:!1,toolbarReload:!1},toolbar:{items:[{type:"button",id:t[0],caption:"Аннулировать",onClick:$_DO.annul_house_passport_entrances,disabled:!0},{type:"button",id:t[1],caption:"Восстановить",onClick:$_DO.restore_house_passport_entrances,disabled:!0}]},columnGroups:[{master:!0},{master:!0},{master:!0},{master:!0},{span:o.vc_nsi_192.items.length,caption:"Количество лифтов"}],searches:[{field:"is_annuled",caption:"Актуальность",type:"enum",options:{items:[{id:0,text:"Актуальные"},{id:1,text:"Аннулированные"}]}}],last:{logic:"AND"},searchData:[{field:"is_annuled",operator:"in",type:"enum",value:[{id:0,text:"Актуальные"}]}],columns:r,postData:{data:{uuid_house:$_REQUEST.id}},url:"/mosgis/_rest/?type=entrances",onDblClick:null,onAdd:function(){use.block("entrance_new")},onEdit:$_DO.edit_house_passport_entrances,onDelete:$_DO.delete_house_passport_entrances,onChange:$_DO.patch_house_passport_entrances,onEditField:function(e){var t=this,i=t.get(e.recid);if(i.terminationdate)return e.preventDefault();var n=t.columns[e.column],o=n.editable,a=i[n.field];"date"==o.type?e.value=a?new Date(a.substr(0,10)):new Date:e.value=a},onRefresh:function(e){var t=this;$.each(t.records,function(){this.w2ui&&delete this.w2ui.changes}),e.done(color_data_mandatory)},onSelect:e,onUnselect:e}).refresh()}}),define("app/view/house_passport_lifts",[],function(){function e(e){e.done(function(){var e=w2ui.house_passport_lifts_grid,i=e.toolbar;i.disable(t[0]),i.disable(t[1]),1==e.getSelection().length&&i.enable(t[e.get(e.getSelection()[0]).is_annuled])})}var t=["annulButton","restoreButton"];return function(i,n){var o=$("body").data("data"),a=JSON.parse(JSON.stringify($("body").data("data").item));a.usedyear||(a.usedyear=1600),$(w2ui.passport_layout.el("main")).w2regrid({name:"house_passport_lifts_grid",multiSelect:!1,show:{toolbar:!0,footer:!0,toolbarAdd:!0,toolbarEdit:!0,toolbarDelete:!0,toolbarInput:!1,toolbarReload:!1},searches:[{field:"is_annuled",caption:"Актуальность",type:"enum",options:{items:[{id:0,text:"Актуальные"},{id:1,text:"Аннулированные"}]}}],last:{logic:"AND"},searchData:[{field:"is_annuled",operator:"in",type:"enum",value:[{id:0,text:"Актуальные"}]}],toolbar:{items:[{type:"button",id:t[0],caption:"Аннулировать",onClick:$_DO.annul_house_passport_lifts,disabled:!0},{type:"button",id:t[1],caption:"Восстановить",onClick:$_DO.restore_house_passport_lifts,disabled:!0}]},columns:[{field:"uuid_entrance",caption:"Подъ.",tooltip:"№ подъезда",size:7,render:function(e){return o.entrances[e.uuid_entrance]}},{field:"code_vc_nsi_192",caption:"Тип лифта",size:20,render:function(e){return o.vc_nsi_192[e.code_vc_nsi_192]}},{field:"factorynum",caption:"Заводской номер",size:20,editable:{type:"text"},attr:"data-status"},{field:"f_20007",caption:"Инвентарный номер",size:20,editable:{type:"text"}},{field:"f_20165",caption:"Грузоподъемность, кг",size:20,editable:{type:"float"}},{field:"f_20164",caption:"Год ввода в эксплуатацию",size:20,editable:{type:"int",min:a.usedyear,max:(new Date).getFullYear(),autoFormat:!1}},{field:"f_20166",caption:"Нормативный срок службы",size:20,editable:{type:"int"}},{field:"operatinglimit",caption:"Предельный срок эксплуатации",size:20,editable:{type:"int"}},{field:"f_20151",caption:"Физический износ, лет",size:20,editable:{type:"int"}},{field:"f_20124",caption:"Год проведения последнего капитального ремонта",size:20,editable:{type:"int",min:a.usedyear,max:(new Date).getFullYear(),autoFormat:!1}},{field:"terminationdate",caption:"Дата аннулирования",render:_dt,size:20,render:_dt},{field:"annulmentinfo",caption:"Причина аннулирования. Дополнительная информация",size:20}],postData:{data:{uuid_house:$_REQUEST.id}},url:"/mosgis/_rest/?type=lifts",onDblClick:null,onAdd:function(){use.block("lift_new")},onEdit:$_DO.edit_house_passport_lifts,onDelete:$_DO.delete_house_passport_lifts,onChange:$_DO.patch_house_passport_lifts,onEditField:function(e){var t=this,i=t.get(e.recid);if(i.terminationdate)return e.preventDefault();var n=t.columns[e.column],o=n.editable,a=i[n.field];"date"==o.type?e.value=a?new Date(a.substr(0,10)):new Date:e.value=a},onRefresh:function(e){var t=this;$.each(t.records,function(){this.w2ui&&delete this.w2ui.changes,this.factorynum||(this.w2ui||(this.w2ui={}),this.w2ui.class="status_warning")}),e.done(function(){var e="Не заполнено обязательное поле. Запись будет пропущена при отправки дома в ГИС ЖКХ";$("tr.status_warning td[data-status]").attr("title",e),$("tr.status_warning td[data-status] div").attr("title",e),$("tr[recid]").each(function(){var e=$(this);t.get(e.attr("recid")).is_annuled&&$("td",e).css({background:"#ccc"})})})},onSelect:e,onUnselect:e}).refresh()}}),define("app/view/house_passport",[],function(){function e(){var e=$("#hasblocks"),t=$("#hasmultiplehouseswithsameadres");e.prop("checked")?t.prop("disabled",$("#totalsquare").prop("disabled")):t.prop("checked",0).prop("disabled",1)}var t="house_passport_form";return function(i,n){$_F5=function(e){e.item.__read_only=e.__read_only,w2ui[t].record=e.item,$("div[data-block-name=house_passport] input").prop({disabled:e.__read_only}),!e.__read_only&&$("body").data("data").has_blocks&&$("#hasblocks").prop({disabled:1,title:"К дому привязаны блоки.\nДля изменения характеристики необходимо удалить блоки\nили отправить в ГИС ЖКХ причину аннулирования блоков."}),w2ui[t].refresh()};var o=w2ui.topmost_layout,a=$(o.el("main"));a.w2relayout({name:"passport_layout",panels:[{type:"top",size:i.item.is_condo?335:365},{type:"main",size:400,tabs:{tabs:i.tabs.map(function(e){return{id:e.id,caption:e.label}}),onClick:$_DO.choose_tab_house_passport}}],onRender:function(e){this.get("main").tabs.click(i.active_tab)}});var a=$(w2ui.passport_layout.el("top"));fill(n,i.item,a),a.w2reform({name:t,record:i.item,fields:[{name:"code_vc_nsi_24",type:"list",options:{items:i.vc_nsi_24.items}},{name:"totalsquare",type:"float",options:{min:0,precision:4,autoFormat:!0}},{name:"usedyear",type:"int",options:{min:1600,max:2215,autoFormat:!1}},{name:"floorcount",type:"int",options:{min:1,max:100}},{name:"undergroundfloorcount",type:"int",options:{min:1,max:100}},{name:"minfloorcount",type:"int",options:{min:1,max:100}},{name:"culturalheritage",type:"list",options:{items:[{id:"0",text:"Нет"},{id:"1",text:"Да"}]}},{name:"kad_n",type:"text",options:{}},{name:"hasblocks",type:"checkbox",options:{},off:i.item.is_condo},{name:"hasmultiplehouseswithsameadres",type:"checkbox",options:{},off:i.item.is_condo}].filter(not_off),onRefresh:function(t){t.done(function(){clickOn($("span.anchor"),onDataUriDblClick),e(),$("#hasblocks").off("click").on("click",e),sessionStorage.getItem("check_sum_area_fields_of_a_house")&&(sessionStorage.removeItem("check_sum_area_fields_of_a_house"),setTimeout($_DO.check_sum_area_fields_of_a_house,400))})},focus:-1}),$_F5(i)}}),define("app/view/house_premises_nonresidental",[],function(){return function(e,t){var i=clone($("body").data("data")),n=i.item;n.usedyear||(n.usedyear=1600),$(w2ui.house_premises_layout.el("main")).w2regrid({name:"house_premises_nonresidental_grid",selectType:"cell",multiSelect:!1,show:{toolbar:!0,footer:!0,toolbarAdd:!0,toolbarEdit:!1,toolbarDelete:!0,toolbarInput:!1,toolbarReload:!1},searches:[{field:"is_annuled",caption:"Актуальность",type:"enum",options:{items:[{id:0,text:"Актуальные"},{id:1,text:"Аннулированные"}]}}],last:{logic:"AND"},searchData:[{field:"is_annuled",operator:"in",type:"enum",value:[{id:0,text:"Актуальные"}]}],columns:[{field:"premisesnum",caption:"№",tooltip:"№ помещения",size:7},{field:"cadastralnumber",caption:"Кадастровый №",tooltip:"Кадастровый #",size:10,editable:{type:"text"}},{field:"totalarea",attr:"data-mandatory",caption:"Общая, м²",tooltip:"Общая площадь",size:5,editable:{type:"float",min:0}},{field:"iscommonproperty",caption:"Общее имущество?",tooltip:"Составляет общее имущество в многоквартирном доме",size:10,voc:i.bool,editable:{type:"list"}},{field:"f_20003",caption:"Назначение",tooltip:"Назначение помещения, относящегося к общему долевому имуществу собственников помещений",size:10,voc:i.vc_nsi_17,editable:{type:"list"}},{field:"f_20054",caption:"Тепло",tooltip:"Направление использования тепловой энергии на нужды отопления",size:7,voc:i.vc_nsi_254,hidden:!0},{field:"f_20053",caption:"Газ",tooltip:"Направления использования газа",size:7,voc:i.vc_nsi_253,hidden:!0},{field:"f_20056",caption:"Э/оборудование",tooltip:"Наличие электрооборудования",size:7,voc:i.vc_nsi_261,hidden:!0},{field:"terminationdate",caption:"Дата аннулирования",render:_dt,size:20,hidden:!0}],postData:{data:{uuid_house:$_REQUEST.id}},url:"/mosgis/_rest/?type=premises_nonresidental",onDblClick:function(e){this.columns[e.column].editable||openTab("/premise_nonresidental/"+e.recid)},onAdd:$_DO.create_house_premises_nonresidental,onEdit:$_DO.edit_house_premises_nonresidental,onDelete:$_DO.delete_house_premises_nonresidental,onChange:$_DO.patch_house_premises_nonresidental,onEditField:function(e){var t=this,i=t.get(e.recid);if(i.is_annuled)return e.preventDefault();var n=t.columns[e.column],o=n.editable,a=i[n.field];"date"==o.type?e.value=a?new Date(a.substr(0,10)):new Date:e.value=a},onRefresh:function(e){e.done(color_data_mandatory)}}).refresh()}}),define("app/view/house_premises_residental",[],function(){return function(e,t){var i=clone($("body").data("data")),n=i.item;n.usedyear||(n.usedyear=1600),$(w2ui.house_premises_layout.el("main")).w2regrid({name:"house_premises_residental_grid",selectType:"cell",multiSelect:!1,show:{toolbar:!0,footer:!0,toolbarAdd:!0,toolbarEdit:!1,toolbarDelete:!0,toolbarInput:!1,toolbarReload:!1},columnGroups:[{master:!0},{master:!0},{master:!0},{master:!0},{span:2,caption:"Площадь"},{master:!0},{master:!0},{master:!0},{master:!0},{span:3,caption:"Сети"},{span:3,caption:"Непригодность"},{master:!0}],searches:[{field:"is_annuled",caption:"Актуальность",type:"enum",options:{items:[{id:0,text:"Актуальные"},{id:1,text:"Аннулированные"}]}}],last:{logic:"AND"},searchData:[{field:"is_annuled",operator:"in",type:"enum",value:[{id:0,text:"Актуальные"}]}],columns:[{field:"uuid_entrance",caption:"Подъезд",tooltip:"№ подъезда",size:7,voc:i.entrances},{field:"premisesnum",caption:"№",tooltip:"№ помещения",size:7},{field:"cadastralnumber",caption:"Кадастровый №",tooltip:"Кадастровый #",size:10,editable:{type:"text"}},{field:"code_vc_nsi_30",attr:"data-mandatory",caption:"Характеристика",tooltip:"Характеристика помещения",size:10,voc:i.vc_nsi_30,editable:{type:"list"}},{field:"totalarea",attr:"data-mandatory",caption:"Общая, м²",tooltip:"Общая площадь",size:5,editable:{type:"float",min:0}},{field:"grossarea",attr:"data-mandatory",caption:"Жилая, м²",tooltip:"Жилая площадь",size:5,editable:{type:"float",min:0}},{field:"f_20002",attr:"data-mandatory",caption:"К-во комнат",tooltip:"Количество комнат",size:10,voc:i.vc_nsi_14,editable:{type:"list"}},{field:"f_20125",caption:"К-во проживающих",tooltip:"Количество проживающих",size:5,editable:{type:"int"}},{field:"f_20061",caption:"Состав семьи",tooltip:"Группы домохозяйств, относительно состава семьи",size:10,voc:i.vc_nsi_259,editable:{type:"list"}},{field:"f_20059",caption:"Зарегистрировано лиц",tooltip:"Группы домохозяйств, относительно количества зарегистрированных граждан",size:10,voc:i.vc_nsi_258,editable:{type:"list"}},{field:"f_20054",caption:"Тепло",tooltip:"Направление использования тепловой энергии на нужды отопления",size:7,voc:i.vc_nsi_254,hidden:!0},{field:"f_20053",caption:"Газ",tooltip:"Направления использования газа",size:7,voc:i.vc_nsi_253,hidden:!0},{field:"f_20056",caption:"Э/оборудование",tooltip:"Наличие электрооборудования",size:7,voc:i.vc_nsi_261,hidden:!0},{field:"f_20127",caption:"Основание",size:10,voc:i.vc_nsi_273,hidden:!0},{field:"f_20128",caption:"Дата",render:_dt,size:10,hidden:!0},{field:"f_20129",caption:"№ док.",size:10,hidden:!0},{field:"terminationdate",caption:"Дата аннулирования",render:_dt,size:20,hidden:!0}],postData:{data:{uuid_house:$_REQUEST.id}},url:"/mosgis/_rest/?type=premises_residental",onDblClick:function(e){this.columns[e.column].editable||openTab("/premise_residental/"+e.recid)},onAdd:$_DO.create_house_premises_residental,onEdit:$_DO.edit_house_premises_residental,onDelete:$_DO.delete_house_premises_residental,onChange:$_DO.patch_house_premises_residental,onEditField:function(e){var t=this,i=t.get(e.recid);if(i.is_annuled)return e.preventDefault();var n=t.columns[e.column],o=n.editable,a=i[n.field];"date"==o.type?e.value=a?new Date(a.substr(0,10)):new Date:e.value=a},onRefresh:function(e){e.done(color_data_mandatory)}}).refresh()}}),define("app/view/house_premises",[],function(){return function(e,t){var i=w2ui.topmost_layout;i.unlock("main");var n=[{id:"house_premises_residental",caption:"Жилые"},{id:"house_premises_nonresidental",caption:"Нежилые"}];$(i.el("main")).w2relayout({name:"house_premises_layout",panels:[{type:"main",size:400,tabs:{tabs:n,onClick:$_DO.choose_tab_house_premises}}],onRender:function(t){this.get("main").tabs.click(e.active_tab)}})}}),define("app/view/house_sys_cold_water",[],function(){function e(){return $("body").data("data")}var t={};return function(i,n){$.each(i.vc_pass_fields,function(){t[this.id]=this}),$_F5=function(){var t=w2ui.house_sys_cold_water_grid,i=e(),n=i.depends,o=i.doc_fields;t.records=i.vc_pass_fields.filter(function(e){if(3==e.id_type)return!1;var t=n[e.id];return!t||1==i.item["f_"+t]}),$.each(t.records,function(){this.w2ui&&delete this.w2ui.changes,this.is_doc=o[this.id],delete this.value}),t.refresh()};var o=w2ui.house_systems_layout;$(o.el("main")).w2regrid({name:"house_sys_cold_water_grid",show:{toolbar:!0,footer:1,toolbarReload:!1,toolbarColumns:!1},textSearch:"contains",columns:[{field:"label",caption:"Реквизит",size:100},{field:"value",caption:"Значение",size:20,attr:"data-status",editable:function(t){switch(t.id_type){case 0:return{type:"int"};case 1:return{type:"float",precision:4,autoFormat:!0,keyboard:!1,min:0};case 2:return{type:"text"};case 4:return{type:"list",items:[{id:0,text:"Нет"},{id:1,text:"Да"}]};case 6:var t=e()["vc_nsi_"+t.voc];return t?{type:"list",items:t.items}:null;case 7:return{type:"int",min:1600,max:2215,autoFormat:!1};case 8:return{type:"date"};default:return null}},render:function(t){var i=e().item[t.name];if(t.is_multiple)switch(t.id_type){case 6:var n=e(),o=n["tb_houses_f_"+t.id],a="";return $.each(n["vc_nsi_"+t.voc].items,function(){o[this.id]&&(a&&(a+=", "),a+=this.label)}),a;default:return""}else switch(t.id_type){case 4:return 1==i?"Да":"Нет";case 1:return null==i?"":w2utils.formatNumber(i);case 6:var t=e()["vc_nsi_"+t.voc];return t?t[i]:"";case 8:return i?dt_dmy(i.substr(0,10)):"";default:return i}}},{field:"unit",caption:"Ед. изм.",size:5}],records:[],onDblClick:null,onEditField:function(n){var o=this,a=o.get(n.recid);if(a.is_doc)return alert('Добавление подтверждающих документов осуществляется на вкладке "Документы"'),n.preventDefault();if(a.is_multiple){var r=e(),s={def:a,voc:r["vc_nsi_"+a.voc],ids:r["tb_houses_f_"+a.id]};return $_SESSION.set("field",s),use.block("house_multiple_popup"),n.preventDefault()}var d=o.columns[n.column],c=d.editable(a),u=e().item["f_"+n.recid];if(4==a.id_type&&1==u){var r=i.depends;for(var l in r)if(r[l]==a.id){var _=t[l];if(_.id_dt&&e().item["f_"+_.id_dt])return alert("Первоначально необходимо удалить "+_.label.toLowerCase()+' на вкладке "Документы"'),n.preventDefault()}}"date"==c.type?n.value=u?new Date(u):new Date:n.value=u},onChange:$_DO.patch_house_sys_cold_water,onRefresh:function(e){e.done(function(){var e=null;$.each(i.vc_pass_fields,function(){if(!("id_type"in this)){var t="tr[recid="+this.id+"]";$(t+" td.w2ui-grid-data").css({"font-weight":"bold","border-bottom-width":"1px"}).eq(0).css({"border-right-width":0}),e&&(t="tr[recid="+e+"]",$(t+" td.w2ui-grid-data").css({"border-bottom-width":"1px"}))}e=this.id})})}}),$_F5()}}),define("app/view/house_sys_electro",[],function(){function e(){return $("body").data("data")}var t={};return function(i,n){$.each(i.vc_pass_fields,function(){t[this.id]=this}),$_F5=function(){var t=w2ui.house_sys_electro_grid,i=e(),n=i.depends,o=i.doc_fields;t.records=i.vc_pass_fields.filter(function(e){if(3==e.id_type)return!1;var t=n[e.id];return!t||1==i.item["f_"+t]}),$.each(t.records,function(){this.w2ui&&delete this.w2ui.changes,this.is_doc=o[this.id],delete this.value}),t.refresh()};var o=w2ui.house_systems_layout;$(o.el("main")).w2regrid({name:"house_sys_electro_grid",show:{toolbar:!0,footer:1,toolbarReload:!1,toolbarColumns:!1},textSearch:"contains",columns:[{field:"label",caption:"Реквизит",size:100},{field:"value",caption:"Значение",size:20,attr:"data-status",editable:function(t){switch(t.id_type){case 0:return{type:"int"};case 1:return{type:"float",precision:4,autoFormat:!0,keyboard:!1,min:0};case 2:return{type:"text"};case 4:return{type:"list",items:[{id:0,text:"Нет"},{id:1,text:"Да"}]};case 6:var t=e()["vc_nsi_"+t.voc];return t?{type:"list",items:t.items}:null;case 7:return{type:"int",min:1600,max:2215,autoFormat:!1};case 8:return{type:"date"};default:return null}},render:function(t){var i=e().item[t.name];if(t.is_multiple)switch(t.id_type){case 6:var n=e(),o=n["tb_houses_f_"+t.id],a="";return $.each(n["vc_nsi_"+t.voc].items,function(){o[this.id]&&(a&&(a+=", "),a+=this.label)}),a;default:return""}else switch(t.id_type){case 4:return 1==i?"Да":"Нет";case 1:return null==i?"":w2utils.formatNumber(i);case 6:var t=e()["vc_nsi_"+t.voc];return t?t[i]:"";case 8:return i?dt_dmy(i.substr(0,10)):"";default:return i}}},{field:"unit",caption:"Ед. изм.",size:5}],records:[],onDblClick:null,onEditField:function(n){var o=this,a=o.get(n.recid);if(a.is_doc)return alert('Добавление подтверждающих документов осуществляется на вкладке "Документы"'),n.preventDefault();if(a.is_multiple){var r=e(),s={def:a,voc:r["vc_nsi_"+a.voc],ids:r["tb_houses_f_"+a.id]};return $_SESSION.set("field",s),use.block("house_multiple_popup"),n.preventDefault()}var d=o.columns[n.column],c=d.editable(a),u=e().item["f_"+n.recid];if(4==a.id_type&&1==u){var r=i.depends;for(var l in r)if(r[l]==a.id){var _=t[l];if(_.id_dt&&e().item["f_"+_.id_dt])return alert("Первоначально необходимо удалить "+_.label.toLowerCase()+' на вкладке "Документы"'),n.preventDefault()}}"date"==c.type?n.value=u?new Date(u):new Date:n.value=u},onChange:$_DO.patch_house_sys_electro,onRefresh:function(e){e.done(function(){var e=null;$.each(i.vc_pass_fields,function(){if(!("id_type"in this)){var t="tr[recid="+this.id+"]";$(t+" td.w2ui-grid-data").css({"font-weight":"bold","border-bottom-width":"1px"}).eq(0).css({"border-right-width":0}),e&&(t="tr[recid="+e+"]",$(t+" td.w2ui-grid-data").css({"border-bottom-width":"1px"}))}e=this.id})})}}),$_F5()}}),define("app/view/house_sys_gas",[],function(){function e(){return $("body").data("data")}var t={};return function(i,n){$.each(i.vc_pass_fields,function(){t[this.id]=this}),$_F5=function(){var t=w2ui.house_sys_gas_grid,i=e(),n=i.depends,o=i.doc_fields;t.records=i.vc_pass_fields.filter(function(e){if(3==e.id_type)return!1;var t=n[e.id];return!t||1==i.item["f_"+t]}),$.each(t.records,function(){this.w2ui&&delete this.w2ui.changes,this.is_doc=o[this.id],delete this.value}),t.refresh()};var o=w2ui.house_systems_layout;$(o.el("main")).w2regrid({name:"house_sys_gas_grid",show:{toolbar:!0,footer:1,toolbarReload:!1,toolbarColumns:!1},textSearch:"contains",columns:[{field:"label",caption:"Реквизит",size:100},{field:"value",caption:"Значение",size:20,attr:"data-status",editable:function(t){switch(t.id_type){case 0:return{type:"int"};case 1:return{type:"float",precision:4,autoFormat:!0,keyboard:!1,min:0};case 2:return{type:"text"};case 4:return{type:"list",items:[{id:0,text:"Нет"},{id:1,text:"Да"}]};case 6:var t=e()["vc_nsi_"+t.voc];return t?{type:"list",items:t.items}:null;case 7:return{type:"int",min:1600,max:2215,autoFormat:!1};case 8:return{type:"date"};default:return null}},render:function(t){var i=e().item[t.name];if(t.is_multiple)switch(t.id_type){case 6:var n=e(),o=n["tb_houses_f_"+t.id],a="";return $.each(n["vc_nsi_"+t.voc].items,function(){o[this.id]&&(a&&(a+=", "),a+=this.label)}),a;default:return""}else switch(t.id_type){case 4:return 1==i?"Да":"Нет";case 1:return null==i?"":w2utils.formatNumber(i);case 6:var t=e()["vc_nsi_"+t.voc];return t?t[i]:"";case 8:return i?dt_dmy(i.substr(0,10)):"";default:return i}}},{field:"unit",caption:"Ед. изм.",size:5}],records:[],onDblClick:null,onEditField:function(n){var o=this,a=o.get(n.recid);if(a.is_doc)return alert('Добавление подтверждающих документов осуществляется на вкладке "Документы"'),n.preventDefault();if(a.is_multiple){var r=e(),s={def:a,voc:r["vc_nsi_"+a.voc],ids:r["tb_houses_f_"+a.id]};return $_SESSION.set("field",s),use.block("house_multiple_popup"),n.preventDefault()}var d=o.columns[n.column],c=d.editable(a),u=e().item["f_"+n.recid];if(4==a.id_type&&1==u){var r=i.depends;for(var l in r)if(r[l]==a.id){var _=t[l];if(_.id_dt&&e().item["f_"+_.id_dt])return alert("Первоначально необходимо удалить "+_.label.toLowerCase()+' на вкладке "Документы"'),n.preventDefault()}}"date"==c.type?n.value=u?new Date(u):new Date:n.value=u},onChange:$_DO.patch_house_sys_gas,onRefresh:function(e){e.done(function(){var e=null;$.each(i.vc_pass_fields,function(){if(!("id_type"in this)){var t="tr[recid="+this.id+"]";$(t+" td.w2ui-grid-data").css({"font-weight":"bold","border-bottom-width":"1px"}).eq(0).css({"border-right-width":0}),e&&(t="tr[recid="+e+"]",$(t+" td.w2ui-grid-data").css({"border-bottom-width":"1px"}))}e=this.id})})}}),$_F5()}}),define("app/view/house_sys_heating",[],function(){function e(){return $("body").data("data")}var t={};return function(i,n){$.each(i.vc_pass_fields,function(){t[this.id]=this}),$_F5=function(){var t=w2ui.house_sys_heating_grid,i=e(),n=i.depends,o=i.doc_fields;t.records=i.vc_pass_fields.filter(function(e){if(3==e.id_type)return!1;var t=n[e.id];return!t||1==i.item["f_"+t]}),$.each(t.records,function(){this.w2ui&&delete this.w2ui.changes,this.is_doc=o[this.id],delete this.value}),t.refresh()};var o=w2ui.house_systems_layout;$(o.el("main")).w2regrid({name:"house_sys_heating_grid",show:{toolbar:!0,footer:1,toolbarReload:!1,toolbarColumns:!1},textSearch:"contains",columns:[{field:"label",caption:"Реквизит",size:100},{field:"value",caption:"Значение",size:20,attr:"data-status",editable:function(t){switch(t.id_type){case 0:return{type:"int"};case 1:return{type:"float",precision:4,autoFormat:!0,keyboard:!1,min:0};case 2:return{type:"text"};case 4:return{type:"list",items:[{id:0,text:"Нет"},{id:1,text:"Да"}]};case 6:var t=e()["vc_nsi_"+t.voc];return t?{type:"list",items:t.items}:null;case 7:return{type:"int",min:1600,max:2215,autoFormat:!1};case 8:return{type:"date"};default:return null}},render:function(t){var i=e().item[t.name];if(t.is_multiple)switch(t.id_type){case 6:var n=e(),o=n["tb_houses_f_"+t.id],a="";return $.each(n["vc_nsi_"+t.voc].items,function(){o[this.id]&&(a&&(a+=", "),a+=this.label)}),a;default:return""}else switch(t.id_type){case 4:return 1==i?"Да":"Нет";case 1:return null==i?"":w2utils.formatNumber(i);case 6:var t=e()["vc_nsi_"+t.voc];return t?t[i]:"";case 8:return i?dt_dmy(i.substr(0,10)):"";default:return i}}},{field:"unit",caption:"Ед. изм.",size:5}],records:[],onDblClick:null,onEditField:function(n){var o=this,a=o.get(n.recid);if(a.is_doc)return alert('Добавление подтверждающих документов осуществляется на вкладке "Документы"'),n.preventDefault();if(a.is_multiple){var r=e(),s={def:a,voc:r["vc_nsi_"+a.voc],ids:r["tb_houses_f_"+a.id]};return $_SESSION.set("field",s),use.block("house_multiple_popup"),n.preventDefault()}var d=o.columns[n.column],c=d.editable(a),u=e().item["f_"+n.recid];if(4==a.id_type&&1==u){var r=i.depends;for(var l in r)if(r[l]==a.id){var _=t[l];if(_.id_dt&&e().item["f_"+_.id_dt])return alert("Первоначально необходимо удалить "+_.label.toLowerCase()+' на вкладке "Документы"'),n.preventDefault()}}"date"==c.type?n.value=u?new Date(u):new Date:n.value=u},onChange:$_DO.patch_house_sys_heating,onRefresh:function(e){e.done(function(){var e=null;$.each(i.vc_pass_fields,function(){if(!("id_type"in this)){var t="tr[recid="+this.id+"]";$(t+" td.w2ui-grid-data").css({"font-weight":"bold","border-bottom-width":"1px"}).eq(0).css({"border-right-width":0}),e&&(t="tr[recid="+e+"]",$(t+" td.w2ui-grid-data").css({"border-bottom-width":"1px"}))}e=this.id})})}}),$_F5()}}),define("app/view/house_sys_hot_water",[],function(){function e(){return $("body").data("data")}var t={};return function(i,n){$.each(i.vc_pass_fields,function(){t[this.id]=this}),$_F5=function(){var t=w2ui.house_sys_hot_water_grid,i=e(),n=i.depends,o=i.doc_fields;t.records=i.vc_pass_fields.filter(function(e){if(3==e.id_type)return!1;var t=n[e.id];return!t||1==i.item["f_"+t]}),$.each(t.records,function(){this.w2ui&&delete this.w2ui.changes,this.is_doc=o[this.id],delete this.value}),t.refresh()};var o=w2ui.house_systems_layout;$(o.el("main")).w2regrid({name:"house_sys_hot_water_grid",show:{toolbar:!0,footer:1,toolbarReload:!1,toolbarColumns:!1},textSearch:"contains",columns:[{field:"label",caption:"Реквизит",size:100},{field:"value",caption:"Значение",size:20,attr:"data-status",editable:function(t){switch(t.id_type){case 0:return{type:"int"};case 1:return{type:"float",precision:4,autoFormat:!0,keyboard:!1,min:0};case 2:return{type:"text"};case 4:return{type:"list",items:[{id:0,text:"Нет"},{id:1,text:"Да"}]};case 6:var t=e()["vc_nsi_"+t.voc];return t?{type:"list",items:t.items}:null;case 7:return{type:"int",min:1600,max:2215,autoFormat:!1};case 8:return{type:"date"};default:return null}},render:function(t){var i=e().item[t.name];if(t.is_multiple)switch(t.id_type){case 6:var n=e(),o=n["tb_houses_f_"+t.id],a="";return $.each(n["vc_nsi_"+t.voc].items,function(){o[this.id]&&(a&&(a+=", "),a+=this.label)}),a;default:return""}else switch(t.id_type){case 4:return 1==i?"Да":"Нет";case 1:return null==i?"":w2utils.formatNumber(i);case 6:var t=e()["vc_nsi_"+t.voc];return t?t[i]:"";case 8:return i?dt_dmy(i.substr(0,10)):"";default:return i}}},{field:"unit",caption:"Ед. изм.",size:5}],records:[],onDblClick:null,onEditField:function(n){var o=this,a=o.get(n.recid);if(a.is_doc)return alert('Добавление подтверждающих документов осуществляется на вкладке "Документы"'),n.preventDefault();if(a.is_multiple){var r=e(),s={def:a,voc:r["vc_nsi_"+a.voc],ids:r["tb_houses_f_"+a.id]};return $_SESSION.set("field",s),use.block("house_multiple_popup"),n.preventDefault()}var d=o.columns[n.column],c=d.editable(a),u=e().item["f_"+n.recid];if(4==a.id_type&&1==u){var r=i.depends;for(var l in r)if(r[l]==a.id){var _=t[l];if(_.id_dt&&e().item["f_"+_.id_dt])return alert("Первоначально необходимо удалить "+_.label.toLowerCase()+' на вкладке "Документы"'),n.preventDefault()}}"date"==c.type?n.value=u?new Date(u):new Date:n.value=u},onChange:$_DO.patch_house_sys_hot_water,onRefresh:function(e){e.done(function(){var e=null;$.each(i.vc_pass_fields,function(){if(!("id_type"in this)){var t="tr[recid="+this.id+"]";$(t+" td.w2ui-grid-data").css({"font-weight":"bold","border-bottom-width":"1px"}).eq(0).css({"border-right-width":0}),e&&(t="tr[recid="+e+"]",$(t+" td.w2ui-grid-data").css({"border-bottom-width":"1px"}))}e=this.id})})}}),$_F5()}}),define("app/view/house_sys_sewer",[],function(){function e(){return $("body").data("data")}var t={};return function(i,n){$.each(i.vc_pass_fields,function(){t[this.id]=this}),$_F5=function(){var t=w2ui.house_sys_sewer_grid,i=e(),n=i.depends,o=i.doc_fields;t.records=i.vc_pass_fields.filter(function(e){if(3==e.id_type)return!1;var t=n[e.id];return!t||1==i.item["f_"+t]}),$.each(t.records,function(){this.w2ui&&delete this.w2ui.changes,this.is_doc=o[this.id],delete this.value}),t.refresh()};var o=w2ui.house_systems_layout;$(o.el("main")).w2regrid({name:"house_sys_sewer_grid",show:{toolbar:!0,footer:1,toolbarReload:!1,toolbarColumns:!1},textSearch:"contains",columns:[{field:"label",caption:"Реквизит",size:100},{field:"value",caption:"Значение",size:20,attr:"data-status",editable:function(t){switch(t.id_type){case 0:return{type:"int"};case 1:return{type:"float",precision:4,autoFormat:!0,keyboard:!1,min:0};case 2:return{type:"text"};case 4:return{type:"list",items:[{id:0,text:"Нет"},{id:1,text:"Да"}]};case 6:var t=e()["vc_nsi_"+t.voc];return t?{type:"list",items:t.items}:null;case 7:return{type:"int",min:1600,max:2215,autoFormat:!1};case 8:return{type:"date"};default:return null}},render:function(t){var i=e().item[t.name];if(t.is_multiple)switch(t.id_type){case 6:var n=e(),o=n["tb_houses_f_"+t.id],a="";return $.each(n["vc_nsi_"+t.voc].items,function(){o[this.id]&&(a&&(a+=", "),a+=this.label)}),a;default:return""}else switch(t.id_type){case 4:return 1==i?"Да":"Нет";case 1:return null==i?"":w2utils.formatNumber(i);case 6:var t=e()["vc_nsi_"+t.voc];return t?t[i]:"";case 8:return i?dt_dmy(i.substr(0,10)):"";default:return i}}},{field:"unit",caption:"Ед. изм.",size:5}],records:[],onDblClick:null,onEditField:function(n){var o=this,a=o.get(n.recid);if(a.is_doc)return alert('Добавление подтверждающих документов осуществляется на вкладке "Документы"'),n.preventDefault();if(a.is_multiple){var r=e(),s={def:a,voc:r["vc_nsi_"+a.voc],ids:r["tb_houses_f_"+a.id]};return $_SESSION.set("field",s),use.block("house_multiple_popup"),n.preventDefault()}var d=o.columns[n.column],c=d.editable(a),u=e().item["f_"+n.recid];if(4==a.id_type&&1==u){var r=i.depends;for(var l in r)if(r[l]==a.id){var _=t[l];if(_.id_dt&&e().item["f_"+_.id_dt])return alert("Первоначально необходимо удалить "+_.label.toLowerCase()+' на вкладке "Документы"'),n.preventDefault()}}"date"==c.type?n.value=u?new Date(u):new Date:n.value=u},onChange:$_DO.patch_house_sys_sewer,onRefresh:function(e){e.done(function(){var e=null;$.each(i.vc_pass_fields,function(){if(!("id_type"in this)){var t="tr[recid="+this.id+"]";$(t+" td.w2ui-grid-data").css({"font-weight":"bold","border-bottom-width":"1px"}).eq(0).css({"border-right-width":0}),e&&(t="tr[recid="+e+"]",$(t+" td.w2ui-grid-data").css({"border-bottom-width":"1px"}))}e=this.id})})}}),$_F5()}}),define("app/view/house_sys",[],function(){function e(){return $("body").data("data")}var t={};return function(i,n){$.each(i.vc_pass_fields,function(){t[this.id]=this}),$_F5=function(){var t=w2ui.house_sys_grid,i=e(),n=i.depends,o=i.doc_fields;t.records=i.vc_pass_fields.filter(function(e){if(3==e.id_type)return!1;var t=n[e.id];return!t||1==i.item["f_"+t]}),$.each(t.records,function(){this.w2ui&&delete this.w2ui.changes,this.is_doc=o[this.id],delete this.value}),t.refresh()};var o=w2ui.house_systems_layout;$(o.el("main")).w2regrid({name:"house_sys_grid",show:{toolbar:!0,footer:1,toolbarReload:!1,toolbarColumns:!1},textSearch:"contains",columns:[{field:"label",caption:"Реквизит",size:100},{field:"value",caption:"Значение",size:20,attr:"data-status",editable:function(t){switch(t.id_type){case 0:return{type:"int"};case 1:return{type:"float",precision:4,autoFormat:!0,keyboard:!1,min:0};case 2:return{type:"text"};case 4:return{type:"list",items:[{id:0,text:"Нет"},{id:1,text:"Да"}]};case 6:var t=e()["vc_nsi_"+t.voc];return t?{type:"list",items:t.items}:null;case 7:return{type:"int",min:1600,max:2215,autoFormat:!1};case 8:return{type:"date"};default:return null}},render:function(t){var i=e().item[t.name];if(t.is_multiple)switch(t.id_type){case 6:var n=e(),o=n["tb_houses_f_"+t.id],a="";return $.each(n["vc_nsi_"+t.voc].items,function(){o[this.id]&&(a&&(a+=", "),a+=this.label)}),a;default:return""}else switch(t.id_type){case 4:return 1==i?"Да":"Нет";case 1:return null==i?"":w2utils.formatNumber(i);case 6:var t=e()["vc_nsi_"+t.voc];return t?t[i]:"";case 8:return i?dt_dmy(i.substr(0,10)):"";default:return i}}},{
field:"unit",caption:"Ед. изм.",size:5}],records:[],onDblClick:null,onEditField:function(n){var o=this,a=o.get(n.recid);if(a.is_doc)return alert('Добавление подтверждающих документов осуществляется на вкладке "Документы"'),n.preventDefault();if(a.is_multiple){var r=e(),s={def:a,voc:r["vc_nsi_"+a.voc],ids:r["tb_houses_f_"+a.id]};return $_SESSION.set("field",s),use.block("house_multiple_popup"),n.preventDefault()}var d=o.columns[n.column],c=d.editable(a),u=e().item["f_"+n.recid];if(4==a.id_type&&1==u){var r=i.depends;for(var l in r)if(r[l]==a.id){var _=t[l];if(_&&_.id_dt&&e().item["f_"+_.id_dt])return alert("Первоначально необходимо удалить "+_.label.toLowerCase()+' на вкладке "Документы"'),n.preventDefault()}}"date"==c.type?n.value=u?new Date(u):new Date:n.value=u},onChange:$_DO.patch_house_sys,onRefresh:function(e){e.done(function(){var e=null;$.each(i.vc_pass_fields,function(){if(!("id_type"in this)){var t="tr[recid="+this.id+"]";$(t+" td.w2ui-grid-data").css({"font-weight":"bold","border-bottom-width":"1px"}).eq(0).css({"border-right-width":0}),e&&(t="tr[recid="+e+"]",$(t+" td.w2ui-grid-data").css({"border-bottom-width":"1px"}))}e=this.id})})}}),$_F5()}}),define("app/view/house_systems",[],function(){return function(e,t){var i=w2ui.topmost_layout;i.unlock("main");var n=[{id:"house_sys",caption:"Наличие систем",_type:"house_sys"}];$.each(e.systems,function(){n.push({id:this.id,caption:this.label,hidden:this.off,_type:"house_sys_"+this.name})}),$(i.el("main")).w2relayout({name:"house_systems_layout",panels:[{type:"main",size:400,tabs:{tabs:n,onClick:$_DO.choose_tab_house_systems}}],onRender:function(t){this.get("main").tabs.click(e.active_tab)}})}}),define("app/view/house",[],function(){return function(e,t){$("title").text(e.item.address),fill(t,e,$("body")),$("#container").w2layout({name:"topmost_layout",panels:[{type:"main",size:400,tabs:{tabs:[{id:"house_address",caption:"Адрес"},{id:"house_passport",caption:"Общие"},{id:"house_common",caption:"Паспорт"},{id:"house_constr",caption:"Конструктивные элементы",off:!e.item.is_condo},{id:"house_systems",caption:"Внутридомовые сети",off:!e.item.is_condo},{id:"house_premises",caption:"Помещения",off:!e.item.is_condo},{id:"house_living_rooms",caption:"Комнаты",off:e.item.is_condo&&!e.has_shared_premises_res},{id:"house_docs",caption:"Документы"}].filter(not_off),onClick:$_DO.choose_tab_house}}],onRender:function(t){this.get("main").tabs.click(e.active_tab)}})}}),define("app/view/houses",[],function(){return function(e,t){$(w2ui.rosters_layout.el("main")).w2regrid({name:"houses_grid",show:{toolbar:!0,footer:!0},searches:[{field:"is_condo",caption:"Тип",type:"list",options:{items:[{id:"1",text:"МКД"},{id:"0",text:"ЖД"}]}},{field:"address_uc",caption:"Адрес",type:"text"},{field:"fiashouseguid",caption:"GUID ФИАС",type:"text",operators:["null","not null","is"],operator:"is"}],columns:[{field:"is_condo",caption:"Тип дома",size:10,render:function(e){return e.is_condo?"МКД":"ЖД"}},{field:"unom",caption:"UNOM",size:8},{field:"fiashouseguid",caption:"GUID ФИАС",size:30},{field:"address",caption:"Адрес",size:100}],url:"/mosgis/_rest/?type=houses",onDblClick:function(e){openTab("/house/"+e.recid)}}).refresh(),$("#grid_houses_grid_search_all").focus()}}),define("app/view/insurance_product_common_log",[],function(){return function(e,t){$("body").data("data"),$(w2ui.passport_layout.el("main")).w2regrid({name:"insurance_product_common_log",show:{toolbar:!0,toolbarInput:!1,footer:!0},columnGroups:[{span:3,caption:"Событие"},{span:5,caption:"Значения полей"},{span:4,caption:"Запрос в ГИС ЖКХ"}],columns:[{field:"ts",caption:"Дата/время",size:30,render:_ts},{field:"action",caption:"Действие",size:30,voc:{create:"Создание",update:"Редактирование",delete:"Удаление",undelete:"Восстановление"}},{field:"vc_users.label",caption:"Оператор",size:30},{field:"description",caption:"Описание",size:50},{field:"org_ins.label",caption:"Страховщик",size:100},{field:"name",caption:"Имя файла",size:50,attr:"data-ref=1"},{field:"len",caption:"Объём, Мб",size:10,render:function(e){return(e.len/1024/1024).toFixed(3)}},{field:"is_deleted",caption:"Статус",size:20,voc:{0:"Актуально",1:"Удалено"}},{field:"soap.ts",caption:"Отправлено",size:30,render:_ts,attr:"data-ref=1"},{field:"soap.ts_rp",caption:"Обработано",size:30,render:_ts,attr:"data-ref=1"},{field:"soap.id_status",caption:"Статус",size:30,render:function(e,t,i,n){switch(n){case 3:return"Обработано";case 2:return"Ожидает ответа";default:return"Ожидает отправки"}}},{field:"soap.err_text",caption:"Ошибка",size:30}],postData:{data:{uuid_object:$_REQUEST.id}},url:"/mosgis/_rest/?type=insurance_product_log",onClick:function(e){var t=this.columns[e.column],i=this.get(e.recid);switch(t.field){case"name":return $_DO.download_insurance_product_common_log(e);case"soap.ts":if(i.uuid_out_soap)return openTab("/out_soap_rq/"+i.uuid_out_soap);case"soap.ts_rp":if(i.uuid_message)return openTab("/out_soap_rp/"+i.uuid_message)}}}).refresh()}}),define("app/view/insurance_product_common",[],function(){var e="insurance_product_common_form";return function(t,i){$_F5=function(t){t.item.__read_only=t.__read_only;var i=clone(t.item);w2ui[e].record=i,$("div[data-block-name=insurance_product_common] input, textarea").prop({disabled:t.__read_only}),w2ui[e].refresh()};var n=w2ui.topmost_layout,o=$(n.el("main"));o.w2relayout({name:"passport_layout",panels:[{type:"top",size:190},{type:"main",size:400,tabs:{tabs:[{id:"insurance_product_common_log",caption:"История изменений"}],onClick:$_DO.choose_tab_insurance_product_common}}],onRender:function(e){this.get("main").tabs.click(t.active_tab)}});var o=$(w2ui.passport_layout.el("top"));fill(i,t.item,o),o.w2reform({name:e,record:t.item,fields:[{name:"description",type:"textarea"},{name:"files",type:"file",options:{max:1}},{name:"insuranceorg",type:"list",options:{items:t.vc_orgs_ins.items.concat({id:0,text:"(другая организация...)"})}}],focus:-1,onChange:function(e){"insuranceorg"==e.target&&0==e.value_new.id&&$_DO.open_orgs_insurance_product_common()}}),$_F5(t),clickOn($("#file_label"),$_DO.download_insurance_product_common)}}),define("app/view/insurance_product_popup",[],function(){return function(e,t){$(t).w2popup("open",{width:605,height:280,title:"Страховой продукт",onOpen:function(t){t.onComplete=function(){var t="insurance_product_popup_form";w2ui[t]&&w2ui[t].destroy(),$("#w2ui-popup .w2ui-form").w2form({record:e.record,name:t,fields:[{name:"description",type:"textarea"},{name:"files",type:"file",options:{max:1}},{name:"insuranceorg",type:"list",options:{items:e.vc_orgs_ins.items.concat({id:"other",text:"(другая организация...)"})}}],focus:e.record.insuranceorg?1:0,onChange:function(e){"insuranceorg"==e.target&&"other"==e.value_new.id&&$_DO.open_orgs_insurance_product_popup()}}),clickOn($("#w2ui-popup button"),$_DO.update_insurance_product_popup)}}})}}),define("app/view/insurance_product",[],function(){return function(e,t){$("title").text(e.item.label),fill(t,e.item,$("body")),$("#container").w2layout({name:"topmost_layout",panels:[{type:"main",size:400,tabs:{tabs:[{id:"insurance_product_common",caption:"Общие"}].filter(not_off),onClick:$_DO.choose_tab_insurance_product}}],onRender:function(e){clickActiveTab(this.get("main").tabs,"insurance_product.active_tab")}})}}),define("app/view/insurance_products",[],function(){function e(e){e.done(function(){var e=w2ui.insurance_products_grid,t=e.toolbar,i=e.getSelection();1!=i.length||e.get(i[0]).is_deleted?t.disable("edit","delete"):t.enable("edit","delete")})}return function(t,i){t=$("body").data("data"),$(w2ui.vocs_layout.el("main")).w2regrid({name:"insurance_products_grid",show:{toolbar:!0,toolbarAdd:!$_USER.role.admin,footer:!0},toolbar:{items:[{type:"button",id:"edit",caption:"Изменить",onClick:$_DO.edit_insurance_products,disabled:!0,off:$_USER.role.admin,icon:"w2ui-icon-pencil"},{type:"button",id:"delete",caption:"Удалить",onClick:$_DO.delete_insurance_products,disabled:!0,off:$_USER.role.admin,icon:"w2ui-icon-cross"}].filter(not_off)},searches:[{field:"label_uc",caption:"Наименование",type:"text"},{field:"is_deleted",caption:"Статус записи",type:"enum",options:{items:[{id:"0",text:"Актуальные"},{id:"1",text:"Удалённые"}]}},{field:"id_status",caption:"Статус синхронизации",type:"enum",options:{items:t.vc_async_entity_states.items}},{field:"uuid_org",caption:"Организации",type:"enum",options:{items:t.vc_orgs.items},off:!$_USER.role.admin}].filter(not_off),columns:[{field:"org.label",caption:"Организация",size:100,off:!$_USER.role.admin},{field:"label",caption:"Описание",size:50},{field:"org_ins.label",caption:"Страховщик",size:100},{field:"name",caption:"Имя файла",size:50,attr:"data-ref=1"},{field:"len",caption:"Объём, Мб",size:10,render:function(e){return(e.len/1024/1024).toFixed(3)}},{field:"id_status",caption:"Статус",size:50,render:function(e,i,n,o){var a=t.vc_async_entity_states[o];return 30==o&&(a="<font color=red>"+a+"</font>: ",a+=e.out_soap.err_text),a}},{field:"uniquenumber",caption:"Код в ГИС ЖКХ",size:50}].filter(not_off),url:"/mosgis/_rest/?type=insurance_products",onAdd:$_DO.create_insurance_products,onEdit:$_DO.edit_insurance_products,onClick:function(e){"name"==this.columns[e.column].field&&$_DO.download_insurance_products(e)},onDblClick:function(e){openTab("/insurance_product/"+e.recid)},onRefresh:function(e){e.done(color_data_mandatory)},onSelect:e,onUnselect:e}).refresh()}}),define("app/view/lift_new",[],function(){return function(e,t){var i=e.item,n=i.usedyear||1600;$(t).w2uppop({},function(){$("#w2ui-popup .w2ui-form").w2reform({name:"lift_new_form",record:{},fields:[{name:"uuid_entrance",type:"list",options:{items:e.entrances.items}},{name:"code_vc_nsi_192",type:"list",options:{items:e.vc_nsi_192.items}},{name:"factorynum",type:"text"},{name:"f_20007",type:"text"},{name:"f_20165",type:"float"},{name:"f_20164",type:"int",options:{min:n,max:(new Date).getFullYear(),autoFormat:!1}},{name:"f_20166",type:"int"},{name:"operatinglimit",type:"int"},{name:"f_20151",type:"float"},{name:"f_20124",type:"int",options:{min:n,max:(new Date).getFullYear(),autoFormat:!1}},{name:"terminationdate",type:"date",options:{min:new Date(n,1,1,0,0,0,0),max:new Date}},{name:"annulmentinfo",type:"text"}]}),clickOn($("#w2ui-popup button"),$_DO.update_lift_new)})}}),define("app/view/lift_popup",[],function(){return function(e,t){var i=e.item,n=i.usedyear||1600;$(t).w2uppop({},function(){$("#w2ui-popup .w2ui-form").w2reform({name:"lift_popup_form",record:e.lift,fields:[{name:"uuid_entrance",type:"list",options:{items:e.entrances.items}},{name:"code_vc_nsi_192",type:"list",options:{items:e.vc_nsi_192.items}},{name:"factorynum",type:"text"},{name:"f_20007",type:"text"},{name:"f_20165",type:"float"},{name:"f_20164",type:"int",options:{max:(new Date).getFullYear(),autoFormat:!1}},{name:"f_20166",type:"int"},{name:"operatinglimit",type:"int"},{name:"f_20151",type:"float"},{name:"f_20124",type:"int",options:{min:n,max:(new Date).getFullYear(),autoFormat:!1}},{name:"terminationdate",type:"date",options:{min:new Date(n,1,1,0,0,0,0),max:new Date}},{name:"annulmentinfo",type:"text"}],focus:-1}),clickOn($("#w2ui-popup button"),$_DO.update_lift_popup)})}}),define("app/view/living_room_common",[],function(){var e="living_room_common_form";return function(t,i){$_F5=function(t){t.item.__read_only=t.__read_only;var i=clone(t.item);/-/.test(i.terminationdate)&&(i.terminationdate=dt_dmy(i.terminationdate.substr(0,10))),w2ui[e].record=i,$("div[data-block-name=living_room_common] input").prop({disabled:t.__read_only}),w2ui[e].refresh()};var n=w2ui.topmost_layout,o=$(n.el("main"));o.w2relayout({name:"passport_layout",panels:[{type:"top",size:200},{type:"main",size:400,tabs:{tabs:[],onClick:$_DO.choose_tab_living_room_common}}],onRender:function(e){this.get("main").tabs.click(t.active_tab)}});var o=$(w2ui.passport_layout.el("top"));t.item.annulmentreason_label=t.vc_nsi_330[t.item.annulmentreason],fill(i,t.item,o),o.w2reform({name:e,record:t.item,fields:[{name:"roomnumber",type:"text"},{name:"cadastralnumber",type:"text"},{name:"square",type:"float",options:{min:0}}],focus:-1}),$_F5(t)}}),define("app/view/living_room_invalid",[],function(){var e="living_room_invalid_form";return function(t,i){$_F5=function(t){var i=clone(t.item);/-/.test(i.f_20133)&&(i.f_20133=dt_dmy(i.f_20133.substr(0,10))),i.__read_only=t.__read_only,w2ui[e].record=i,$("div[data-block-name=living_room_invalid] input").prop({disabled:i.__read_only}),w2ui[e].refresh()};var n=w2ui.topmost_layout,o=$(n.el("main"));o.w2relayout({name:"passport_layout",panels:[{type:"top",size:200},{type:"main",size:400,tabs:{tabs:[],onClick:$_DO.choose_tab_living_room_invalid}}],onRender:function(e){this.get("main").tabs.click(t.active_tab)}});var o=$(w2ui.passport_layout.el("top"));fill(i,t.item,o),o.w2reform({name:e,record:t.item,fields:[{name:"f_20132",type:"list",options:{items:t.vc_nsi_273.items}},{name:"f_20133",type:"date",options:{max:new Date}},{name:"f_20134",type:"text"},{name:"file",type:"file",options:{max:1}}].filter(not_off),focus:-1,onRefresh:function(e){e.done(function(){var e=$("body").data("data").file;this.record.__read_only?($("#file_input_div").hide(),e?($("#file_label").text(e.label),clickOn($("#file_label"),$_DO.download_living_room_invalid)):$("#file_link_div").hide()):$("#file_input_div").show()})}}),$_F5(t)}}),define("app/view/living_room_passport",[],function(){function e(){return $("body").data("data")}var t={};return function(i,n){$.each(i.vc_pass_fields,function(){t[this.id]=this}),$_F5=function(){var t=w2ui.living_room_passport_grid,i=e(),n=i.doc_fields;t.records=i.vc_pass_fields.filter(function(e){return 3!=e.id_type}),$.each(t.records,function(){this.w2ui&&delete this.w2ui.changes,this.is_doc=n[this.id],delete this.value}),t.refresh()};var o=w2ui.topmost_layout;$(o.el("main")).w2regrid({name:"living_room_passport_grid",show:{toolbar:!0,footer:1,toolbarReload:!1,toolbarColumns:!1},textSearch:"contains",columns:[{field:"label",caption:"Реквизит",size:100},{field:"value",caption:"Значение",size:20,attr:"data-status",editable:function(t){switch(t.id_type){case 0:return{type:"int"};case 1:return{type:"float",precision:4,autoFormat:!0,keyboard:!1,min:0};case 2:return{type:"text"};case 4:return{type:"list",items:[{id:0,text:"Нет"},{id:1,text:"Да"}]};case 6:var t=e()["vc_nsi_"+t.voc];return t?{type:"list",items:t.items}:null;case 7:return{type:"int",min:1600,max:2215,autoFormat:!1};case 8:return{type:"date"};default:return null}},render:function(t){var i=e().item[t.name];if(t.is_multiple)switch(t.id_type){case 6:var n=e(),o=n["tb_living_rooms_f_"+t.id],a="";return $.each(n["vc_nsi_"+t.voc].items,function(){o[this.id]&&(a&&(a+=", "),a+=this.label)}),a;default:return""}else switch(t.id_type){case 4:return 1==i?"Да":"Нет";case 1:return null==i?"":w2utils.formatNumber(i);case 6:var t=e()["vc_nsi_"+t.voc];return t?t[i]:"";case 8:return i?dt_dmy(i.substr(0,10)):"";default:return i}}},{field:"unit",caption:"Ед. изм.",size:5}],records:[],onDblClick:null,onEditField:function(n){if(e().item.is_annuled)return alert("Поскольку данный объект жилого фонда аннулирован, редактирование невозможно."),n.preventDefault();var o=this,a=o.get(n.recid);if(a.is_doc)return alert('Добавление подтверждающих документов осуществляется на вкладке "Документы"'),n.preventDefault();if(a.is_multiple){var r=e(),s={def:a,voc:r["vc_nsi_"+a.voc],ids:r["tb_living_rooms_f_"+a.id]};return $_SESSION.set("field",s),use.block("passport_multiple_popup"),n.preventDefault()}var d=o.columns[n.column],c=d.editable(a),u=e().item["f_"+n.recid];if(4==a.id_type&&1==u){var r=i.depends;for(var l in r)if(r[l]==a.id){var _=t[l];if(_.id_dt&&e().item["f_"+_.id_dt])return alert("Первоначально необходимо удалить "+_.label.toLowerCase()+' на вкладке "Документы"'),n.preventDefault()}}"date"==c.type?n.value=u?new Date(u):new Date:n.value=u},onChange:$_DO.patch_living_room_passport,onRefresh:color_passport_grid}),$_F5()}}),define("app/view/living_room_popup",[],function(){return function(e,t){var i="premise_residental"==$_REQUEST.type?{is_condo:1}:e.item,n="house"==$_REQUEST.type&&!i.is_condo&&!i.hasblocks;e.record.item=i,fill(t,e).w2uppop({},function(){$("#w2ui-popup .w2ui-form").w2reform({name:"living_room_new_form",record:e.record,fields:[{name:"roomnumber",type:"text"},{name:"cadastralnumber",type:"text"},{name:"square",type:"float",options:{min:0}},{name:"f_20130",type:"int",options:{min:0}},{name:"f_20056",type:"list",options:{items:e.vc_nsi_261.items}},{name:"uuid_premise",type:"list",options:{items:(e.vc_premises||{}).items},off:!i.is_condo},{name:"uuid_block",type:"list",options:{items:(e.vc_blocks||{}).items},off:i.is_condo}].filter(not_off),onRefresh:function(e){var t=w2ui[e.target],i=t.record,o=t.fields.filter(function(e){return"enum"==e.type});o.length&&$.each(o,function(){var e=this.name,t=i[e];Array.isArray(t)&&t.length&&"object"!=typeof t[0]&&(i[e]=this.options.items.filter(function(e){return t.includes(e.id)}))}),n&&$("#uuid_block").prop({disabled:1})},focus:n?2:1}).refresh()})}}),define("app/view/living_room",[],function(){return function(e,t){$("title").text(e.item.label+", "+e.item.address),fill(t,e,$("body")),$("#container").w2layout({name:"topmost_layout",panels:[{type:"main",size:400,tabs:{tabs:[{id:"living_room_common",caption:"Общие"},{id:"living_room_passport",caption:"Паспорт"},{id:"living_room_invalid",caption:"Непригодность для проживания",hidden:1!=e.item.f_20131}],onClick:$_DO.choose_tab_living_room}}],onRender:function(e){clickActiveTab(this.get("main").tabs,"living_room.active_tab")}})}}),define("app/view/login",[],function(){return function(e,t){$("nav").hide(),fill(t,e,$("main")),$("div.login-inner").w2form({name:"form",header:"Вход в систему",fields:[{field:"login",type:"text"},{field:"password",type:"password"}],actions:{execute:{caption:"Войти",onClick:$_DO.execute_login}}}),$("input[name=login]").keypress(function(e){13==e.which&&$("input[name=password]").focus()}),$("input[name=password]").keypress(function(e){13==e.which&&$_DO.execute_login()})}}),define("app/view/main",[],function(){return function(e,t){if(fill(t,e,$("body")),!$_USER)return use.block("login");$("main").w2layout({name:"topmost_layout",panels:[{type:"main",size:400,tabs:{tabs:[{id:"out_soap",caption:"Запросы сервиса"},{id:"voc_nsi_list",caption:"Справочники"},{id:"rosters",caption:"Реестры"}],onClick:$_DO.choose_tab_main}}],onRender:function(t){this.get("main").tabs.click(e.active_tab)}})}}),define("app/view/municipal_service_common_log",[],function(){return function(e,t){e=$("body").data("data"),$(w2ui.passport_layout.el("main")).w2regrid({name:"municipal_service_common_log",show:{toolbar:!0,toolbarInput:!1,footer:!0},columnGroups:[{span:3,caption:"Событие"},{span:7,caption:"Значения полей"},{span:4,caption:"Запрос в ГИС ЖКХ"}],columns:[{field:"ts",caption:"Дата/время",size:30,render:_ts},{field:"action",caption:"Действие",size:30,voc:{create:"Создание",update:"Редактирование",delete:"Удаление",undelete:"Восстановление"}},{field:"vc_users.label",caption:"Оператор",size:30},{field:"sortorder",caption:"№ п/п",size:10},{field:"label",caption:"Наименование",size:50},{field:"code_vc_nsi_3",caption:"Вид",size:10,voc:e.vc_nsi_3},{field:"code_vc_nsi_2",caption:"Ресурс",size:10,voc:e.vc_nsi_2},{field:"is_general",caption:"Общедомовые",size:10,voc:{1:"Да"}},{field:"selfproduced",caption:"Самостоятельное производство",size:10,voc:{1:"Да"}},{field:"is_deleted",caption:"Статус",size:20,voc:{0:"Актуально",1:"Удалено"}},{field:"soap.ts",caption:"Отправлено",size:30,render:_ts,attr:"data-ref=1"},{field:"soap.ts_rp",caption:"Обработано",size:30,render:_ts,attr:"data-ref=1"},{field:"soap.id_status",caption:"Статус",size:30,render:function(e,t,i,n){switch(n){case 3:return"Обработано";case 2:return"Ожидает ответа";default:return"Ожидает отправки"}}},{field:"soap.err_text",caption:"Ошибка",size:30}],url:"/mosgis/_rest/?type=municipal_services&part=log&id="+$_REQUEST.id,onClick:function(e){var t=this.columns[e.column],i=this.get(e.recid);switch(t.field){case"soap.ts":if(i.uuid_out_soap)return openTab("/out_soap_rq/"+i.uuid_out_soap);case"soap.ts_rp":if(i.uuid_message)return openTab("/out_soap_rp/"+i.uuid_message)}}}).refresh()}}),define("app/view/municipal_service_common",[],function(){var e="municipal_service_common_form";return function(t,i){$_F5=function(t){t.item.__read_only=t.__read_only;var i=clone(t.item);w2ui[e].record=i,$("div[data-block-name=municipal_service_common] input").prop({disabled:t.__read_only}),w2ui[e].refresh()};var n=w2ui.topmost_layout,o=$(n.el("main"));o.w2relayout({name:"passport_layout",panels:[{type:"top",size:270},{type:"main",size:400,tabs:{tabs:[{id:"municipal_service_common_log",caption:"История изменений"}],onClick:$_DO.choose_tab_municipal_service_common}}],onRender:function(e){this.get("main").tabs.click(t.active_tab)}});var o=$(w2ui.passport_layout.el("top"));fill(i,t.item,o),o.w2reform({name:e,record:t.item,fields:[{name:"mainmunicipalservicename",type:"text"},{name:"sortorder",type:"text"},{name:"okei",type:"list",options:{items:t.vc_okei.items}},{name:"code_vc_nsi_2",type:"list",options:{items:t.vc_nsi_2.items}},{name:"code_vc_nsi_3",type:"list",options:{items:t.vc_nsi_3.items}},{name:"is_general",type:"list",options:{items:[{id:0,text:"нет"},{id:1,text:"общедомовые нужды"}]}},{name:"selfproduced",type:"list",options:{items:[{id:0,text:"нет"},{id:1,text:"самостоятельное производство"}]}}],focus:-1}),$_F5(t)}}),define("app/view/municipal_service_popup",[],function(){return function(e,t){$(fill(t,e.record)).w2uppop({},function(){$("#w2ui-popup .w2ui-form").w2reform({name:"voc_user_form",record:e.record,fields:[{name:"mainmunicipalservicename",type:"text"},{name:"sortorder",type:"text"},{name:"okei",type:"list",options:{items:e.vc_okei.items}},{name:"code_vc_nsi_2",type:"list",options:{items:e.vc_nsi_2.items}},{name:"code_vc_nsi_3",type:"list",options:{items:e.vc_nsi_3.items}},{name:"is_general",type:"list",options:{items:[{id:0,text:"нет"},{id:1,text:"общедомовые нужды"}]}},{name:"selfproduced",type:"list",options:{items:[{id:0,text:"нет"},{id:1,text:"самостоятельное производство"}]}}]})})}}),define("app/view/municipal_service",[],function(){return function(e,t){$("title").text(e.item.label),fill(t,e.item,$("body")),$("#container").w2layout({name:"topmost_layout",panels:[{type:"main",size:400,tabs:{tabs:[{id:"municipal_service_common",caption:"Общие"}].filter(not_off),onClick:$_DO.choose_tab_municipal_service}}],onRender:function(e){clickActiveTab(this.get("main").tabs,"municipal_service.active_tab")}})}}),define("app/view/municipal_services",[],function(){function e(e){e.done(function(){var e=w2ui.municipal_services_grid,t=e.toolbar,i=e.getSelection();1!=i.length||e.get(i[0]).is_deleted?t.disable("edit","delete"):t.enable("edit","delete")})}return function(t,i){t=$("body").data("data"),$(w2ui.vocs_layout.el("main")).w2regrid({name:"municipal_services_grid",show:{toolbar:!0,toolbarAdd:!$_USER.role.admin,footer:!0},toolbar:{items:[{type:"button",id:"edit",caption:"Изменить",onClick:$_DO.edit_municipal_services,disabled:!0,off:$_USER.role.admin,icon:"w2ui-icon-pencil"},{type:"button",id:"delete",caption:"Удалить",onClick:$_DO.delete_municipal_services,disabled:!0,off:$_USER.role.admin,icon:"w2ui-icon-cross"}].filter(not_off)},searches:[{field:"label_uc",caption:"Наименование",type:"text"},{field:"code_vc_nsi_3",caption:"Вид",type:"enum",options:{items:t.vc_nsi_3.items}},{field:"code_vc_nsi_2",caption:"Ресурс",type:"enum",options:{items:t.vc_nsi_2.items}},{field:"is_deleted",caption:"Статус записи",type:"enum",options:{items:[{id:"0",text:"Актуальные"},{id:"1",text:"Удалённые"}]}},{field:"id_status",caption:"Статус синхронизации",type:"enum",options:{items:t.vc_async_entity_states.items}},{field:"uuid_org",caption:"Организации",type:"enum",options:{items:t.vc_orgs.items},off:!$_USER.role.admin}].filter(not_off),columns:[{field:"org.label",caption:"Организация",size:100,off:!$_USER.role.admin},{field:"sortorder",caption:"№ п/п",size:10},{field:"label",caption:"Наименование",size:50},{field:"code_vc_nsi_3",caption:"Вид",size:10,voc:t.vc_nsi_3},{field:"code_vc_nsi_2",caption:"Ресурс",size:10,voc:t.vc_nsi_2},{field:"id_status",caption:"Статус",size:50,render:function(e,i,n,o){var a=t.vc_async_entity_states[o];return 30==o&&(a="<font color=red>"+a+"</font>: ",a+=e.out_soap.err_text),a}}].filter(not_off),url:"/mosgis/_rest/?type=municipal_services",onAdd:$_DO.create_municipal_services,onDblClick:function(e){openTab("/municipal_service/"+e.recid)},onRefresh:function(e){e.done(color_data_mandatory)},onSelect:e,onUnselect:e}).refresh()}}),define("app/view/nav",[],function(){return function(e,t){var i=$("nav");$_USER&&(fill(t,e,i.show()),$("body > nav header button").after("<hr>"),$("body > nav footer button").before("<hr>"),$("body > nav header button").each(function(){var e=$(this);if(!(location.href.indexOf(e.attr("name").substr(5))<0))return e.addClass("active"),!1}))}}),define("app/view/open_data_log_popup",[],function(){return function(e,t){$(t).w2uppop({},function(){$("#w2ui-popup .w2ui-form").w2reform({name:"user_own_options_form",record:{},fields:[]}),$(".w2ui-form .the_table_container").w2regrid({name:"user_own_options_grid",show:{toolbar:!0,footer:!0,toolbarSearch:!1,toolbarInput:!1,skipRecords:!1},columns:[{field:"no",caption:"№",size:10},{field:"dt",caption:"от",size:18,render:function(e){return dt_dmy(e.dt.substr(0,10))}},{field:"dt_from",caption:"Начало",size:18,render:function(e){return e.dt_from.substr(0,19)}},{field:"rd",caption:"%",size:8,render:function(e){return Math.floor(100*e.rd/(e.sz||1))+"%"}},{field:"dt_to_fact",caption:"Окончание",size:18,render:function(e){return(e.dt_to_fact||"").substr(0,19)}}],url:"/mosgis/_rest/?type=open_data&part=log",onDblClick:null}).refresh(),$("#grid_user_own_options_grid_check_all").hide()})}}),define("app/view/open_data",[],function(){return function(e,t){var i,n=w2ui.admin_layout;n?(n.unlock("main"),i=$(n.el("main"))):(i=$("body"),$("title").text("Реестр адресов OpenData")),i.w2regrid({name:"open_data_grid",show:{toolbar:!0,footer:!0},toolbar:{items:[{type:"menu-radio",id:"specialSearchButton",text:"Поиск ошибок",items:[{id:"DUP",text:"Дублирующиеся GUID ФИАС"},{id:"NO GUID",text:"Пустые GUID ФИАС"}]},{type:"button",id:"printButton",caption:"MS Excel",onClick:function(){this.owner.saveAsXLS()}},{type:"button",id:"maxButton",caption:"Открыть в отдельной вкладке",onClick:function(){openTab("/open_data")},off:!n},{type:"spacer"},{type:"button",id:"historyButton",text:"История обновления",onClick:function(){use.block("open_data_log_popup")}}].filter(not_off),onClick:function(e){/^specialSearchButton:/.test(e.target)&&e.done(function(){this.owner.search("all",e.item.selected)})}},columns:[{field:"id",caption:"UNOM",size:10,editable:{type:"text"}},{field:"fiashouseguid",caption:"GUID ФИАС",size:30,editable:{type:"text"}},{field:"address",caption:"Адрес",size:100,editable:{type:"text"}},{field:"kad_n",caption:"Кадастровый номер",size:20,editable:{type:"text"}},{field:"fn",caption:"Файл",size:5},{field:"line",caption:"Строка",size:5},{field:"is_actual",caption:"Статус",size:15,render:function(e){return e.is_actual?"актуально":"не актуально"}}],url:"/mosgis/_rest/?type=open_data",onDblClick:null}).refresh(),$("#grid_open_data_grid_search_all").focus()}}),define("app/view/org_work_common_log",[],function(){return function(e,t){e=$("body").data("data"),$(w2ui.passport_layout.el("main")).w2regrid({name:"org_work_common_log",show:{toolbar:!0,toolbarInput:!1,footer:!0},columnGroups:[{span:3,caption:"Событие"},{span:3,caption:"Значения полей"},{span:4,caption:"Запрос в ГИС ЖКХ"}],columns:[{field:"ts",caption:"Дата/время",size:30,render:_ts},{field:"action",caption:"Действие",size:30,voc:{create:"Создание",update:"Редактирование",delete:"Удаление",undelete:"Восстановление"}},{field:"vc_users.label",caption:"Оператор",size:30},{field:"label",caption:"Наименование",size:50},{field:"code_vc_nsi_56",caption:"Вид работ",size:20,voc:e.vc_nsi_56},{field:"okei",caption:"Ед. изм.",size:10,render:function(t){return e.vc_okei[t.okei]||t.stringdimensionunit}},{field:"soap.ts",caption:"Отправлено",size:30,render:_ts,attr:"data-ref=1"},{field:"soap.ts_rp",caption:"Обработано",size:30,render:_ts,attr:"data-ref=1"},{field:"soap.id_status",caption:"Статус",size:30,render:function(e,t,i,n){switch(n){case 3:return"Обработано";case 2:return"Ожидает ответа";default:return"Ожидает отправки"}}},{field:"soap.err_text",caption:"Ошибка",size:30}],url:"/mosgis/_rest/?type=org_works&part=log&id="+$_REQUEST.id,onClick:function(e){var t=this.columns[e.column],i=this.get(e.recid);switch(t.field){case"soap.ts":if(i.uuid_out_soap)return openTab("/out_soap_rq/"+i.uuid_out_soap);case"soap.ts_rp":if(i.uuid_message)return openTab("/out_soap_rp/"+i.uuid_message)}}}).refresh()}}),define("app/view/org_work_common",[],function(){var e="org_work_common_form";return function(t,i){$_F5=function(t){t.item.__read_only=t.__read_only;var i=clone(t.item);w2ui[e].record=i,$("div[data-block-name=org_work_common] input").prop({disabled:t.__read_only}),w2ui[e].refresh()};var n=w2ui.topmost_layout,o=$(n.el("main"));o.w2relayout({name:"passport_layout",panels:[{type:"top",size:370},{type:"main",size:400,tabs:{tabs:[{id:"org_work_common_log",caption:"История изменений"}],onClick:$_DO.choose_tab_org_work_common}}],onRender:function(e){this.get("main").tabs.click(t.active_tab)}});var o=$(w2ui.passport_layout.el("top"));fill(i,t.item,o),o.w2reform({name:e,record:t.item,fields:[{name:"workname",type:"text"},{name:"code_vc_nsi_56",type:"list",options:{items:t.vc_nsi_56.items}},{name:"stringdimensionunit",type:"combo",options:{items:t.vc_okei.items}}],focus:-1});var a=1;$("#required_services_container").w2regrid({name:"code_vc_nsi_67_grid",show:{toolbar:!1,footer:!1,columnHeaders:!1,selectColumn:!0},columns:[{field:"label",caption:"Наименование",size:50}],records:dia2w2uiRecords(t.vc_nsi_67.items),onRefresh:function(){if(a){var e=this;$.each(t.item.codes_nsi_67,function(){e.select(""+this)}),a=0,e.onSelect=e.onUnselect=function(e){if($("#workname").prop("disabled"))return e.preventDefault()}}}}).refresh(),$_F5(t)}}),define("app/view/org_work_popup",[],function(){return function(e,t){$(fill(t,e.record)).w2uppop({},function(){$("#w2ui-popup .w2ui-form").w2reform({name:"org_work_form",record:e.record,fields:[{name:"workname",type:"text"},{name:"code_vc_nsi_56",type:"list",options:{items:e.vc_nsi_56.items}},{name:"stringdimensionunit",type:"combo",options:{items:e.vc_okei.items}}]});var t=1;$("#required_services_container").w2regrid({name:"code_vc_nsi_67_grid",show:{toolbar:!1,footer:!1,columnHeaders:!1,selectColumn:!0},columns:[{field:"label",caption:"Наименование",size:50}],records:dia2w2uiRecords(e.vc_nsi_67.items),onRefresh:function(){if(t){var i=this;$.each(e.record.codes_nsi_67,function(){i.select(""+this)}),t=0}}}).refresh()})}}),define("app/view/org_work",[],function(){return function(e,t){$("title").text(e.item.label),fill(t,e.item,$("body")),$("#container").w2layout({name:"topmost_layout",panels:[{type:"main",size:400,tabs:{tabs:[{id:"org_work_common",caption:"Общие"}].filter(not_off),onClick:$_DO.choose_tab_org_work}}],onRender:function(e){clickActiveTab(this.get("main").tabs,"org_work.active_tab")}})}}),define("app/view/org_works",[],function(){function e(e){e.done(function(){var e=w2ui.org_works_grid,t=e.toolbar,i=e.getSelection();1!=i.length||e.get(i[0]).is_deleted?t.disable("edit","delete"):t.enable("edit","delete")})}return function(t,i){t=$("body").data("data"),$(w2ui.vocs_layout.el("main")).w2regrid({name:"org_works_grid",show:{toolbar:!0,toolbarAdd:!$_USER.role.admin,footer:!0},toolbar:{items:[{type:"button",id:"edit",caption:"Изменить",onClick:$_DO.edit_org_works,disabled:!0,off:$_USER.role.admin,icon:"w2ui-icon-pencil"},{type:"button",id:"delete",caption:"Удалить",onClick:$_DO.delete_org_works,disabled:!0,off:$_USER.role.admin,icon:"w2ui-icon-cross"
}].filter(not_off)},searches:[{field:"label_uc",caption:"Наименование",type:"text"},{field:"is_deleted",caption:"Статус записи",type:"enum",options:{items:[{id:"0",text:"Актуальные"},{id:"1",text:"Удалённые"}]}},{field:"id_status",caption:"Статус синхронизации",type:"enum",options:{items:t.vc_async_entity_states.items}},{field:"uuid_org",caption:"Организации",type:"enum",options:{items:t.vc_orgs.items},off:!$_USER.role.admin}].filter(not_off),columns:[{field:"org.label",caption:"Организация",size:100,off:!$_USER.role.admin},{field:"label",caption:"Наименование",size:50},{field:"code_vc_nsi_56",caption:"Вид работ",size:20,voc:t.vc_nsi_56},{field:"okei",caption:"Ед. изм.",size:10,render:function(e){return t.vc_okei[e.okei]||e.stringdimensionunit}},{field:"id_status",caption:"Статус",size:50,render:function(e,i,n,o){var a=t.vc_async_entity_states[o];return 30==o&&(a="<font color=red>"+a+"</font>: ",a+=e.out_soap.err_text),a}}].filter(not_off),url:"/mosgis/_rest/?type=org_works",onAdd:$_DO.create_org_works,onDblClick:function(e){openTab("/org_work/"+e.recid)},onRefresh:function(e){e.done(color_data_mandatory)},onSelect:e,onUnselect:e}).refresh()}}),define("app/view/out_soap_export_nsi_item_err_popup",[],function(){return function(e,t){w2popup.open({title:"Информация об ошибках",width:$("body").width()-20,onOpen:function(t){t.done(function(){$(".w2ui-popup-body").w2regrid({name:"out_soap_export_nsi_item_err_popup_grid",show:{toolbar:!1,footer:!1},url:"/mosgis/_rest/?type=out_soap_export_nsi_item&part=errors&id="+e.dt,columns:[{field:"ts_rp",caption:"Время и дата получения ошибки",size:25,render:function(e){return dt_dmyhms(e.ts_rp)}},{field:"id",caption:"Идентификатор сообщения сервиса АСУ ЕИРЦ",size:45,attr:"data-ref=out_soap_rq"},{field:"uuid_ack",caption:"Идентификатор ответа сервиса ГИС ЖКХ",size:45,attr:"data-ref=out_soap_rp"},{field:"err_code",caption:"Код ошибки",size:15,sortable:!0},{field:"err_text",caption:"Описание ошибки",size:100}],onDblClick:null,onClick:$_DO.open_out_soap_export_nsi_item_err_popup}).refresh()})}})}}),define("app/view/out_soap_export_nsi_item",[],function(){return function(e,t){$(w2ui.out_soap_layout.el("main")).empty().w2regrid({name:"out_soap_export_nsi_item_grid",show:{toolbar:!1,footer:!1},records:e.records,columns:[{field:"id",caption:"Календарный день отправки сообщений",size:30,render:function(e){return dt_dmy(e.id.substr(0,10))}},{field:"cnt",caption:"Количество сообщений, подготовленных к отправке за день",size:100,render:"int"},{field:"cnt_ok",caption:"Количество успешно отправленных сообщений",size:100,render:"int"},{field:"cnt_failed",caption:"Количество сообщений, отправленных с ошибкой",size:100,render:"int",attr:"data-ref=1"}],onDblClick:null,onClick:$_DO.open_err_popup_out_soap_export_nsi_item}).refresh()}}),define("app/view/out_soap_rp",[],function(){return function(e,t){$("title").text($_REQUEST.id),fill(t,e,$("body"))}}),define("app/view/out_soap_rq",[],function(){return function(e,t){$("title").text($_REQUEST.id),fill(t,e,$("body"))}}),define("app/view/out_soap",[],function(){return function(e,t){$("body").data("data",e);var i=w2ui.topmost_layout;i.unlock("main");var n=$(i.el("main")).w2relayout({name:"out_soap_layout",panels:[{type:"top",size:120},{type:"main",size:400,tabs:{tabs:[{id:"out_soap_0",caption:"Реквизиты УО"},{id:"out_soap_export_nsi_item",caption:"Импорт справочника"},{id:"out_soap_2",caption:"Экспорт справочника услуг"},{id:"out_soap_3",caption:"Импорт справочника услуг"},{id:"out_soap_4",caption:"Дома"},{id:"out_soap_5",caption:"Лицевые счета"},{id:"out_soap_6",caption:"Начисления"},{id:"out_soap_7",caption:"Приборы учёта"},{id:"out_soap_8",caption:"Показания ПУ"}],onClick:$_DO.choose_tab_out_soap}}],onRender:function(t){this.get("main").tabs.click(e.active_tab)}}),o=$(n.el("top"));fill(t,e,o),o.w2reform({name:"out_soap_filter_form",record:e.record,fields:[{name:"year",type:"list",options:{items:e.years}},{name:"month",type:"enum",options:{items:e.months}},{name:"is_failed",type:"radio"}],focus:-1}),$("button[name=show]").click($_DO.show_out_soap)}}),define("app/view/passport_multiple_popup",[],function(){function e(){return w2ui.voc_rd_nsi_popup_grid_available}function t(){return w2ui.voc_rd_nsi_popup_grid_set}var i;return $_F5=function(){var n=$_SESSION.get("ids");e().records=i.filter(function(e){return!n[e.recid]}),t().records=i.filter(function(e){return 1==n[e.recid]}),e().refresh(),t().refresh()},function(n,o){i=n.voc.items,$(o).w2uppop({title:n.def.label},function(){function i(){var t=$_SESSION.get("ids");t[e().getSelection()[0]]=1,$_SESSION.set("ids",t),sessionStorage.setItem("is_dirty",1),$_F5()}function o(){var e=$_SESSION.get("ids");delete e[t().getSelection()[0]],$_SESSION.set("ids",e),sessionStorage.setItem("is_dirty",1),$_F5()}$("#w2ui-popup .w2ui-form").w2reform({name:"passport_multiple_popup_form",record:n.record,fields:[]}),clickOn($("#w2ui-popup button[name=update]"),$_DO.update_passport_multiple_popup),clickOn($("#w2ui-popup button[name=close]"),$_DO.close_passport_multiple_popup),$("button[name=add]").click(i),$("button[name=del]").click(o),$("button[name=add_all]").click(function(){var t=$_SESSION.get("ids");$.each(e().records,function(){t[this.recid]=1}),$_SESSION.set("ids",t),sessionStorage.setItem("is_dirty",1),$_F5()}),$("button[name=del_all]").click(function(){$_SESSION.set("ids",{}),sessionStorage.setItem("is_dirty",1),$_F5()}),$("#grid_set").w2regrid({name:"voc_rd_nsi_popup_grid_set",show:{toolbar:!1,footer:!1,columnHeaders:!1},columns:[{field:"label",caption:"Наименование",size:100}],records:[],onSelect:function(e){$("button[name=del]").prop("disabled",!1)},onUnselect:function(e){$("button[name=del]").prop("disabled",!0)},onDblClick:o}).refresh(),$("#grid_available").w2regrid({name:"voc_rd_nsi_popup_grid_available",show:{toolbar:!1,footer:!1,columnHeaders:!1},columns:[{field:"label",caption:"Наименование",size:100}],records:[],onSelect:function(e){$("button[name=add]").prop("disabled",!1)},onUnselect:function(e){$("button[name=add]").prop("disabled",!0)},onDblClick:i}).refresh(),$_F5()})}}),define("app/view/premise_nonresidental_common",[],function(){var e="premise_nonresidental_common_form";return function(t,i){$_F5=function(t){t.item.__read_only=t.__read_only;var i=clone(t.item);/-/.test(i.terminationdate)&&(i.terminationdate=dt_dmy(i.terminationdate.substr(0,10))),w2ui[e].record=i,$("div[data-block-name=premise_nonresidental_common] input").prop({disabled:t.__read_only}),w2ui[e].refresh()};var n=w2ui.topmost_layout,o=$(n.el("main"));t.item.annulmentreason_label=t.vc_nsi_330[t.item.annulmentreason],o.w2relayout({name:"passport_layout",panels:[{type:"top",size:230},{type:"main",size:400,tabs:{tabs:[],onClick:$_DO.choose_tab_premise_nonresidental_common}}],onRender:function(e){this.get("main").tabs.click(t.active_tab)}});var o=$(w2ui.passport_layout.el("top"));fill(i,t.item,o),o.w2reform({name:e,record:t.item,fields:[{name:"premisesnum",type:"text"},{name:"cadastralnumber",type:"text"},{name:"iscommonproperty",type:"list",options:{items:[{id:"0",text:"Нет"},{id:"1",text:"Да"}]}},{name:"totalarea",type:"float",options:{min:0}},{name:"terminationdate",type:"date",options:{max:new Date}}].filter(not_off),focus:-1}),$_F5(t)}}),define("app/view/premise_nonresidental_passport",[],function(){function e(){return $("body").data("data")}var t="premise_nonresidental_passport_grid",i={};return function(n,o){$.each(n.vc_pass_fields,function(){i[this.id]=this}),$_F5=function(){var i=w2ui[t],n=e(),o=n.doc_fields;i.records=n.vc_pass_fields.filter(function(e){return 3!=e.id_type}),$.each(i.records,function(){this.w2ui&&delete this.w2ui.changes,this.is_doc=o[this.id],delete this.value}),i.refresh()};var a=w2ui.topmost_layout;$(a.el("main")).w2regrid({name:t,show:{toolbar:!0,footer:1,toolbarReload:!1,toolbarColumns:!1},textSearch:"contains",columns:[{field:"label",caption:"Реквизит",size:100},{field:"value",caption:"Значение",size:20,attr:"data-status",editable:function(t){switch(t.id_type){case 0:return{type:"int"};case 1:return{type:"float",precision:4,autoFormat:!0,keyboard:!1,min:0};case 2:return{type:"text"};case 4:return{type:"list",items:[{id:0,text:"Нет"},{id:1,text:"Да"}]};case 6:var t=e()["vc_nsi_"+t.voc];return t?{type:"list",items:t.items}:null;case 7:return{type:"int",min:1600,max:2215,autoFormat:!1};case 8:return{type:"date"};default:return null}},render:function(t){var i=e().item[t.name];if(t.is_multiple)switch(t.id_type){case 6:var n=e(),o=n["tb_premises_nrs_f_"+t.id],a="";return $.each(n["vc_nsi_"+t.voc].items,function(){o[this.id]&&(a&&(a+=", "),a+=this.label)}),a;default:return""}else switch(t.id_type){case 4:return 1==i?"Да":"Нет";case 1:return null==i?"":w2utils.formatNumber(i);case 6:var t=e()["vc_nsi_"+t.voc];return t?t[i]:"";case 8:return i?dt_dmy(i.substr(0,10)):"";default:return i}}},{field:"unit",caption:"Ед. изм.",size:5}],records:[],onDblClick:null,onEditField:function(t){var o=this,a=o.get(t.recid);if(a.is_doc)return alert('Добавление подтверждающих документов осуществляется на вкладке "Документы"'),t.preventDefault();if(a.is_multiple){var r=e(),s={def:a,voc:r["vc_nsi_"+a.voc],ids:r["tb_premises_nrs_f_"+a.id]};return $_SESSION.set("field",s),use.block("passport_multiple_popup"),t.preventDefault()}var d=o.columns[t.column],c=d.editable(a),u=e().item["f_"+t.recid];if(4==a.id_type&&1==u){var r=n.depends;for(var l in r)if(r[l]==a.id){var _=i[l];if(_.id_dt&&e().item["f_"+_.id_dt])return alert("Первоначально необходимо удалить "+_.label.toLowerCase()+' на вкладке "Документы"'),t.preventDefault()}}"date"==c.type?t.value=u?new Date(u):new Date:t.value=u},onChange:$_DO.patch_premise_nonresidental_passport,onRefresh:color_passport_grid}),$_F5()}}),define("app/view/premise_nonresidental_popup",[],function(){return function(e,t){var i=e.item;i.usedyear;$(t).w2uppop({},function(){$("#w2ui-popup .w2ui-form").w2reform({name:"premise_nonresidental_new_form",record:e.record,fields:[{name:"premisesnum",type:"text"},{name:"cadastralnumber",type:"text"},{name:"iscommonproperty",type:"list",options:{items:[{id:"0",text:"Нет"},{id:"1",text:"Да"}]}},{name:"totalarea",type:"float",options:{min:0}},{name:"f_20003",type:"list",options:{items:e.vc_nsi_17.items}},{name:"f_20054",type:"list",options:{items:e.vc_nsi_254.items}},{name:"f_20053",type:"list",options:{items:e.vc_nsi_253.items}},{name:"f_20056",type:"list",options:{items:e.vc_nsi_261.items}}],onRefresh:function(e){var t=w2ui[e.target],i=t.record,n=t.fields.filter(function(e){return"enum"==e.type});n.length&&$.each(n,function(){var e=this.name,t=i[e];Array.isArray(t)&&t.length&&"object"!=typeof t[0]&&(i[e]=this.options.items.filter(function(e){return t.includes(e.id)}))})}})})}}),define("app/view/premise_nonresidental",[],function(){return function(e,t){$("title").text(e.item.label+", "+e.item.address),fill(t,e,$("body")),$("#container").w2layout({name:"topmost_layout",panels:[{type:"main",size:400,tabs:{tabs:[{id:"premise_nonresidental_common",caption:"Общие"},{id:"premise_nonresidental_passport",caption:"Паспорт"}].filter(not_off),onClick:$_DO.choose_tab_premise_nonresidental}}],onRender:function(t){this.get("main").tabs.click(e.active_tab)}})}}),define("app/view/premise_residental_common_living_rooms",[],function(){return function(e,t){var i=clone($("body").data("data")),n=i.item;n.usedyear||(n.usedyear=1600),$(w2ui.premise_residental_layout.el("main")).w2regrid({name:"premise_residental_common_living_rooms_grid",selectType:"cell",multiSelect:!1,show:{toolbar:!0,footer:!0,toolbarAdd:!0,toolbarDelete:!0,toolbarInput:!1,toolbarSearch:!0,toolbarReload:!1},columnGroups:[{master:!0},{master:!0},{master:!0},{master:!0},{master:!0},{span:3,caption:"Непригодность"},{master:!0}],searches:[{field:"is_annuled",caption:"Актуальность",type:"enum",options:{items:[{id:0,text:"Актуальные"},{id:1,text:"Аннулированные"}]}}],last:{logic:"AND"},searchData:[{field:"is_annuled",operator:"in",type:"enum",value:[{id:0,text:"Актуальные"}]}],columns:[{field:"roomnumber",caption:"№",tooltip:"№ комнаты",size:7},{field:"cadastralnumber",caption:"Кадастровый №",tooltip:"Кадастровый #",size:10,editable:{type:"text"}},{field:"square",attr:"data-mandatory",caption:"Площадь, м²",tooltip:"Общая площадь",size:5,editable:{type:"float",min:0}},{field:"f_20130",attr:"data-living",caption:"К-во проживающих",tooltip:"Количество проживающих",size:5,editable:{type:"int"}},{field:"f_20056",caption:"Э/оборудование",tooltip:"Наличие электрооборудования",size:7,voc:i.vc_nsi_261,hidden:!0},{field:"f_20132",caption:"Основание",size:10,voc:i.vc_nsi_273,hidden:!0},{field:"f_20133",caption:"Дата",render:_dt,size:10,hidden:!0},{field:"f_20134",caption:"№ док.",size:10,hidden:!0},{field:"terminationdate",caption:"Дата аннулирования",render:_dt,size:20,hidden:!0}],postData:{data:{uuid_premise:$_REQUEST.id}},url:"/mosgis/_rest/?type=living_rooms",onDblClick:function(e){this.columns[e.column].editable||openTab("/living_room/"+e.recid)},onAdd:$_DO.create_premise_residental_common_living_rooms,onDelete:$_DO.delete_premise_residental_common_living_rooms,onChange:$_DO.patch_premise_residental_common_living_rooms,onEditField:function(e){var t=this,i=t.get(e.recid);if(i.is_annuled)return e.preventDefault();var n=t.columns[e.column];if(/data-living/.test(n.attr)&&1==i.is_nrs)return e.preventDefault();var o=n.editable,a=i[n.field];"date"==o.type?e.value=a?new Date(a.substr(0,10)):new Date:e.value=a},onRefresh:function(e){var t=this;e.done(function(){$("tr[recid] td[data-mandatory]").each(function(){var e=$(this);if(!(e.text()||"Н"==e.closest("tr").text().charAt(0)&&e.is("[data-living]"))){var t={title:"Обязательное поле"};e.css({background:"#ffcccc"}).prop(t),$("*",e).prop(t)}}),$("tr[recid]").each(function(){var e=$(this);t.get(e.attr("recid")).is_annuled&&$("td",e).css({background:"#ccc"})})})}}).refresh()}}),define("app/view/premise_residental_common",[],function(){var e="premise_residental_common_form";return function(t,i){var n=t.tb_entrances.items;n.unshift({id:"",text:"Отдельный вход"}),$_F5=function(t){t.item.__read_only=t.__read_only;var i=clone(t.item);/-/.test(i.terminationdate)&&(i.terminationdate=dt_dmy(i.terminationdate.substr(0,10))),w2ui[e].record=i,$("div[data-block-name=premise_residental_common] input").prop({disabled:t.__read_only}),w2ui[e].refresh()};var o=w2ui.topmost_layout,a=$(o.el("main"));a.w2relayout({name:"premise_residental_layout",panels:[{type:"top",size:290},{type:"main",size:400,tabs:{tabs:[{id:"premise_residental_common_living_rooms",caption:"Комнаты",off:"2"!=t.item.code_vc_nsi_30}].filter(not_off),onClick:$_DO.choose_tab_premise_residental_common}}],onRender:function(e){this.get("main").tabs.click(t.active_tab)}});var a=$(w2ui.premise_residental_layout.el("top"));t.item.annulmentreason_label=t.vc_nsi_330[t.item.annulmentreason],fill(i,t.item,a),a.w2reform({name:e,record:t.item,fields:[{name:"uuid_entrance",type:"list",options:{items:n}},{name:"premisesnum",type:"text"},{name:"cadastralnumber",type:"text"},{name:"code_vc_nsi_30",type:"list",options:{items:t.vc_nsi_30.items}},{name:"totalarea",type:"float",options:{min:0}},{name:"grossarea",type:"float",options:{min:0}},{name:"terminationdate",type:"date",options:{max:new Date}}].filter(not_off),focus:-1}),$_F5(t)}}),define("app/view/premise_residental_invalid",[],function(){var e="premise_residental_invalid_form";return function(t,i){$_F5=function(t){var i=clone(t.item);/-/.test(i.f_20128)&&(i.f_20128=dt_dmy(i.f_20128.substr(0,10))),i.__read_only=t.__read_only,w2ui[e].record=i,$("div[data-block-name=premise_residental_invalid] input").prop({disabled:i.__read_only}),w2ui[e].refresh()};var n=w2ui.topmost_layout,o=$(n.el("main"));o.w2relayout({name:"passport_layout",panels:[{type:"top",size:200},{type:"main",size:400,tabs:{tabs:[],onClick:$_DO.choose_tab_premise_residental_invalid}}],onRender:function(e){this.get("main").tabs.click(t.active_tab)}});var o=$(w2ui.passport_layout.el("top"));fill(i,t.item,o),o.w2reform({name:e,record:t.item,fields:[{name:"f_20127",type:"list",options:{items:t.vc_nsi_273.items}},{name:"f_20128",type:"date",options:{max:new Date}},{name:"f_20129",type:"text"},{name:"file",type:"file",options:{max:1}}].filter(not_off),focus:-1,onRefresh:function(e){e.done(function(){var e=$("body").data("data").file;this.record.__read_only?($("#file_input_div").hide(),e?($("#file_label").text(e.label),clickOn($("#file_label"),$_DO.download_premise_residental_invalid)):$("#file_link_div").hide()):$("#file_input_div").show()})}}),$_F5(t)}}),define("app/view/premise_residental_passport",[],function(){function e(){return $("body").data("data")}var t="premise_residental_passport_grid",i={};return function(n,o){$.each(n.vc_pass_fields,function(){i[this.id]=this}),$_F5=function(){var i=w2ui[t],n=e(),o=n.doc_fields;i.records=n.vc_pass_fields.filter(function(e){return 3!=e.id_type}),$.each(i.records,function(){this.w2ui&&delete this.w2ui.changes,this.is_doc=o[this.id],delete this.value}),i.refresh()};var a=w2ui.topmost_layout;$(a.el("main")).w2regrid({name:t,show:{toolbar:!0,footer:1,toolbarReload:!1,toolbarColumns:!1},textSearch:"contains",columns:[{field:"label",caption:"Реквизит",size:100},{field:"value",caption:"Значение",size:20,attr:"data-status",editable:function(t){switch(t.id_type){case 0:return{type:"int"};case 1:return{type:"float",precision:4,autoFormat:!0,keyboard:!1,min:0};case 2:return{type:"text"};case 4:return{type:"list",items:[{id:0,text:"Нет"},{id:1,text:"Да"}]};case 6:var t=e()["vc_nsi_"+t.voc];return t?{type:"list",items:t.items}:null;case 7:return{type:"int",min:1600,max:2215,autoFormat:!1};case 8:return{type:"date"};default:return null}},render:function(t){var i=e().item[t.name];if(t.is_multiple)switch(t.id_type){case 6:var n=e(),o=n["tb_premises_res_f_"+t.id],a="";return $.each(n["vc_nsi_"+t.voc].items,function(){o[this.id]&&(a&&(a+=", "),a+=this.label)}),a;default:return""}else switch(t.id_type){case 4:return 1==i?"Да":"Нет";case 1:return null==i?"":w2utils.formatNumber(i);case 6:var t=e()["vc_nsi_"+t.voc];return t?t[i]:"";case 8:return i?dt_dmy(i.substr(0,10)):"";default:return i}}},{field:"unit",caption:"Ед. изм.",size:5}],records:[],onDblClick:null,onEditField:function(t){var o=this,a=o.get(t.recid);if(a.is_doc)return alert('Добавление подтверждающих документов осуществляется на вкладке "Документы"'),t.preventDefault();if(a.is_multiple){var r=e(),s={def:a,voc:r["vc_nsi_"+a.voc],ids:r["tb_premises_res_f_"+a.id]};return $_SESSION.set("field",s),use.block("passport_multiple_popup"),t.preventDefault()}var d=o.columns[t.column],c=d.editable(a),u=e().item["f_"+t.recid];if(4==a.id_type&&1==u){var r=n.depends;for(var l in r)if(r[l]==a.id){var _=i[l];if(_.id_dt&&e().item["f_"+_.id_dt])return alert("Первоначально необходимо удалить "+_.label.toLowerCase()+' на вкладке "Документы"'),t.preventDefault()}}"date"==c.type?t.value=u?new Date(u):new Date:t.value=u},onChange:$_DO.patch_premise_residental_passport,onRefresh:color_passport_grid}),$_F5()}}),define("app/view/premise_residental_popup",[],function(){return function(e,t){var i=e.item,n=e.entrances.items;n.unshift({id:"",text:"Отдельный вход"});i.usedyear;$(t).w2uppop({},function(){$("#w2ui-popup .w2ui-form").w2reform({name:"premise_residental_new_form",record:e.record,fields:[{name:"uuid_entrance",type:"list",options:{items:n}},{name:"premisesnum",type:"text"},{name:"cadastralnumber",type:"text"},{name:"code_vc_nsi_30",type:"list",options:{items:e.vc_nsi_30.items.map(function(e){return{id:e.id,text:e.text.replace("Квартира коммунального заселения","Коммунальн. квартира")}})}},{name:"totalarea",type:"float",options:{min:0}},{name:"grossarea",type:"float",options:{min:0}},{name:"f_20002",type:"list",options:{items:e.vc_nsi_14.items}},{name:"f_20125",type:"int",options:{min:0}},{name:"f_20061",type:"list",options:{items:e.vc_nsi_259.items}},{name:"f_20059",type:"list",options:{items:e.vc_nsi_258.items}},{name:"f_20054",type:"list",options:{items:e.vc_nsi_254.items}},{name:"f_20053",type:"list",options:{items:e.vc_nsi_253.items}},{name:"f_20056",type:"list",options:{items:e.vc_nsi_261.items}}],onRefresh:function(e){var t=w2ui[e.target],i=t.record,n=t.fields.filter(function(e){return"enum"==e.type});n.length&&$.each(n,function(){var e=this.name,t=i[e];Array.isArray(t)&&t.length&&"object"!=typeof t[0]&&(i[e]=this.options.items.filter(function(e){return t.includes(e.id)}))})}})})}}),define("app/view/premise_residental",[],function(){return function(e,t){$("title").text(e.item.label+", "+e.item.address),fill(t,e,$("body")),$("#container").w2layout({name:"topmost_layout",panels:[{type:"main",size:400,tabs:{tabs:[{id:"premise_residental_common",caption:"Общие"},{id:"premise_residental_passport",caption:"Паспорт"},{id:"premise_residental_invalid",caption:"Непригодность для проживания",hidden:1!=e.item.f_20126}].filter(not_off),onClick:$_DO.choose_tab_premise_residental}}],onRender:function(e){clickActiveTab(this.get("main").tabs,"premise_residental.active_tab")}})}}),define("app/view/rosters",[],function(){return function(e,t){var i=w2ui.topmost_layout;i.unlock("main"),$(i.el("main")).w2relayout({name:"rosters_layout",panels:[{type:"main",size:400,tabs:{tabs:[{id:"houses",caption:"Жилой фонд"},{id:"contracts",caption:"Договоры",off:!($_USER.role.admin||$_USER.role.nsi_20_1||$_USER.role.nsi_20_4)},{id:"voc_organizations",caption:"Организации"},{id:"voc_users",caption:"Учётные записи",off:!$_USER.role.admin}].filter(not_off),onClick:$_DO.choose_tab_rosters}}],onRender:function(t){this.get("main").tabs.click(e.active_tab)}})}}),define("app/view/user_password",[],function(){return function(e,t){$(t).w2popup("open",{width:250,height:195,title:"Смена пароля",onOpen:function(e){e.done(function(){$("#w2ui-popup .w2ui-form").w2reform({name:"passwordForm",record:{},fields:[{name:"p1",type:"password"},{name:"p2",type:"password"}]}),clickOn($(".w2ui-buttons button[name=update]"),$_DO.update_user_password)})}})}}),define("app/view/vc_rd_1",[],function(){return function(e,t){var i,n=w2ui.admin_layout;n?(n.unlock("main"),i=$(n.el("main"))):(i=$("body"),$("title").text("Реестр объектов ГИС РД")),i.w2regrid({name:"vc_rd_1_grid",show:{toolbar:!0,footer:!0},toolbar:{items:[{type:"button",id:"printButton",caption:"MS Excel",onClick:function(){this.owner.saveAsXLS()}},{type:"button",id:"maxButton",caption:"Открыть в отдельной вкладке",onClick:function(){openTab("/vc_rd_1")},off:!n}].filter(not_off)},searches:[{field:"id",caption:"objId",type:"int"},{field:"unom",caption:"UNOM",type:"int"},{field:"address_uc",caption:"Адрес",type:"text"},{field:"id_vc_rd_1240",caption:"Тип",type:"enum",options:{items:e.vc_rd_1240.items}},{field:"id_vc_rd_1540",caption:"Статус",type:"enum",options:{items:e.vc_rd_1540.items}}],columns:[{field:"id",caption:"objId",size:10,editable:{type:"text"}},{field:"unom",caption:"UNOM",size:10,editable:{type:"text"}},{field:"address",caption:"Адрес",size:100,editable:{type:"text"}},{field:"id_vc_rd_1240",caption:"Тип",size:20,render:function(t){return e.vc_rd_1240[t.id_vc_rd_1240]}},{field:"id_vc_rd_1540",caption:"Статус",size:20,render:function(t){return e.vc_rd_1540[t.id_vc_rd_1540]}},{field:"ts_get_object",caption:"Дата загрузки",size:30,render:function(e){return e.ts_get_object.substring(0,19)}}],url:"/mosgis/_rest/?type=vc_rd_1",onDblClick:null}).refresh(),$("#grid_vc_rd_1_grid_search_all").focus()}}),define("app/view/voc_nsi_list",[],function(){return function(e,t){var i=w2ui.topmost_layout;i.unlock("main");var n=$(i.el("main")).w2relayout({name:"vocs_layout",panels:[{type:"left",size:300,resizable:!0},{type:"main",size:400}]});$(n.el("left")).empty().w2residebar({name:"sidebar",nodes:e.vc_nsi_list_group,onClick:$_DO.open_nsi_list})}}),define("app/view/voc_nsi",[],function(){var e={Enum:function(e){var t="f_"+e.name.toLowerCase();return{field:t,caption:e.remark,size:50,sortable:!0,render:function(e){return e[t].split("|").sort().join(", ")}}},Date:function(e){var t="f_"+e.name.toLowerCase();return{field:t,caption:e.remark,size:16,sortable:!0,render:function(e){return dt_dmy(e[t].substr(0,10))}}},String:function(e){return{field:"f_"+e.name.toLowerCase(),caption:e.remark,size:50,sortable:!0}},Boolean:function(e){var t="f_"+e.name.toLowerCase();return{field:t,caption:e.remark,size:5,sortable:!0,render:function(e){var i=e[t];return null==i?"":1==i?"Да":"Нет"}}},OkeiRef:function(e){var t="f_"+e.name.toLowerCase();return{field:t,caption:e.remark,sortable:!0,size:10,render:function(e){var i=e[t];return null==i?"":$("body").data("data").vc_okei[i]}}},NsiRef:function(e){var t="f_"+e.name.toLowerCase();return{field:t,caption:e.remark,sortable:!0,size:100,render:function(i){var n=i[t];if(!n)return"";var o=$("body").data("data")["vc_nsi_"+e.ref];return o?e.mul?n.map(function(e){return o[e]}).join(", "):o[n]:"[не загружен справочник]"}}},NsiListRef:function(e){var t="F_"+e.name;return{field:t,caption:e.remark,sortable:!0,size:100,render:function(e){var i=e[t];return i?$("body").data("vc_nsi_list")[i]||i:""}}}};return function(t,i){var n=w2ui.vocs_layout;n||$("title").text(t.item.name);var o=n?$(w2ui.vocs_layout.el("main")):$("body"),a=o.empty().w2relayout({name:"voc_layout",panels:[{type:"top",size:30,content:"foo"},{type:"main",size:400}]});fill(i,t,$(a.el("top")));var r=[{field:"code",caption:"Код",size:5,sortable:!0},{field:"id",caption:"ID",size:30,sortable:!0}];t.item.cols&&t.item.cols.length&&$.each(t.item.cols,function(){var t=e[this.type]||e.String;r.push(t(this))}),$(a.el("main")).w2regrid({name:"nsi_grid_"+t.item.registrynumber,reorderColumns:!0,toolbar:{items:[{type:"button",caption:"Импорт справочника из ГИС ЖКХ...",onClick:$_DO.import_voc_nsi},{type:"button",id:"printButton",caption:"MS Excel",onClick:function(){this.owner.saveAsXLS()}}]},show:{toolbar:!0,footer:!0},url:"/mosgis/_rest/?type=voc_nsi_list&part=lines&id="+t.id,columns:r,onRender:$_DO.check_status_voc_nsi,onDblClick:null}).refresh()}}),define("app/view/voc_organization_individual",[],function(){return function(e,t){$("title").text(e.item.label),e.item.vc_nsi_20=e.vc_orgs_nsi_20.map(function(t){return e.vc_nsi_20[t.code]}).sort().join(",<br>"),fill(t,e.item,$("body"))}}),define("app/view/voc_organization_legal_users",[],function(){return function(e,t){$("body").data("data"),$(w2ui.topmost_layout.el("main")).w2regrid({name:"voc_organizations_grid",show:{toolbar:!0,toolbarAdd:!0,toolbarEdit:!0,toolbarDelete:!0,footer:!0},columns:[{field:"label",caption:"ФИО",size:100},{field:"login",caption:"login",size:100}],postData:{data:{uuid_org:$_REQUEST.id}},url:"/mosgis/_rest/?type=voc_users",onAdd:$_DO.create_voc_organization_legal_users,onEdit:$_DO.edit_voc_organization_legal_users,onDblClick:$_DO.edit_voc_organization_legal_users,onDelete:$_DO.delete_voc_organization_legal_users}).refresh()}}),define("app/view/voc_organization_legal",[],function(){return function(e,t){e.item.vc_nsi_20=e.vc_orgs_nsi_20.map(function(t){return e.vc_nsi_20[t.code]}).sort().join(",<br>"),e.item.vc_organization_types_label=e.item["vc_organization_types.label"],$("title").text(e.item.label),fill(t,e.item,$("body")),$("#container").w2layout({name:"topmost_layout",panels:[{type:"main",size:300,tabs:{tabs:[{id:"voc_organization_legal_users",caption:"Учётные записи",off:!$_USER.role.admin&&$_USER.uuid_org!=$_REQUEST.id}].filter(not_off),onClick:$_DO.choose_tab_voc_organization_legal}}],onRender:function(e){clickActiveTab(this.get("main").tabs,"voc_organization_legal.active_tab")}})}}),define("app/view/voc_organizations_popup",[],function(){return function(e,t){var i=$("body").data("voc_organizations_popup.callback");$(t).w2uppop({onClose:function(){i($_SESSION.delete("voc_organizations_popup.data"))}},function(){$("#w2ui-popup .container").w2relayout({name:"rosters_layout",panels:[{type:"main",size:400}],onRender:function(e){$_SESSION.set("voc_organizations_popup.on",1),use.block("voc_organizations")}})})}}),define("app/view/voc_organizations",[],function(){return function(e,t){var i=$_SESSION.delete("voc_organizations_popup.on");e=$("body").data("data"),$(w2ui.rosters_layout.el("main")).w2regrid({name:"voc_organizations_grid",show:{toolbar:!0,footer:!0},searches:[{field:"ogrn",caption:"ОГРН(ИП)",type:"text",operator:"is",operators:["is"]},{field:"label_uc",caption:"Наименование / ФИО",type:"text"},{field:"inn",caption:"ИНН",type:"text",operator:"is",operators:["is"]},{field:"kpp",caption:"КПП",type:"text",operator:"is",operators:["is"]},{field:"code_vc_nsi_20",caption:"Полномочия",type:"enum",options:{items:e.vc_nsi_20.items}},{field:"id_type",caption:"Типы",type:"enum",options:{items:e.vc_organization_types.items}}],columns:[{field:"ogrn",caption:"ОГРН(ИП)",size:20},{field:"label",caption:"Наименование (ФИО)",size:100},{field:"inn",caption:"ИНН",size:15},{field:"kpp",caption:"КПП",size:10}],url:"/mosgis/_rest/?type=voc_organizations",onDblClick:function(e){function t(e){openTab("/voc_organization_"+e+"/"+n.uuid)}var n=this.get(e.recid);if(i)$_SESSION.set("voc_organizations_popup.data",clone(n)),w2popup.close();else switch(String(n.ogrn).length){case 13:return t("legal");case 15:return t("individual")}},onRefresh:function(e){e.done(function(){this.searchData.length>0&&0==this.records.length&&($_SESSION.delete("importing")?w2alert("Запрос в ГИС ЖКХ не дал результатов. Вероятно, Вы опечатались, вводя ОГРН[ИП]"):$_SESSION.delete("first_post")?$_DO.check_voc_organizations(e):$_SESSION.set("first_post",1)),$(".w2ui-search-all").attr({style:"width: 450px !important",placeholder:"Введите полный ОГРН[ИП], ИНН или подстроку наименования/ФИО для поиска",title:"Указав ИНН или ОГРН, Вы можете добавить через пробел КПП.\n\nДостаточно первых двух цифр, например: 7711122233 77"}),$(".w2ui-toolbar-search").attr({style:"width: 450px !important"})})}}).refresh()}}),define("app/view/voc_rd_nsi_popup",[],function(){function e(){return $("body").data("data").id}function t(){return w2ui["rd_cols_grid_"+e()]}function i(){return w2ui.voc_rd_nsi_popup_grid_available}function n(){return w2ui.voc_rd_nsi_popup_grid_set}var o;return $_F5=function(){var e=$_SESSION.get("ids");i().records=o.filter(function(t){return!e[t.recid]}),n().records=o.filter(function(t){return 1==e[t.recid]}),i().refresh(),n().refresh()},function(e,a){o=[],$(a).w2uppop({},function(){function a(){var e=$_SESSION.get("ids");e[i().getSelection()[0]]=1,$_SESSION.set("ids",e),sessionStorage.setItem("is_dirty",1),$_F5()}function r(){var e=$_SESSION.get("ids");delete e[n().getSelection()[0]],$_SESSION.set("ids",e),sessionStorage.setItem("is_dirty",1),$_F5()}$("#w2ui-popup .w2ui-form").w2reform({name:"voc_rd_nsi_popup_form",record:e.record,fields:[{name:"registrynumber",type:"list",options:{items:e.vc_nsi_list.items}},{name:"code",type:"list",options:{items:e.nsi_voc.items}}],onChange:function(e){if(sessionStorage.getItem("is_dirty")){if(!confirm("Внесённые изменения не сохранены в БД. Продолжить без сохранения?"))return e.preventDefault();sessionStorage.removeItem("is_dirty")}var i=e.value_new.id;e.done(function(){o=[],$.each(t().records,function(){this.nsi_code&&this.nsi_code!=i||o.push({recid:this.recid,name:this.name})});var e={};i&&($.each(t().records,function(){this.nsi_code==i&&(e[this.recid]=1)}),$_SESSION.set("ids",e)),$_F5()})}}),clickOn($("#w2ui-popup button[name=update]"),$_DO.update_voc_rd_nsi_popup),clickOn($("#w2ui-popup button[name=close]"),$_DO.close_voc_rd_nsi_popup),$("button[name=add]").click(a),$("button[name=del]").click(r),$("button[name=add_all]").click(function(){var e=$_SESSION.get("ids");$.each(i().records,function(){e[this.recid]=1}),$_SESSION.set("ids",e),sessionStorage.setItem("is_dirty",1),$_F5()}),$("button[name=del_all]").click(function(){$_SESSION.set("ids",{}),sessionStorage.setItem("is_dirty",1),$_F5()}),$("#grid_set").w2regrid({name:"voc_rd_nsi_popup_grid_set",show:{toolbar:!1,footer:!1,columnHeaders:!1},columns:[{field:"name",caption:"Наименование",size:100}],records:[],onSelect:function(e){$("button[name=del]").prop("disabled",!1)},onUnselect:function(e){
$("button[name=del]").prop("disabled",!0)},onDblClick:r}).refresh(),$("#grid_available").w2regrid({name:"voc_rd_nsi_popup_grid_available",show:{toolbar:!1,footer:!1,columnHeaders:!1},columns:[{field:"name",caption:"Наименование",size:100}],records:[],onSelect:function(e){$("button[name=add]").prop("disabled",!1)},onUnselect:function(e){$("button[name=add]").prop("disabled",!0)},onDblClick:a}).refresh(),$_F5()})}}),define("app/view/voc_rd_voc",[],function(){return function(e,t){var i=$(w2ui.vocs_layout.el("main")).empty().w2relayout({name:"voc_layout",panels:[{type:"top",size:30,content:"foo"},{type:"main",size:400}]});fill(t,e,$(i.el("top"))),$(i.el("main")).w2regrid({name:"rd_cols_grid_"+e.id,reorderColumns:!0,toolbar:{items:[{type:"button",caption:"Импорт справочника из ГИС РД...",onClick:$_DO.import_voc_rd_voc},{type:"button",caption:"Синхронизация справочников",onClick:$_DO.open_popup_voc_rd_voc,off:e.item.code_vc_nsi_197&&!e.nsi}].filter(not_off)},show:{toolbar:!0,footer:!0,toolbarInput:!1},url:"/mosgis/_rest/?type=voc_rd_voc&part=lines&id="+e.id,columns:[{field:"id",caption:"ID",size:10},{field:"name",caption:"Наименование",size:100},{field:"nsi",caption:"Значение справочника ГИС ЖКХ",size:100,render:function(t){return e.nsi?e.nsi[t.nsi_code]:""}}],onDblClick:null}).refresh()}}),define("app/view/voc_rd",[],function(){return function(e,t){var i=$(w2ui.vocs_layout.el("main")).empty().w2relayout({name:"voc_layout",panels:[{type:"top",size:30,content:"foo"},{type:"main",size:400}]});fill(t,e,$(i.el("top"))),$(i.el("main")).w2regrid({name:"rd_cols_grid_"+e.id,reorderColumns:!0,toolbar:{items:[{type:"button",caption:"Импорт справочника из ГИС РД...",onClick:$_DO.import_voc_rd},{type:"button",caption:"Синхронизация наборов полей",onClick:function(e){this.show("w2ui-save"),$(".w2ui-grid-records tr").toggleClass("status_warning",!0)}}]},show:{toolbar:!0,footer:!0,toolbarInput:!1,toolbarSave:!0},url:"/mosgis/_rest/?type=voc_rd_list&part=lines&id="+e.id,columns:[{field:"id",caption:"ID",size:10},{field:"name",caption:"Наименование",size:100},{field:"vc_rd_col_types.label",caption:"Тип",size:30},{field:"code_vc_nsi_197",caption:"Показатели справочника ГИС ЖКХ",tooltip:"Показатели справочника ГИС ЖКХ",size:150,attr:"data-status",render:function(t){var i;return t.w2ui&&t.w2ui.changes&&(i=t.w2ui.changes.code_vc_nsi_197),i&&i.id&&(i=i.id),i||(i=t.code_vc_nsi_197),e.vc_nsi_197[i]},editable:function(){var t={};return $.each(this.records,function(){var e=this.code_vc_nsi_197;e&&(t[e]=1)}),$.each(this.getChanges(),function(){var e=this.code_vc_nsi_197.id;e&&(t[e]=1)}),{type:"list",items:e.vc_nsi_197.items.filter(function(e){return!t[e.id]}),match:"contains"}}}],onEditField:function(e){return this.toolbar.get("w2ui-save").hidden?e.preventDefault():this.get(e.recid).cnt_nsi_codes?(alert("Для этого поля выполнено сопоставление справочников. Если действительно необходимо назначить другое поле, то предварительно следует зайти в соответствующий справочник и убрать все сопоставления там"),e.preventDefault()):void 0},onSave:$_DO.update_voc_rd,onDblClick:null,onChange:$_DO.check_voc_rd,onRefresh:function(){this.toolbar.hide("w2ui-save")}}).refresh()}}),define("app/view/voc_user_popup",[],function(){return function(e,t){$(fill(t,e.record)).w2uppop({},function(){$("#w2ui-popup .w2ui-form").w2reform({name:"voc_user_form",record:e.record,fields:[{name:"f",type:"text"},{name:"i",type:"text"},{name:"o",type:"text"},{name:"login",type:"text"}]})})}}),define("app/view/voc_users",[],function(){return function(e,t){e=$("body").data("data"),$(w2ui.rosters_layout.el("main")).w2regrid({name:"voc_organizations_grid",show:{toolbar:!0,toolbarAdd:!0,toolbarEdit:!0,toolbarDelete:!0,footer:!0},searches:[{field:"label_uc",caption:"ФИО",type:"text"},{field:"login_uc",caption:"Login",type:"text"},{field:"code_vc_nsi_20",caption:"Полномочия",type:"enum",options:{items:e.vc_nsi_20.items}},{field:"uuid_org",caption:"Организация",type:"list",options:{items:e.vc_orgs.items}}],columns:[{field:"label",caption:"ФИО",size:30},{field:"login",caption:"login",size:20},{field:"vc_orgs.label",caption:"Огранизация",size:100}],postData:{data:{uuid_org:$_REQUEST.id}},url:"/mosgis/_rest/?type=voc_users",onAdd:$_DO.create_voc_users,onEdit:$_DO.edit_voc_users,onDblClick:function(e){2==e.column?openTab("/voc_organization_legal/"+this.get(e.recid).uuid_org):$_DO.edit_voc_users(e)},onDelete:$_DO.delete_voc_users}).refresh()}});